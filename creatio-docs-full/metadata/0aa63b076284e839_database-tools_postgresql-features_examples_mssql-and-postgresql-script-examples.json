{
  "url": "https://academy.creatio.com/docs/8.x/dev/development-on-creatio-platform/8.0/development-tools/database-tools/postgresql-features/examples/mssql-and-postgresql-script-examples",
  "title": "MSSQL and PostgreSQL script examples",
  "breadcrumbs": [
    {
      "text": "Development tools",
      "href": "/docs/8.x/dev/development-on-creatio-platform/8.0/category/development-tools"
    },
    {
      "text": "Database tools",
      "href": "/docs/8.x/dev/development-on-creatio-platform/8.0/category/database-tools"
    },
    {
      "text": "PostgreSQL features",
      "href": "/docs/8.x/dev/development-on-creatio-platform/8.0/category/postgresql-features"
    },
    {
      "text": "Examples",
      "href": "/docs/8.x/dev/development-on-creatio-platform/8.0/database-features-examples"
    }
  ],
  "content_markdown": "Version: 8.0\nOn this page\nLevel: intermediate\n## Example 1 (views)\u200b\nExample\nExample of an SQL script that creates a view and triggers to add, modify, and delete records from the target table.\n-- View and triggers that let you modify the target table  \n-- MSSQL  \nIF EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VwSysAdminUnit]'))  \nDROP VIEW [dbo].[VwSysAdminUnit]  \nGO  \nCREATE VIEW [dbo].[VwSysAdminUnit]  \nAS  \nSELECT [SysAdminUnit].[Id]  \n,[SysAdminUnit].[CreatedOn]  \n,[SysAdminUnit].[CreatedById]  \n,[SysAdminUnit].[ModifiedOn]  \n,[SysAdminUnit].[ModifiedById]  \n,[SysAdminUnit].[Name]  \n,[SysAdminUnit].[Description]  \n,[SysAdminUnit].[ParentRoleId]  \n,[SysAdminUnit].[ContactId]  \n,[SysAdminUnit].[IsDirectoryEntry]  \n,[TimeZone].[Id] AS [TimeZoneId]  \n,[SysAdminUnit].[UserPassword]  \n,[SysAdminUnitType].[Id] AS [SysAdminUnitTypeId]  \n,[SysAdminUnit].[AccountId]  \n,[SysAdminUnit].[Active]  \n,[SysAdminUnit].[LoggedIn]  \n,[SysAdminUnit].[SynchronizeWithLDAP]  \n,[SysAdminUnit].[LDAPEntry]  \n,[SysAdminUnit].[LDAPEntryId]  \n,[SysAdminUnit].[LDAPEntryDN]  \n,[SysAdminUnit].[SysCultureId]  \n,[SysAdminUnit].[ProcessListeners]  \n,[SysAdminUnit].[PasswordExpireDate]  \n,[SysAdminUnit].[HomePageId]  \n,[SysAdminUnit].[ConnectionType]  \n,[ConnectionType].[Id] AS [UserConnectionTypeId]  \n,[SysAdminUnit].[ForceChangePassword]  \n,[SysAdminUnit].[DateTimeFormatId]  \n,[SysAdminUnit].[Id] as [SysAdminUnitId]  \n,[SysAdminUnit].[SessionTimeout] as [SessionTimeout]  \nFROM [SysAdminUnit]  \nINNER JOIN [SysAdminUnitType] ON [SysAdminUnitType].[Value] = [SysAdminUnit].[SysAdminUnitTypeValue]  \nLEFT JOIN [ConnectionType] AS [ConnectionType] ON [ConnectionType].[Value] = [SysAdminUnit].[ConnectionType]  \nLEFT JOIN [TimeZone] AS [TimeZone] ON [TimeZone].[Code] = [SysAdminUnit].[TimeZoneId]  \nGO  \nCREATE TRIGGER [dbo].[ITR_VwSysAdminUnit_I]  \nON [dbo].[VwSysAdminUnit]  \nINSTEAD OF INSERT  \nAS  \nBEGIN  \nSET NOCOUNT ON;  \nINSERT INTO [SysAdminUnit](  \n[Id]  \n,[CreatedOn]  \n,[CreatedById]  \n,[ModifiedOn]  \n,[ModifiedById]  \n,[Name]  \n,[Description]  \n,[ParentRoleId]  \n,[ContactId]  \n,[IsDirectoryEntry]  \n,[TimeZoneId]  \n,[UserPassword]  \n,[SysAdminUnitTypeValue]  \n,[AccountId]  \n,[Active]  \n,[LoggedIn]  \n,[SynchronizeWithLDAP]  \n,[LDAPEntry]  \n,[LDAPEntryId]  \n,[LDAPEntryDN]  \n,[SysCultureId]  \n,[ProcessListeners]  \n,[PasswordExpireDate]  \n,[HomePageId]  \n,[ConnectionType]  \n,[ForceChangePassword]  \n,[DateTimeFormatId]  \n,[SessionTimeout])  \nSELECT [Id]  \n,[CreatedOn]  \n,[CreatedById]  \n,[ModifiedOn]  \n,[ModifiedById]  \n,[Name]  \n,[Description]  \n,[ParentRoleId]  \n,[ContactId]  \n,[IsDirectoryEntry]  \n,(SELECT COALESCE(  \n(SELECT [TimeZone].[Code] FROM [TimeZone]  \nWHERE [TimeZone].[Id] = [INSERTED].[TimeZoneId]), ''))  \n,[UserPassword]  \n,ISNULL((SELECT [SysAdminUnitType].[Value] FROM [SysAdminUnitType]  \nWHERE [SysAdminUnitType].[Id] = [INSERTED].[SysAdminUnitTypeId]), 4)  \n,[AccountId]  \n,[Active]  \n,ISNULL([LoggedIn], 0)  \n,[SynchronizeWithLDAP]  \n,[LDAPEntry]  \n,[LDAPEntryId]  \n,[LDAPEntryDN]  \n,[SysCultureId]  \n,[ProcessListeners]  \n,[PasswordExpireDate]  \n,[HomePageId]  \n,COALESCE([INSERTED].[ConnectionType],  \n(SELECT [ConnectionType].[Value] FROM [ConnectionType]  \nWHERE [ConnectionType].[Id] = [INSERTED].[UserConnectionTypeId]), 0)  \n,ISNULL([ForceChangePassword], 0)  \n,[DateTimeFormatId]  \n,[SessionTimeout]  \nFROM [INSERTED]  \nEND  \nGO  \nCREATE TRIGGER [dbo].[ITR_VwSysAdminUnit_U]  \nON [dbo].[VwSysAdminUnit]  \nINSTEAD OF UPDATE  \nAS  \nBEGIN  \nSET NOCOUNT ON;  \nUPDATE [SysAdminUnit]  \nSET [SysAdminUnit].[CreatedOn] = [INSERTED].[CreatedOn]  \n,[SysAdminUnit].[CreatedById] = [INSERTED].[CreatedById]  \n,[SysAdminUnit].[ModifiedOn] =[INSERTED].[ModifiedOn]  \n,[SysAdminUnit].[ModifiedById] = [INSERTED].[ModifiedById]  \n,[SysAdminUnit].[Name] = [INSERTED].[Name]  \n,[SysAdminUnit].[Description] = [INSERTED].[Description]  \n,[SysAdminUnit].[ParentRoleId] = [INSERTED].[ParentRoleId]  \n,[SysAdminUnit].[ContactId] = [INSERTED].[ContactId]  \n,[SysAdminUnit].[IsDirectoryEntry] = [INSERTED].[IsDirectoryEntry]  \n,[SysAdminUnit].[TimeZoneId] =  \n(SELECT COALESCE(  \n(SELECT [TimeZone].[Code] FROM [TimeZone]  \nWHERE [TimeZone].[Id] = [INSERTED].[TimeZoneId]), ''))  \n,[SysAdminUnit].[UserPassword] = [INSERTED].[UserPassword]  \n,[SysAdminUnit].[SysAdminUnitTypeValue] =  \n(SELECT [SysAdminUnitType].[Value] FROM [SysAdminUnitType]  \nWHERE [SysAdminUnitType].[Id] = [INSERTED].[SysAdminUnitTypeId])  \n,[SysAdminUnit].[AccountId] = [INSERTED].[AccountId]  \n,[SysAdminUnit].[Active] = [INSERTED].[Active]  \n,[SysAdminUnit].[LoggedIn] = [INSERTED].[LoggedIn]  \n,[SysAdminUnit].[SynchronizeWithLDAP] = [INSERTED].[SynchronizeWithLDAP]  \n,[SysAdminUnit].[LDAPEntry] = [INSERTED].[LDAPEntry]  \n,[SysAdminUnit].[LDAPEntryId] = [INSERTED].[LDAPEntryId]  \n,[SysAdminUnit].[LDAPEntryDN] = [INSERTED].[LDAPEntryDN]  \n,[SysAdminUnit].[SysCultureId] = [INSERTED].[SysCultureId]  \n,[SysAdminUnit].[ProcessListeners] = [INSERTED].[ProcessListeners]  \n,[SysAdminUnit].[PasswordExpireDate] = [INSERTED].[PasswordExpireDate]  \n,[SysAdminUnit].[HomePageId] = [INSERTED].[HomePageId]  \n,[SysAdminUnit].[ConnectionType] = COALESCE([INSERTED].[ConnectionType],  \n(SELECT [ConnectionType].[Value] FROM [ConnectionType]  \nWHERE [ConnectionType].[Id] = [INSERTED].[UserConnectionTypeId]), 0)  \n,[SysAdminUnit].[ForceChangePassword] = [INSERTED].[ForceChangePassword]  \n,[SysAdminUnit].[DateTimeFormatId] = [INSERTED].[DateTimeFormatId]  \n,[SysAdminUnit].[SessionTimeout] = [INSERTED].[SessionTimeout]  \nFROM [SysAdminUnit]  \nINNER JOIN [INSERTED] ON [SysAdminUnit].[Id] = [INSERTED].[Id]  \nEND  \nGO  \nCREATE TRIGGER [dbo].[ITR_VwSysAdminUnit_D]  \nON [dbo].[VwSysAdminUnit]  \nINSTEAD OF DELETE  \nAS  \nBEGIN  \nSET NOCOUNT ON;  \nDELETE FROM [SysAdminUnit]  \nWHERE EXISTS(SELECT * FROM [DELETED] WHERE [SysAdminUnit].[Id] = [DELETED].[Id])  \nEND  \nGO  \n-- View and triggers that let you modify the target table  \n-- PostgreSQL  \nDROP FUNCTION IF EXISTS \"public\".\"ITR_VwSysLookup_IUD_Func\" CASCADE;  \nDROP VIEW IF EXISTS \"public\".\"VwSysLookup\";  \nCREATE VIEW \"public\".\"VwSysLookup\" AS  \nSELECT \"SysLookup\".\"Id\"  \n,\"SysLookup\".\"CreatedOn\"  \n,\"SysLookup\".\"CreatedById\"  \n,\"SysLookup\".\"ModifiedOn\"  \n,\"SysLookup\".\"ModifiedById\"  \n,\"SysLookup\".\"Name\"  \n,\"SysLookup\".\"Description\"  \n,\"SysLookup\".\"SysFolderId\"  \n,\"SysLookup\".\"SysEntitySchemaUId\"  \n,\"SysLookup\".\"SysGridPageSchemaUId\"  \n,\"SysLookup\".\"SysEditPageSchemaUId\"  \n,\"VwSysSchemaInfo\".\"SysWorkspaceId\"  \n,\"SysLookup\".\"ProcessListeners\"  \n,\"SysLookup\".\"IsSystem\"  \n,\"SysLookup\".\"IsSimple\"  \nFROM \"public\".\"SysLookup\"  \nINNER JOIN \"public\".\"VwSysSchemaInfo\" ON \"SysLookup\".\"SysEntitySchemaUId\" = \"VwSysSchemaInfo\".\"UId\";  \nCREATE FUNCTION \"public\".\"ITR_VwSysLookup_IUD_Func\"() RETURNS TRIGGER AS $$  \nBEGIN  \nIF TG_OP = 'INSERT' THEN  \nINSERT INTO \"public\".\"SysLookup\"(  \n\"Id\"  \n,\"CreatedOn\"  \n,\"CreatedById\"  \n,\"ModifiedOn\"  \n,\"ModifiedById\"  \n,\"Name\"  \n,\"Description\"  \n,\"SysFolderId\"  \n,\"SysEntitySchemaUId\"  \n,\"SysGridPageSchemaUId\"  \n,\"SysEditPageSchemaUId\"  \n,\"ProcessListeners\"  \n,\"IsSystem\"  \n,\"IsSimple\")  \nSELECT NEW.\"Id\"  \n,NEW.\"CreatedOn\"  \n,NEW.\"CreatedById\"  \n,NEW.\"ModifiedOn\"  \n,NEW.\"ModifiedById\"  \n,NEW.\"Name\"  \n,NEW.\"Description\"  \n,NEW.\"SysFolderId\"  \n,NEW.\"SysEntitySchemaUId\"  \n,NEW.\"SysGridPageSchemaUId\"  \n,NEW.\"SysEditPageSchemaUId\"  \n,NEW.\"ProcessListeners\"  \n,NEW.\"IsSystem\"  \n,NEW.\"IsSimple\";  \nRETURN NEW;  \nELSIF TG_OP = 'UPDATE' THEN  \nUPDATE \"public\".\"SysLookup\"  \nSET \"CreatedOn\" = NEW.\"CreatedOn\"  \n,\"CreatedById\" = NEW.\"CreatedById\"  \n,\"ModifiedOn\" = NEW.\"ModifiedOn\"  \n,\"ModifiedById\" = NEW.\"ModifiedById\"  \n,\"Name\" = NEW.\"Name\"  \n,\"Description\" = NEW.\"Description\"  \n,\"SysFolderId\" = NEW.\"SysFolderId\"  \n,\"SysEntitySchemaUId\" = NEW.\"SysEntitySchemaUId\"  \n,\"SysGridPageSchemaUId\" = NEW.\"SysGridPageSchemaUId\"  \n,\"SysEditPageSchemaUId\" = NEW.\"SysEditPageSchemaUId\"  \n,\"ProcessListeners\" = NEW.\"ProcessListeners\"  \n,\"IsSystem\" = NEW.\"IsSystem\"  \n,\"IsSimple\" = NEW.\"IsSimple\"  \nWHERE \"SysLookup\".\"Id\" = NEW.\"Id\";  \nRETURN NEW;  \nELSIF TG_OP = 'DELETE' THEN  \nDELETE FROM \"public\".\"SysLookup\" WHERE OLD.\"Id\" = \"SysLookup\".\"Id\";  \nRETURN OLD;  \nEND IF;  \nRETURN NEW;  \nEND;  \n$$ LANGUAGE plpgsql;  \nCREATE TRIGGER \"ITR_VwSysLookup_IUD\"  \nINSTEAD OF INSERT OR UPDATE OR DELETE ON \"public\".\"VwSysLookup\"  \nFOR EACH ROW EXECUTE PROCEDURE \"public\".\"ITR_VwSysLookup_IUD_Func\"();  \n## Example 2 (views)\u200b\nExample\nExample of an SQL script that demonstrates how to use a RULE instead of the INSTEAD OF trigger in PostgreSQL.\n-- Use the RULE instead of the INSTEAD OF trigger  \n-- MSSQL  \nIF EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VwAdministrativeObjects]'))  \nDROP VIEW [dbo].[VwAdministrativeObjects]  \nGO  \nCREATE VIEW [dbo].[VwAdministrativeObjects]  \nAS  \nWITH  \n[SysSchemaAdministrationProperties] AS (  \nSELECT [AdministrationPropertiesAll].[Id] AS [SysSchemaId],  \nmax([AdministrationPropertiesAll].[AdministratedByOperations]) AS [AdministratedByOperations],  \nmax([AdministrationPropertiesAll].[AdministratedByColumns]) AS [AdministratedByColumns],  \nmax([AdministrationPropertiesAll].[AdministratedByRecords]) AS [AdministratedByRecords],  \nmax([AdministrationPropertiesAll].[IsTrackChangesInDB]) AS [IsTrackChangesInDB]  \nFROM (  \nSELECT [SysSchema].[Id],  \n(CASE WHEN EXISTS (  \nSELECT 1  \nFROM [SysSchemaProperty]  \nWHERE (([SysSchemaProperty].[SysSchemaId] = [SysSchema].[Id] AND [SysSchema].[ExtendParent] = 0)  \nOR [SysSchemaProperty].[SysSchemaId] = [DerivedSysSchema].[Id])  \nAND [SysSchemaProperty].[Name] = 'AdministratedByOperations'  \nAND [SysSchemaProperty].[Value] = 'True'  \nAND [SysSchemaProperty].[SysSchemaId] IS NOT NULL  \n)  \nTHEN 1 ELSE 0 END) AS [AdministratedByOperations],  \n(CASE WHEN EXISTS (  \nSELECT 1  \nFROM [SysSchemaProperty]  \nWHERE (([SysSchemaProperty].[SysSchemaId] = [SysSchema].[Id] AND [SysSchema].[ExtendParent] = 0)  \nOR [SysSchemaProperty].[SysSchemaId] = [DerivedSysSchema].[Id])  \nAND [SysSchemaProperty].[Name] = 'AdministratedByColumns'  \nAND [SysSchemaProperty].[Value] = 'True'  \nAND [SysSchemaProperty].[SysSchemaId] IS NOT NULL  \n)  \nTHEN 1 ELSE 0 END) AS [AdministratedByColumns],  \n(CASE WHEN EXISTS (  \nSELECT 1  \nFROM [SysSchemaProperty]  \nWHERE (([SysSchemaProperty].[SysSchemaId] = [SysSchema].[Id] AND [SysSchema].[ExtendParent] = 0)  \nOR [SysSchemaProperty].[SysSchemaId] = [DerivedSysSchema].[Id])  \nAND [SysSchemaProperty].[Name] = 'AdministratedByRecords'  \nAND [SysSchemaProperty].[Value] = 'True'  \nAND [SysSchemaProperty].[SysSchemaId] IS NOT NULL  \n)  \nTHEN 1 ELSE 0 END) AS [AdministratedByRecords],  \n(CASE WHEN EXISTS (  \nSELECT 1  \nFROM [SysSchemaProperty]  \nWHERE (([SysSchemaProperty].[SysSchemaId] = [SysSchema].[Id] AND [SysSchema].[ExtendParent] = 0)  \nOR [SysSchemaProperty].[SysSchemaId] = [DerivedSysSchema].[Id])  \nAND [SysSchemaProperty].[Name] = 'IsTrackChangesInDB'  \nAND [SysSchemaProperty].[Value] = 'True'  \nAND [SysSchemaProperty].[SysSchemaId] IS NOT NULL  \n)  \nTHEN 1 ELSE 0 END) AS [IsTrackChangesInDB]  \nFROM [SysSchema]  \nLEFT OUTER JOIN [SysSchema] AS [DerivedSysSchema] ON ([SysSchema].[Id] = [DerivedSysSchema].[ParentId] AND [DerivedSysSchema].[ExtendParent] = 1)  \nWHERE [SysSchema].[ManagerName] = 'EntitySchemaManager'  \nAND [SysSchema].[ExtendParent] = 0  \n) AS [AdministrationPropertiesAll]  \nGROUP BY [AdministrationPropertiesAll].[Id]  \n)  \nSELECT [BaseSchemas].[UId] AS [Id],  \n[BaseSchemas].[UId],  \n[BaseSchemas].[CreatedOn],  \n[BaseSchemas].[CreatedById],  \n[BaseSchemas].[ModifiedOn],  \n[BaseSchemas].[ModifiedById],  \n[BaseSchemas].[Name],  \n[VwSysSchemaExtending].[TopExtendingCaption] as Caption,  \n[BaseSchemas].[Description],  \n(CASE WHEN EXISTS (  \nSELECT 1  \nFROM [SysLookup]  \nWHERE [SysLookup].[SysEntitySchemaUId] = [BaseSchemas].[UId])  \nTHEN 1 ELSE 0 END) AS [IsLookup],  \n(CASE WHEN EXISTS (  \nSELECT 1 FROM [SysModule]  \nINNER JOIN [SysModuleEntity] ON [SysModuleEntity].[Id] = [SysModule].[SysModuleEntityId]  \nWHERE [BaseSchemas].[UId] = [SysModuleEntity].[SysEntitySchemaUId])  \nTHEN 1 ELSE 0 END) AS [IsModule],  \n[SysSchemaAdministrationProperties].[AdministratedByOperations],  \n[SysSchemaAdministrationProperties].[AdministratedByColumns],  \n[SysSchemaAdministrationProperties].[AdministratedByRecords],  \n[SysSchemaAdministrationProperties].[IsTrackChangesInDB],  \n[SysWorkspaceId],  \n[BaseSchemas].[ProcessListeners],  \n(CASE WHEN EXISTS (  \nSELECT 1  \nFROM [SysSSPEntitySchemaAccessList]  \nWHERE [SysSSPEntitySchemaAccessList].[EntitySchemaUId] = [BaseSchemas].[UId]  \n)  \nTHEN 1 ELSE 0 END) AS [IsInSSPEntitySchemaAccessList]  \nFROM  [SysSchema] as [BaseSchemas]  \nINNER JOIN [VwSysSchemaExtending] ON BaseSchemas.[Id] = [VwSysSchemaExtending].[BaseSchemaId]  \nINNER JOIN [SysPackage] on [BaseSchemas].[SysPackageId] = [SysPackage].[Id]  \nINNER JOIN [SysSchemaAdministrationProperties] ON [BaseSchemas].[Id] = [SysSchemaAdministrationProperties].[SysSchemaId]  \nGO  \nCREATE TRIGGER [dbo].[TRVwAdministrativeObjects_IU]  \nON [dbo].[VwAdministrativeObjects]  \nINSTEAD OF UPDATE  \nAS  \nBEGIN  \nSET NOCOUNT ON;  \nRETURN  \nEND  \nGO  \n-- Use the RULE instead of the INSTEAD OF trigger  \n-- PostgreSQL  \nDROP VIEW IF EXISTS public.\"VwAdministrativeObjects\";  \nDROP RULE IF EXISTS RU_VwAdministrativeObjects ON \"VwAdministrativeObjects\";  \nCREATE VIEW public.\"VwAdministrativeObjects\" AS  \nWITH SysSchemaAdministrationProperties AS (  \nSELECT AdministrationPropertiesAll.Id \"SysSchemaId\",  \nMAX(AdministrationPropertiesAll.AdministratedByOperations) \"AdministratedByOperations\",  \nMAX(AdministrationPropertiesAll.AdministratedByColumns) \"AdministratedByColumns\",  \nMAX(AdministrationPropertiesAll.AdministratedByRecords) \"AdministratedByRecords\",  \nMAX(AdministrationPropertiesAll.IsTrackChangesInDB) \"IsTrackChangesInDB\"  \nFROM (  \nSELECT ss.\"Id\" Id  \n,(CASE WHEN EXISTS (  \nSELECT 1  \nFROM \"SysSchemaProperty\" ssp  \nWHERE ((ssp.\"SysSchemaId\" = ss.\"Id\" AND NOT ss.\"ExtendParent\") OR ssp.\"SysSchemaId\" = DerivedSysSchema.\"Id\")  \nAND ssp.\"Name\" = 'AdministratedByOperations'  \nAND ssp.\"Value\" = 'True'  \nAND ssp.\"SysSchemaId\" IS NOT NULL  \n) THEN 1 ELSE 0 END) AdministratedByOperations  \n,(CASE WHEN EXISTS (  \nSELECT 1  \nFROM \"SysSchemaProperty\" ssp  \nWHERE ((ssp.\"SysSchemaId\" = ss.\"Id\" AND NOT ss.\"ExtendParent\") OR ssp.\"SysSchemaId\" = DerivedSysSchema.\"Id\")  \nAND ssp.\"Name\" = 'AdministratedByColumns'  \nAND ssp.\"Value\" = 'True'  \nAND ssp.\"SysSchemaId\" IS NOT NULL  \n) THEN 1 ELSE 0 END) AdministratedByColumns  \n,(CASE WHEN EXISTS (  \nSELECT 1  \nFROM \"SysSchemaProperty\" ssp  \nWHERE ((ssp.\"SysSchemaId\" = ss.\"Id\" AND NOT ss.\"ExtendParent\") OR ssp.\"SysSchemaId\" = DerivedSysSchema.\"Id\")  \nAND ssp.\"Name\" = 'AdministratedByRecords'  \nAND ssp.\"Value\" = 'True'  \nAND ssp.\"SysSchemaId\" IS NOT NULL  \n) THEN 1 ELSE 0 END) AdministratedByRecords  \n,(CASE WHEN EXISTS (  \nSELECT 1  \nFROM \"SysSchemaProperty\" ssp WHERE ((ssp.\"SysSchemaId\" = ss.\"Id\" AND NOT ss.\"ExtendParent\")  \nOR ssp.\"SysSchemaId\" = DerivedSysSchema.\"Id\")  \nAND ssp.\"Name\" = 'IsTrackChangesInDB'  \nAND ssp.\"Value\" = 'True'  \nAND ssp.\"SysSchemaId\" IS NOT NULL  \n) THEN 1 ELSE 0 END) IsTrackChangesInDB  \nFROM \"SysSchema\" ss  \nLEFT OUTER JOIN \"SysSchema\" DerivedSysSchema ON (ss.\"Id\" = DerivedSysSchema.\"ParentId\" AND DerivedSysSchema.\"ExtendParent\")  \nWHERE ss.\"ManagerName\" = 'EntitySchemaManager' AND NOT ss.\"ExtendParent\"  \n) AdministrationPropertiesAll  \nGROUP BY AdministrationPropertiesAll.Id  \n)  \nSELECT BaseSchema.\"UId\" \"Id\"  \n,BaseSchema.\"UId\"  \n,BaseSchema.\"CreatedOn\"  \n,BaseSchema.\"CreatedById\"  \n,BaseSchema.\"ModifiedOn\"  \n,BaseSchema.\"ModifiedById\"  \n,BaseSchema.\"Name\"  \n,public.\"VwSysSchemaExtending\".\"TopExtendingCaption\" \"Caption\"  \n,BaseSchema.\"Description\"  \n,EXISTS (  \nSELECT 1  \nFROM \"SysLookup\"  \nWHERE \"SysEntitySchemaUId\" = BaseSchema.\"UId\"  \n) \"IsLookup\"  \n,EXISTS (  \nSELECT 1  \nFROM \"SysModule\" sm  \nINNER JOIN \"SysModuleEntity\" sme ON sme.\"Id\" = sm.\"SysModuleEntityId\"  \nWHERE BaseSchema.\"UId\" = sme.\"SysEntitySchemaUId\"  \n) \"IsModule\"  \n,SysSchemaAdministrationProperties.\"AdministratedByOperations\"::BOOLEAN  \n,SysSchemaAdministrationProperties.\"AdministratedByColumns\"::BOOLEAN  \n,SysSchemaAdministrationProperties.\"AdministratedByRecords\"::BOOLEAN  \n,SysSchemaAdministrationProperties.\"IsTrackChangesInDB\"::BOOLEAN  \n,\"SysWorkspaceId\"  \n,BaseSchema.\"ProcessListeners\"  \n,EXISTS (  \nSELECT 1  \nFROM \"SysSSPEntitySchemaAccessList\"  \nWHERE \"EntitySchemaUId\" = BaseSchema.\"UId\"  \n) \"IsInSSPEntitySchemaAccessList\"  \nFROM \"SysSchema\" BaseSchema  \nINNER JOIN \"VwSysSchemaExtending\" ON BaseSchema.\"Id\" = \"VwSysSchemaExtending\".\"BaseSchemaId\"  \nINNER JOIN \"SysPackage\" on BaseSchema.\"SysPackageId\" = \"SysPackage\".\"Id\"  \nINNER JOIN SysSchemaAdministrationProperties ON BaseSchema.\"Id\" = SysSchemaAdministrationProperties.\"SysSchemaId\";  \nCREATE RULE RU_VwAdministrativeObjects AS  \nON UPDATE TO \"VwAdministrativeObjects\"  \nDO INSTEAD NOTHING;  \n## Example 3 (stored procedures)\u200b\nExample\nExample of an SQL script that creates a stored procedure. The stored procedure uses loops, cursors, and temporary tables.\n-- Stored procedure that uses loops, cursors, and temporary tables  \n-- MSSQL  \nIF NOT OBJECT_ID('[dbo].[tsp_ActualizeUserRoles]') IS NULL  \nBEGIN  \nDROP PROCEDURE [dbo].[tsp_ActualizeUserRoles]  \nEND  \nGO  \nCREATE PROCEDURE dbo.tsp_ActualizeUserRoles (@UserId uniqueidentifier)  \nAS  \nBEGIN  \nSET NOCOUNT ON  \nIF OBJECT_ID('tempdb..#AdminUnitListTemp') IS NOT NULL  \nBEGIN  \nDROP TABLE [#AdminUnitListTemp];  \nEND;  \nCREATE TABLE [#AdminUnitListTemp] (  \n[UserId] uniqueidentifier NOT NULL,  \n[Id] uniqueidentifier NOT NULL,  \n[Name] NVARCHAR(250) NOT NULL,  \n[ParentRoleId] uniqueidentifier NULL,  \n[Granted] BIT NULL  \n);  \nDECLARE @GetAdminUnitList TABLE (  \n[Id] uniqueidentifier NOT NULL,  \n[Name] nvarchar(260) NOT NULL,  \n[ParentRoleId] uniqueidentifier NULL  \n);  \nDECLARE @NewRoles TABLE ([Id] uniqueidentifier NOT NULL);  \nDECLARE @OldUserRoles TABLE ([Id] uniqueidentifier NOT NULL);  \nDECLARE @getUserAdminUnits CURSOR;  \nDECLARE @SysAdminUnitRoles TABLE (  \n[Id] uniqueidentifier,  \n[Name] nvarchar(260),  \n[ParentRoleId] uniqueidentifier  \n);  \nDECLARE @ManagersBeforeActualization TABLE ([Id] uniqueidentifier NOT NULL);  \nDECLARE @ManagersAfterActualization TABLE ([Id] uniqueidentifier NOT NULL);  \nDECLARE @StillManagers TABLE ([Id] uniqueidentifier NOT NULL);  \nDECLARE @NoLongerManagers TABLE ([Id] uniqueidentifier NOT NULL);  \nDECLARE @NewManagers TABLE ([Id] uniqueidentifier NOT NULL);  \nDECLARE @SysAdminUnitId uniqueidentifier;  \n-- Old user roles  \nINSERT INTO @OldUserRoles  \nSELECT DISTINCT [SysAdminUnitInRole].[SysAdminUnitRoleId] [Id]  \nFROM [SysAdminUnitInRole]  \nWHERE [SysAdminUnitInRole].[SysAdminUnitId] = @UserId  \n-- Old user managers  \nINSERT INTO @ManagersBeforeActualization  \nSELECT DISTINCT [SysUserInRole].[SysUserId] [Id]  \nFROM [SysAdminUnitInRole]  \nINNER JOIN [SysAdminUnit] [Roles]  \nON [SysAdminUnitInRole].[SysAdminUnitRoleId] = [Roles].[Id]  \nINNER JOIN @OldUserRoles  \nON [Roles].[ParentRoleId] = [@OldUserRoles].[Id]  \nINNER JOIN [SysUserInRole]  \nON [SysUserInRole].[SysRoleId] = [Roles].[Id]  \nWHERE [Roles].[SysAdminUnitTypeValue] = 2  \n-- Get and insert new user roles  \nINSERT INTO @GetAdminUnitList EXEC [tsp_GetAdminUnitList] @UserId=@UserId;  \nINSERT INTO @NewRoles SELECT [Id] FROM @GetAdminUnitList;  \nDELETE FROM [SysAdminUnitInRole] WHERE [SysAdminUnitId] = @UserId;  \nINSERT INTO [SysAdminUnitInRole] ([SysAdminUnitId], [SysAdminUnitRoleId])  \nSELECT DISTINCT @UserId, [Id] FROM @NewRoles;  \n-- User managers after actualization  \nINSERT INTO @ManagersAfterActualization  \nSELECT DISTINCT  \n[SysUserInRole].[SysUserId] [Id]  \nFROM [SysAdminUnitInRole]  \nINNER JOIN [SysAdminUnit] [Roles]  \nON [SysAdminUnitInRole].[SysAdminUnitRoleId] = [Roles].[Id]  \nINNER JOIN @NewRoles NewRoles  \nON [Roles].[ParentRoleId] = NewRoles.[Id]  \nINNER JOIN [SysUserInRole]  \nON [SysUserInRole].[SysRoleId] = [Roles].[Id]  \nWHERE [Roles].[SysAdminUnitTypeValue] = 2;  \n-- New (who were not but become) user managers  \nINSERT INTO @NewManagers  \nSELECT [Id] FROM @ManagersAfterActualization AS managersAfterActualization  \nWHERE NOT EXISTS (  \nSELECT NULL  \nFROM @ManagersBeforeActualization AS managersBeforeActualization  \nWHERE managersBeforeActualization.[Id] = managersAfterActualization.[Id]  \n);  \n-- Add all user roles to new managers and their grantee-users, if they arent already have  \nSET @getUserAdminUnits = CURSOR FOR  \nSELECT DISTINCT [Id] FROM (  \nSELECT [Id] FROM @NewManagers  \nUNION  \nSELECT [GranteeSysAdminUnitId]  \nFROM [SysAdminUnitGrantedRight]  \nWHERE EXISTS (  \nSELECT NULL FROM @NewManagers as newManagers  \nWHERE [SysAdminUnitGrantedRight].[GrantorSysAdminUnitId] = newManagers.[Id]  \n)  \n) Roles;  \nOPEN @getUserAdminUnits;  \nFETCH NEXT  \nFROM @getUserAdminUnits INTO @SysAdminUnitId;  \nWHILE @@FETCH_STATUS = 0  \nBEGIN  \nINSERT INTO [SysAdminUnitInRole] ([SysAdminUnitId], [SysAdminUnitRoleId])  \nSELECT DISTINCT @SysAdminUnitId, [Id]  \nFROM @NewRoles AS newRoles  \nWHERE NOT EXISTS (  \nSELECT 1  \nFROM [SysAdminUnitInRole]  \nWHERE [SysAdminUnitInRole].[SysAdminUnitId] = @SysAdminUnitId  \nAND [SysAdminUnitInRole].[SysAdminUnitRoleId] = newRoles.[Id]  \n);  \nFETCH NEXT FROM @getUserAdminUnits INTO @SysAdminUnitId;  \nEND;  \nCLOSE @getUserAdminUnits;  \nDEALLOCATE @getUserAdminUnits;  \nDECLARE @isUserLostAtLeastOneRole INT = (  \nSELECT COUNT(*)  \nFROM @OldUserRoles AS oldUserRoles  \nWHERE NOT EXISTS (  \nSELECT 1  \nFROM @NewRoles AS newUserRoles  \nWHERE newUserRoles.[Id] = oldUserRoles.[Id]  \n)  \n);  \n-- Still (who were and remained) user managers  \nINSERT INTO @StillManagers  \nSELECT  DISTINCT managersAfterActualization.[Id] AS [Id]  \nFROM @ManagersAfterActualization AS managersAfterActualization  \nJOIN @ManagersBeforeActualization AS managersBeforeActualization  \nON managersAfterActualization.[Id] = managersBeforeActualization.[Id];  \n-- If user lost at least one role, we need to actualize all his still-managers.  \n-- If not (user only gained new roles) - we just add to still-managers and their grantee-users new user roles.  \nIF (@isUserLostAtLeastOneRole = 0)  \nBEGIN  \n-- Add all new user roles to his still-managers and to their grantee-users  \nSET @getUserAdminUnits = CURSOR FOR  \nSELECT DISTINCT [Id] FROM (  \nSELECT stillManagers.[Id] AS [Id]  \nFROM @StillManagers AS stillManagers  \nUNION  \nSELECT [GranteeSysAdminUnitId]  \nFROM [SysAdminUnitGrantedRight]  \nWHERE EXISTS (  \nSELECT NULL  \nFROM @StillManagers AS stillManagers  \nWHERE stillManagers.[Id] = [GrantorSysAdminUnitId]  \n)  \n) Roles;  \nOPEN @getUserAdminUnits;  \nFETCH NEXT  \nFROM @getUserAdminUnits INTO @SysAdminUnitId;  \nWHILE @@FETCH_STATUS = 0  \nBEGIN  \nINSERT INTO [SysAdminUnitInRole] ([SysAdminUnitId], [SysAdminUnitRoleId])  \nSELECT DISTINCT @SysAdminUnitId, [Id]  \nFROM @NewRoles AS newRoles  \nWHERE NOT EXISTS (  \nSELECT 1  \nFROM [SysAdminUnitInRole]  \nWHERE [SysAdminUnitInRole].[SysAdminUnitId] = @SysAdminUnitId  \nAND [SysAdminUnitInRole].[SysAdminUnitRoleId] = newRoles.[Id]  \n);  \nFETCH NEXT FROM @getUserAdminUnits INTO @SysAdminUnitId;  \nEND;  \nCLOSE @getUserAdminUnits;  \nDEALLOCATE @getUserAdminUnits;  \nEND ELSE  \nBEGIN  \n--Actualize all roles for still-managers  \nSET @getUserAdminUnits = CURSOR FOR  \nSELECT DISTINCT [Id]  \nFROM @StillManagers  \nUNION  \nSELECT [GranteeSysAdminUnitId]  \nFROM [SysAdminUnitGrantedRight]  \nWHERE EXISTS (  \nSELECT NULL  \nFROM @StillManagers AS stillManagers  \nWHERE stillManagers.[Id] = [GrantorSysAdminUnitId]  \n);  \nOPEN @getUserAdminUnits;  \nFETCH NEXT  \nFROM @getUserAdminUnits INTO @SysAdminUnitId;  \nWHILE @@FETCH_STATUS = 0  \nBEGIN  \nDELETE FROM @SysAdminUnitRoles;  \nINSERT INTO @SysAdminUnitRoles  \nEXEC [tsp_GetAdminUnitList] @UserId=@SysAdminUnitId;  \nBEGIN TRAN;  \nDELETE FROM [dbo].[SysAdminUnitInRole] WHERE SysAdminUnitId = @SysAdminUnitId;  \nINSERT INTO [dbo].[SysAdminUnitInRole] (SysAdminUnitId, SysAdminUnitRoleId)  \nSELECT @SysAdminUnitId, [Id] FROM @SysAdminUnitRoles;  \nCOMMIT;  \nFETCH NEXT  \nFROM @getUserAdminUnits INTO @SysAdminUnitId;  \nEND;  \nCLOSE @getUserAdminUnits;  \nDEALLOCATE @getUserAdminUnits;  \nEND;  \n-- No longer (who were but not remained) user managers  \nINSERT INTO @NoLongerManagers  \nSELECT [Id] FROM @ManagersBeforeActualization as managersBeforeActualization  \nWHERE NOT EXISTS (  \nSELECT NULL  \nFROM @ManagersAfterActualization AS managersAfterActualization  \nWHERE managersAfterActualization.[Id] = managersBeforeActualization.[Id]  \n);  \n-- Actualize roles for all noLonger-managers, his grantee-users and all grantee-users of user  \nSET @getUserAdminUnits = CURSOR FOR  \nSELECT DISTINCT [Id] FROM (  \nSELECT [Id] FROM @NoLongerManagers  \nUNION  \nSELECT [GranteeSysAdminUnitId]  \nFROM [SysAdminUnitGrantedRight]  \nWHERE EXISTS (  \nSELECT NULL  \nFROM @NoLongerManagers AS noLongerManagers  \nWHERE noLongerManagers.[Id] = [GrantorSysAdminUnitId]  \n)  \nUNION ALL  \nSELECT GranteeSysAdminUnitId  \nFROM SysAdminUnitGrantedRight  \nWHERE GrantorSysAdminUnitId = @UserId  \n) Roles;  \nOPEN @getUserAdminUnits;  \nFETCH NEXT  \nFROM @getUserAdminUnits INTO @SysAdminUnitId;  \nWHILE @@FETCH_STATUS = 0  \nBEGIN  \nDELETE FROM @SysAdminUnitRoles;  \nINSERT INTO @SysAdminUnitRoles  \nEXEC [tsp_GetAdminUnitList] @UserId=@SysAdminUnitId;  \nBEGIN TRAN;  \nDELETE FROM [dbo].[SysAdminUnitInRole] WHERE SysAdminUnitId = @SysAdminUnitId;  \nINSERT INTO [dbo].[SysAdminUnitInRole] (SysAdminUnitId, SysAdminUnitRoleId)  \nSELECT @SysAdminUnitId, [Id] FROM @SysAdminUnitRoles;  \nCOMMIT;  \nFETCH NEXT  \nFROM @getUserAdminUnits INTO @SysAdminUnitId;  \nEND;  \nCLOSE @getUserAdminUnits;  \nDEALLOCATE @getUserAdminUnits;  \nIF OBJECT_ID('tempdb..#AdminUnitListTemp') IS NOT NULL  \nBEGIN  \nDROP TABLE [#AdminUnitListTemp];  \nEND;  \nEND;  \nGO  \n-- Stored procedure that uses loops, cursors, and temporary tables  \n-- PostgreSQL  \nDROP FUNCTION IF EXISTS \"tsp_ActualizeUserRoles\";  \nCREATE FUNCTION \"tsp_ActualizeUserRoles\"(  \nUserId UUID  \n)  \nRETURNS VOID  \nAS $$  \nDECLARE  \ngetUserNewManagers CURSOR FOR  \nSELECT DISTINCT \"Id\" FROM (  \nSELECT \"Id\" FROM \"NewManagers\"  \nUNION  \nSELECT \"GranteeSysAdminUnitId\"  \nFROM \"SysAdminUnitGrantedRight\"  \nWHERE EXISTS (  \nSELECT NULL FROM \"NewManagers\" as \"newManagers\"  \nWHERE \"SysAdminUnitGrantedRight\".\"GrantorSysAdminUnitId\" = \"newManagers\".\"Id\"  \n)  \n) \"Roles\";  \nlostUserRolesCount INT;  \ngetUserStillManagers CURSOR FOR  \nSELECT DISTINCT \"stillManagers\".\"Id\" AS \"Id\"  \nFROM \"StillManagers\" AS \"stillManagers\"  \nUNION  \nSELECT \"GranteeSysAdminUnitId\"  \nFROM \"SysAdminUnitGrantedRight\"  \nWHERE EXISTS (  \nSELECT NULL  \nFROM \"StillManagers\" AS \"stillManagers\"  \nWHERE \"stillManagers\".\"Id\" = \"GrantorSysAdminUnitId\"  \n);  \ngetUserNoLongerManagers CURSOR FOR  \nSELECT DISTINCT \"Id\" FROM (  \nSELECT \"Id\"  \nFROM \"NoLongerManagers\"  \nUNION  \nSELECT \"GranteeSysAdminUnitId\"  \nFROM \"SysAdminUnitGrantedRight\"  \nWHERE EXISTS (  \nSELECT NULL  \nFROM \"NoLongerManagers\" AS \"noLongerManagers\"  \nWHERE \"noLongerManagers\".\"Id\" = \"GrantorSysAdminUnitId\"  \n)  \nUNION ALL  \nSELECT \"GranteeSysAdminUnitId\"  \nFROM \"SysAdminUnitGrantedRight\"  \nWHERE \"GrantorSysAdminUnitId\" = UserId  \n) \"Roles\";  \nBEGIN  \nDROP TABLE IF EXISTS \"GetAdminUnitListTmp\";  \nCREATE TEMP TABLE \"GetAdminUnitListTmp\" (  \n\"Id\" UUID,  \n\"Name\" VARCHAR(250),  \n\"ParentRoleId\" UUID  \n);  \nDROP TABLE IF EXISTS \"SysAdminUnitRoles\";  \nCREATE TEMP TABLE \"SysAdminUnitRoles\" (  \n\"Id\" UUID,  \n\"Name\" VARCHAR(250),  \n\"ParentRoleId\" UUID  \n);  \n-- Old user roles  \nDROP TABLE IF EXISTS \"OldUserRoles\";  \nCREATE TEMP TABLE \"OldUserRoles\" (  \n\"Id\" UUID  \n);  \nINSERT INTO \"OldUserRoles\"  \nSELECT DISTINCT \"SysAdminUnitInRole\".\"SysAdminUnitRoleId\" \"Id\"  \nFROM \"SysAdminUnitInRole\"  \nWHERE \"SysAdminUnitInRole\".\"SysAdminUnitId\" = UserId;  \n-- Old user managers  \nDROP TABLE IF EXISTS \"ManagersBeforeActualization\";  \nCREATE TEMP TABLE \"ManagersBeforeActualization\" (  \n\"Id\" UUID  \n);  \nINSERT INTO \"ManagersBeforeActualization\"  \nSELECT DISTINCT \"SysUserInRole\".\"SysUserId\" \"Id\"  \nFROM \"SysAdminUnitInRole\"  \nINNER JOIN \"SysAdminUnit\" \"Roles\"  \nON \"SysAdminUnitInRole\".\"SysAdminUnitRoleId\" = \"Roles\".\"Id\"  \nINNER JOIN \"OldUserRoles\"  \nON \"Roles\".\"ParentRoleId\" = \"OldUserRoles\".\"Id\"  \nINNER JOIN \"SysUserInRole\"  \nON \"SysUserInRole\".\"SysRoleId\" = \"Roles\".\"Id\"  \nWHERE \"Roles\".\"SysAdminUnitTypeValue\" = 2;  \n-- Get and insert new user roles  \nDROP TABLE IF EXISTS \"GetAdminUnitList\";  \nCREATE TEMP TABLE \"GetAdminUnitList\" (  \n\"Id\" UUID,  \n\"Name\" VARCHAR(250),  \n\"ParentRoleId\" UUID  \n);  \nDROP TABLE IF EXISTS \"NewRoles\";  \nCREATE TEMP TABLE \"NewRoles\" (  \n\"Id\" UUID  \n);  \nINSERT INTO \"GetAdminUnitList\" SELECT * FROM \"tsp_GetAdminUnitList\"(UserId);  \nINSERT INTO \"NewRoles\" SELECT \"Id\" FROM \"GetAdminUnitList\";  \nDELETE FROM \"SysAdminUnitInRole\" WHERE \"SysAdminUnitId\" = UserId;  \nINSERT INTO \"SysAdminUnitInRole\" (\"SysAdminUnitId\", \"SysAdminUnitRoleId\")  \nSELECT DISTINCT UserId, \"Id\" FROM \"NewRoles\";  \n-- User managers after actualization  \nDROP TABLE IF EXISTS \"ManagersAfterActualization\";  \nCREATE TEMP TABLE \"ManagersAfterActualization\" (  \n\"Id\" UUID  \n);  \nINSERT INTO \"ManagersAfterActualization\"  \nSELECT DISTINCT  \n\"SysUserInRole\".\"SysUserId\" \"Id\"  \nFROM \"SysAdminUnitInRole\"  \nINNER JOIN \"SysAdminUnit\" \"Roles\"  \nON \"SysAdminUnitInRole\".\"SysAdminUnitRoleId\" = \"Roles\".\"Id\"  \nINNER JOIN \"NewRoles\" \"NewRoles\"  \nON \"Roles\".\"ParentRoleId\" = \"NewRoles\".\"Id\"  \nINNER JOIN \"SysUserInRole\"  \nON \"SysUserInRole\".\"SysRoleId\" = \"Roles\".\"Id\"  \nWHERE \"Roles\".\"SysAdminUnitTypeValue\" = 2;  \n-- New (who were not but become) user managers  \nDROP TABLE IF EXISTS \"NewManagers\";  \nCREATE TEMP TABLE \"NewManagers\" (  \n\"Id\" UUID  \n);  \nINSERT INTO \"NewManagers\"  \nSELECT \"Id\" FROM \"ManagersAfterActualization\" AS \"managersAfterActualization\"  \nWHERE NOT EXISTS (  \nSELECT NULL  \nFROM \"ManagersBeforeActualization\" AS \"managersBeforeActualization\"  \nWHERE \"managersBeforeActualization\".\"Id\" = \"managersAfterActualization\".\"Id\"  \n);  \n-- Add all user roles to new managers and their grantee-users, if they arent already have  \nFOR UserNewManager IN getUserNewManagers LOOP  \nEXIT WHEN UserNewManager = NULL;  \nINSERT INTO \"SysAdminUnitInRole\" (\"SysAdminUnitId\", \"SysAdminUnitRoleId\")  \nSELECT DISTINCT UserNewManager.\"Id\", \"Id\"  \nFROM \"NewRoles\" AS \"newRoles\"  \nWHERE NOT EXISTS (  \nSELECT 1  \nFROM \"SysAdminUnitInRole\"  \nWHERE \"SysAdminUnitInRole\".\"SysAdminUnitId\" = UserNewManager.\"Id\"  \nAND \"SysAdminUnitInRole\".\"SysAdminUnitRoleId\" = \"newRoles\".\"Id\"  \n);  \nEND LOOP;  \nSELECT COUNT(*) INTO lostUserRolesCount  \nFROM \"OldUserRoles\" AS \"oldUserRoles\"  \nWHERE NOT EXISTS (  \nSELECT 1  \nFROM \"NewRoles\" AS \"newUserRoles\"  \nWHERE \"newUserRoles\".\"Id\" = \"oldUserRoles\".\"Id\"  \n);  \n-- Still (who were and remained) user managers  \nDROP TABLE IF EXISTS \"StillManagers\";  \nCREATE TEMP TABLE \"StillManagers\" (  \n\"Id\" UUID  \n);  \nINSERT INTO \"StillManagers\"  \nSELECT DISTINCT \"managersAfterActualization\".\"Id\" AS \"Id\"  \nFROM \"ManagersAfterActualization\" AS \"managersAfterActualization\"  \nJOIN \"ManagersBeforeActualization\" AS \"managersBeforeActualization\"  \nON \"managersAfterActualization\".\"Id\" = \"managersBeforeActualization\".\"Id\";  \n-- If user lost at least one role, we need to actualize all his still-managers.  \n-- If not (user only gained new roles) - we just add to still-managers and their grantee-users new user roles.  \nIF lostUserRolesCount = 0 THEN  \n-- Add all new user roles to his still-managers and to their grantee-users  \nFOR UserStillManager IN getUserStillManagers LOOP  \nEXIT WHEN UserStillManager = NULL;  \nINSERT INTO \"SysAdminUnitInRole\" (\"SysAdminUnitId\", \"SysAdminUnitRoleId\")  \nSELECT DISTINCT UserStillManager.\"Id\", \"Id\"  \nFROM \"NewRoles\" AS \"newRoles\"  \nWHERE NOT EXISTS (  \nSELECT 1  \nFROM \"SysAdminUnitInRole\"  \nWHERE \"SysAdminUnitInRole\".\"SysAdminUnitId\" = UserStillManager.\"Id\"  \nAND \"SysAdminUnitInRole\".\"SysAdminUnitRoleId\" = \"newRoles\".\"Id\"  \n);  \nEND LOOP;  \nELSE  \n--Actualize all roles for still-managers  \nFOR UserStillManager IN getUserStillManagers LOOP  \nEXIT WHEN UserStillManager = NULL;  \nDELETE FROM \"SysAdminUnitRoles\";  \nINSERT INTO \"SysAdminUnitRoles\"  \nSELECT * FROM \"tsp_GetAdminUnitList\"(UserStillManager.\"Id\");  \nDELETE FROM \"SysAdminUnitInRole\" WHERE \"SysAdminUnitId\" = UserStillManager.\"Id\";  \nINSERT INTO \"SysAdminUnitInRole\" (\"SysAdminUnitId\", \"SysAdminUnitRoleId\")  \nSELECT UserStillManager.\"Id\", \"Id\" FROM \"SysAdminUnitRoles\";  \nEND LOOP;  \nEND IF;  \n-- No longer (who were but not remained) user managers  \nDROP TABLE IF EXISTS \"NoLongerManagers\";  \nCREATE TEMP TABLE \"NoLongerManagers\" (  \n\"Id\" UUID  \n);  \nINSERT INTO \"NoLongerManagers\"  \nSELECT \"Id\" FROM \"ManagersBeforeActualization\" AS \"managersBeforeActualization\"  \nWHERE NOT EXISTS (  \nSELECT NULL  \nFROM \"ManagersAfterActualization\" AS \"managersAfterActualization\"  \nWHERE \"managersAfterActualization\".\"Id\" = \"managersBeforeActualization\".\"Id\"  \n);  \n-- Actualize roles for all noLonger-managers, his grantee-users and all grantee-users of user  \nFOR UserNoLongerManager IN getUserNoLongerManagers LOOP  \nEXIT WHEN UserNoLongerManager = NULL;  \nDELETE FROM \"SysAdminUnitRoles\";  \nINSERT INTO \"SysAdminUnitRoles\"  \nSELECT * FROM \"tsp_GetAdminUnitList\"(UserNoLongerManager.\"Id\");  \nDELETE FROM \"SysAdminUnitInRole\"  \nWHERE \"SysAdminUnitId\" = UserNoLongerManager.\"Id\";  \nINSERT INTO \"SysAdminUnitInRole\" (\"SysAdminUnitId\", \"SysAdminUnitRoleId\")  \nSELECT UserNoLongerManager.\"Id\", \"Id\" FROM \"SysAdminUnitRoles\";  \nEND LOOP;  \nDROP TABLE IF EXISTS \"GetAdminUnitListTmp\";  \nEND;  \n$$ LANGUAGE plpgsql;  \n## Example 4 (stored procedures)\u200b\nExample\nExample of a recursive stored procedure that returns a table and uses `PERFORM`.\n-- Recursive stored procedure that returns a table and uses PERFORM:  \n-- MSSQL  \nIF NOT OBJECT_ID('[dbo].[tsp_GetAdminUnitList]') IS NULL  \nBEGIN  \nDROP PROCEDURE [dbo].[tsp_GetAdminUnitList];  \nEND;  \nGO  \nCREATE PROCEDURE dbo.tsp_GetAdminUnitList (  \n@UserId uniqueidentifier, @Granted BIT = 0  \n)  \nAS  \nBEGIN  \nSET NOCOUNT ON;  \nDECLARE @StartNestedLevel INT;  \nIF object_id('tempdb..#AdminUnitList') IS NULL  \nBEGIN  \nCREATE TABLE [#AdminUnitList]  \n(  \n[Id] uniqueidentifier NOT NULL,  \n[Name] NVARCHAR(250) NULL,  \n[ParentRoleId] uniqueidentifier NULL,  \n[Granted] BIT NULL,  \nLevel INT NOT NULL  \n);  \nSET @StartNestedLevel = @@NESTLEVEL;  \nEND;  \nDECLARE @ConnectionType INT = (SELECT [ConnectionType] FROM SysAdminUnit WHERE [Id] = @UserId);  \n-- #AdminUnitListTemp should be created in tsp_ActualizeUserRoles or in tsp_ActualizeAdminUnitInRole  \nDECLARE @IsAdminUnitListTempExists BIT = OBJECT_ID('tempdb..#AdminUnitListTemp');  \nIF (@IsAdminUnitListTempExists IS NULL)  \nBEGIN  \nWITH  \n[MainSelect] AS (  \nSELECT  \n[Id] [Id],  \n[Name] [Name],  \n[ParentRoleId] [ParentRoleId]  \nFROM  \n[dbo].[SysAdminUnit]  \nWHERE  \n([SysAdminUnitTypeValue] <= 4 OR [SysAdminUnitTypeValue] = 6)  \nAND [ConnectionType] = @ConnectionType  \nUNION ALL  \nSELECT  \n[Id] [Id],  \n[Name] [Name],  \n[ParentRoleId] [ParentRoleId]  \nFROM  \n[dbo].[SysAdminUnit]  \nWHERE  \n[Id] = @UserId),  \n[ChiefUnitsSelect] AS (  \n(  \nSELECT  \n[Chief].[ParentRoleId] [Id]  \nFROM  \n[dbo].[SysUserInRole] userInRole  \nINNER JOIN [dbo].[SysAdminUnit] sau ON (sau.[Id] = userInRole.[SysUserId])  \nINNER JOIN [dbo].[SysAdminUnit] [Chief] ON ([Chief].[Id] = userInRole.[SysRoleId])  \nWHERE  \nsau.[Id] = @UserId AND NOT (userInRole.[SysRoleId] IS NULL) AND [Chief].[SysAdminUnitTypeValue] = 2  \nUNION ALL  \nSELECT  \n[Chief].[ParentRoleId] [Id]  \nFROM  \n[dbo].[SysAdminUnit] [Chief]  \nWHERE  \n[Chief].[Id] = @UserId AND [Chief].[SysAdminUnitTypeValue] = 2  \n)  \nUNION ALL  \nSELECT  \nsau.[Id]  \nFROM  \n[ChiefUnitsSelect]  \nINNER JOIN [dbo].[SysAdminUnit] sau ON (sau.[ParentRoleId] = [ChiefUnitsSelect].[Id])  \nWHERE  \nsau.[SysAdminUnitTypeValue] < 4  \n),  \n[HierarchicalSelect] AS (  \nSELECT  \n[Id],  \n[Name],  \n[ParentRoleId],  \n0 [Level]  \nFROM  \n[MainSelect] [SelectStartLevel]  \nWHERE  \n[Id] IN (  \nSELECT  \nuserInRole.[SysRoleId]  \nFROM  \n[dbo].[SysUserInRole] userInRole  \nINNER JOIN [dbo].[SysAdminUnit] sau ON (sau.[Id] = userInRole.[SysUserId])  \nWHERE  \nsau.[Id] = @UserId  \nUNION ALL  \nSELECT [Id] FROM [ChiefUnitsSelect]  \nUNION ALL  \nSELECT  \n[Id]  \nFROM  \n[dbo].[SysAdminUnit]  \nWHERE  \n([ParentRoleId] IS NULL OR [Id] = @UserId)  \nAND [SysAdminUnitTypeValue] < 4  \nUNION ALL  \nSELECT  \n[FuncRoleId]  \nFROM  \n[dbo].[SysFuncRoleInOrgRole]  \nWHERE  \n[SysFuncRoleInOrgRole].[OrgRoleId] = @UserId  \n)  \nUNION ALL  \nSELECT  \n[SelectPriorLevel].[Id],  \n[SelectPriorLevel].[Name],  \n[SelectPriorLevel].[ParentRoleId],  \n[Level] + 1 level  \nFROM  \n[MainSelect] [SelectPriorLevel]  \nINNER JOIN [HierarchicalSelect] hierSelect ON (hierSelect.[ParentRoleId] = [SelectPriorLevel].[Id])  \n),  \n[FuncRoleHierarchicalSelect] AS (  \nSELECT  \n[Id],  \n[Name],  \n[ParentRoleId],  \n0 [Level]  \nFROM  \n[MainSelect] [StartLevel]  \nWHERE EXISTS (  \nSELECT NULL  \nFROM [dbo].[SysFuncRoleInOrgRole] funcRoleInOrgRole  \nINNER JOIN [HierarchicalSelect] hierSelect ON funcRoleInOrgRole.[OrgRoleId] = hierSelect.[Id]  \nWHERE funcRoleInOrgRole.[FuncRoleId] = [StartLevel].[Id]  \n)  \nUNION ALL  \nSELECT  \n[PriorLevel].[Id],  \n[PriorLevel].[Name],  \n[PriorLevel].[ParentRoleId],  \n[Level] + 1 level  \nFROM  \n[MainSelect] [PriorLevel]  \nINNER JOIN [FuncRoleHierarchicalSelect] funcRoleHierSelect ON (funcRoleHierSelect.[ParentRoleId] = [PriorLevel].[Id])  \n),  \n[DependentUserSelect] AS (  \nSELECT  \nmainSelect.[Id] [Id],  \nmainSelect.[Name] [Name],  \nmainSelect.[ParentRoleId] [ParentRoleId],  \n0 [Level]  \nFROM  \n[MainSelect] mainSelect  \nINNER JOIN [SysUserInRole] userInRole  \nON mainSelect.[Id] = userInRole.[SysUserId]  \nINNER JOIN [ChiefUnitsSelect] [AllUnits]  \nON [AllUnits].[Id] = userInRole.[SysRoleId]  \nWHERE  \nNOT EXISTS (  \nSELECT  \n[UserUnits].[Id]  \nFROM [ChiefUnitsSelect] [UserUnits]  \nINNER JOIN [SysUserInRole] [UserInRole]  \nON [UserUnits].[Id] = [UserInRole].[SysRoleId]  \nINNER JOIN [SysAdminUnit] sau  \nON sau.[Id] = [UserUnits].[Id]  \nWHERE sau.[SysAdminUnitTypeValue] = 2  \nAND [UserInRole].[SysUserId] = @UserId  \nAND [UserUnits].[Id] = [AllUnits].[Id])  \n)  \nINSERT INTO [#AdminUnitList] ([Id], [Name], [ParentRoleId], [Granted], [Level])  \nSELECT DISTINCT  \n[Id],  \n[Name],  \n[ParentRoleId],  \n@Granted,  \n@@NESTLEVEL  \nFROM  \n(  \nSELECT  \n[Id],  \n[Name],  \n[ParentRoleId]  \nFROM  \n[HierarchicalSelect]  \nUNION ALL  \nSELECT  \n[Id],  \n[Name],  \n[ParentRoleId]  \nFROM  \n[dbo].[SysAdminUnit]  \nWHERE  \n[Id] = @UserId  \nUNION ALL  \nSELECT  \n[Id],  \n[Name],  \n[ParentRoleId]  \nFROM  \n[FuncRoleHierarchicalSelect]  \nUNION ALL  \nSELECT  \n[Id],  \n[Name],  \n[ParentRoleId]  \nFROM  \n[DependentUserSelect]  \n) [AdminUnitList];  \nEND ELSE  \nBEGIN  \nDECLARE @alreadyGotRolesForThisUser bit = 0;  \nIF (@IsAdminUnitListTempExists = 1)  \nBEGIN  \nSET @alreadyGotRolesForThisUser = (SELECT CAST( CASE WHEN EXISTS(SELECT 1 FROM [#AdminUnitListTemp]  \nWHERE [UserId] = @UserId  \n)  \nTHEN 1  \nELSE 0  \nEND  \nAS BIT));  \nEND;  \nIF (@alreadyGotRolesForThisUser = 1)  \nBEGIN  \nINSERT INTO [#AdminUnitList] ([Id], [Name], [ParentRoleId], [Granted], [Level])  \nSELECT DISTINCT  \n[Id],  \n[Name],  \n[ParentRoleId],  \n@Granted,  \n@@NESTLEVEL  \nFROM [#AdminUnitListTemp] WHERE UserId = @UserId;  \nEND ELSE  \nBEGIN  \nWITH  \n[MainSelect] AS (  \nSELECT  \n[Id] [Id],  \n[Name] [Name],  \n[ParentRoleId] [ParentRoleId]  \nFROM  \n[dbo].[SysAdminUnit]  \nWHERE  \n([SysAdminUnitTypeValue] <= 4 OR [SysAdminUnitTypeValue] = 6)  \nAND [ConnectionType] = @ConnectionType  \nUNION ALL  \nSELECT  \n[Id] [Id],  \n[Name] [Name],  \n[ParentRoleId] [ParentRoleId]  \nFROM  \n[dbo].[SysAdminUnit]  \nWHERE  \n[Id] = @UserId),  \n[ChiefUnitsSelect] AS (  \n(  \nSELECT  \n[Chief].[ParentRoleId] [Id]  \nFROM  \n[dbo].[SysUserInRole] sysUserInRole  \nINNER JOIN [dbo].[SysAdminUnit] sau ON (sau.[Id] = sysUserInRole.[SysUserId])  \nINNER JOIN [dbo].[SysAdminUnit] [Chief] ON ([Chief].[Id] = sysUserInRole.[SysRoleId])  \nWHERE  \nsau.[Id] = @UserId AND NOT (sysUserInRole.[SysRoleId] IS NULL) AND [Chief].[SysAdminUnitTypeValue] = 2  \nUNION ALL  \nSELECT  \n[Chief].[ParentRoleId] [Id]  \nFROM  \n[dbo].[SysAdminUnit] [Chief]  \nWHERE  \n[Chief].[Id] = @UserId AND [Chief].[SysAdminUnitTypeValue] = 2  \n)  \nUNION ALL  \nSELECT  \nsau.[Id]  \nFROM  \n[ChiefUnitsSelect] ChiefUnitsSelect  \nINNER JOIN [dbo].[SysAdminUnit] sau ON (sau.[ParentRoleId] = [ChiefUnitsSelect].[Id])  \nWHERE  \nsau.[SysAdminUnitTypeValue] < 4  \n),  \n[HierarchicalSelect] AS (  \nSELECT  \n[Id],  \n[Name],  \n[ParentRoleId],  \n0 [Level]  \nFROM  \n[MainSelect] [SelectStartLevel]  \nWHERE EXISTS (  \nSELECT NULL  \nFROM (  \nSELECT [SysUserInRole].[SysRoleId] AS RoleId  \nFROM [dbo].[SysUserInRole]  \nINNER JOIN [dbo].[SysAdminUnit] ON ([SysAdminUnit].[Id] = [SysUserInRole].[SysUserId])  \nWHERE [SysAdminUnit].[Id] = @UserId  \nUNION ALL  \nSELECT [Id] AS RoleId  \nFROM [ChiefUnitsSelect]  \nUNION ALL  \nSELECT [Id] AS RoleId  \nFROM [dbo].[SysAdminUnit]  \nWHERE ([ParentRoleId] IS NULL OR [Id] = @UserId)  \nAND [SysAdminUnitTypeValue] < 4  \nUNION ALL  \nSELECT [FuncRoleId] AS RoleId  \nFROM [dbo].[SysFuncRoleInOrgRole]  \nWHERE [SysFuncRoleInOrgRole].[OrgRoleId] = @UserId  \n) AS Roles  \nWHERE Roles.RoleId = [SelectStartLevel].[Id]  \n)  \nUNION ALL  \nSELECT  \n[SelectPriorLevel].[Id],  \n[SelectPriorLevel].[Name],  \n[SelectPriorLevel].[ParentRoleId],  \n[Level] + 1 level  \nFROM  \n[MainSelect] [SelectPriorLevel]  \nINNER JOIN [HierarchicalSelect] hierSelect ON (hierSelect.[ParentRoleId] = [SelectPriorLevel].[Id])  \n),  \n[FuncRoleHierarchicalSelect] AS (  \nSELECT  \n[Id],  \n[Name],  \n[ParentRoleId],  \n0 [Level]  \nFROM  \n[MainSelect] [StartLevel]  \nWHERE EXISTS (  \nSELECT NULL  \nFROM [dbo].[SysFuncRoleInOrgRole] funcRoleInOrgRole  \nINNER JOIN [HierarchicalSelect] hierSelect ON funcRoleInOrgRole.[OrgRoleId] = hierSelect.[Id]  \nWHERE funcRoleInOrgRole.[FuncRoleId] = [StartLevel].[Id]  \n)  \nUNION ALL  \nSELECT  \n[PriorLevel].[Id],  \n[PriorLevel].[Name],  \n[PriorLevel].[ParentRoleId],  \n[Level] + 1  \nFROM  \n[MainSelect] [PriorLevel]  \nINNER JOIN [FuncRoleHierarchicalSelect] funcRolesHierSelect ON (funcRolesHierSelect.[ParentRoleId] = [PriorLevel].[Id])  \n),  \n[DependentUserSelect] AS (  \nSELECT  \n[MainSelect].[Id] [Id],  \n[MainSelect].[Name] [Name],  \n[MainSelect].[ParentRoleId] [ParentRoleId],  \n0 [Level]  \nFROM  \n[MainSelect]  \nINNER JOIN [SysUserInRole] sysUserInRole  \nON [MainSelect].[Id] = sysUserInRole.[SysUserId]  \nINNER JOIN [ChiefUnitsSelect] [AllUnits]  \nON [AllUnits].[Id] = sysUserInRole.[SysRoleId]  \nWHERE  \nNOT EXISTS (  \nSELECT  \n[UserUnits].[Id]  \nFROM [ChiefUnitsSelect] [UserUnits]  \nINNER JOIN [SysUserInRole] [UserInRole]  \nON [UserUnits].[Id] = [UserInRole].[SysRoleId]  \nINNER JOIN [SysAdminUnit] sau  \nON sau.[Id] = [UserUnits].[Id]  \nWHERE sau.[SysAdminUnitTypeValue] = 2  \nAND [UserInRole].[SysUserId] = @UserId  \nAND [UserUnits].[Id] = [AllUnits].[Id])  \n)  \nINSERT INTO #AdminUnitListTemp ([UserId], [Id], [Name], [ParentRoleId], [Granted])  \nSELECT DISTINCT  \n@UserId,  \n[Id],  \n[Name],  \n[ParentRoleId],  \n@Granted  \nFROM  \n(  \nSELECT  \n[Id],  \n[Name],  \n[ParentRoleId]  \nFROM  \n[HierarchicalSelect]  \nUNION ALL  \nSELECT  \n[Id],  \n[Name],  \n[ParentRoleId]  \nFROM  \n[dbo].[SysAdminUnit]  \nWHERE  \n[Id] = @UserId  \nUNION ALL  \nSELECT  \n[Id],  \n[Name],  \n[ParentRoleId]  \nFROM  \n[FuncRoleHierarchicalSelect]  \nUNION ALL  \nSELECT  \n[Id],  \n[Name],  \n[ParentRoleId]  \nFROM  \n[DependentUserSelect]  \n) [AdminUnitList];  \nINSERT INTO [#AdminUnitList] ([Id], [Name], [ParentRoleId], [Granted], [Level])  \nSELECT DISTINCT  \n[Id],  \n[Name],  \n[ParentRoleId],  \n@Granted,  \n@@NESTLEVEL  \nFROM [#AdminUnitListTemp] WHERE UserId = @UserId;  \nEND;  \nEND;  \nDECLARE @DependentUserId uniqueidentifier;  \nDECLARE @DependentUsersList CURSOR;  \nSET @DependentUsersList = CURSOR FOR  \nSELECT  \n[#AdminUnitList].[Id]  \nFROM  \n[#AdminUnitList]  \nINNER JOIN [SysAdminUnit] ON [#AdminUnitList].[Id] = [SysAdminUnit].[Id]  \nWHERE  \n[SysAdminUnit].[SysAdminUnitTypeValue] = 4 AND [#AdminUnitList].[Id] <> @UserId  \nAND [#AdminUnitList].[Granted] <> 1 AND [#AdminUnitList].[Level] >= @@NESTLEVEL;  \nOPEN @DependentUsersList;  \nFETCH NEXT  \nFROM @DependentUsersList INTO @DependentUserId;  \nWHILE @@FETCH_STATUS = 0  \nBEGIN  \nEXEC [tsp_GetAdminUnitList] @UserId=@DependentUserId, @Granted=1;  \nFETCH NEXT  \nFROM @DependentUsersList INTO @DependentUserId;  \nEND;  \nCLOSE @DependentUsersList;  \nDEALLOCATE @DependentUsersList;  \nDECLARE @GrantorSysAdminUnitId uniqueidentifier;  \nDECLARE @getGrantorSysAdminUnitList CURSOR;  \nSET @getGrantorSysAdminUnitList = CURSOR FOR  \nSELECT  \n[GrantorSysAdminUnitId]  \nFROM  \n[dbo].[SysAdminUnitGrantedRight]  \nWHERE  \n[GranteeSysAdminUnitId] = @UserId  \nAND NOT EXISTS(SELECT * FROM [#AdminUnitList] WHERE [Id] = @UserId AND [Granted] = 1 AND [Level] < @@NESTLEVEL);  \nOPEN @getGrantorSysAdminUnitList;  \nFETCH NEXT  \nFROM @getGrantorSysAdminUnitList INTO @GrantorSysAdminUnitId;  \nWHILE @@FETCH_STATUS = 0  \nBEGIN  \nEXEC [tsp_GetAdminUnitList] @UserId=@GrantorSysAdminUnitId, @Granted=1;  \nFETCH NEXT  \nFROM @getGrantorSysAdminUnitList INTO @GrantorSysAdminUnitId;  \nEND;  \nCLOSE @getGrantorSysAdminUnitList;  \nDEALLOCATE @getGrantorSysAdminUnitList;  \nIF @@NESTLEVEL = @StartNestedLevel  \nBEGIN  \nWITH QQ ([Id], [Name], [ParentRoleId], SysAdminUnitTypeValue) as (  \nSELECT DISTINCT adminUnitList.[Id],  \nadminUnitList.[Name],  \nadminUnitList.[ParentRoleId],  \nsau.SysAdminUnitTypeValue  \nFROM [#AdminUnitList] adminUnitList  \nINNER JOIN SysAdminUnit sau on sau.Id = adminUnitList.[Id]  \n)  \nSELECT [Id], [Name], [ParentRoleId] FROM QQ  \nORDER BY SysAdminUnitTypeValue DESC;  \nEND;  \nEND;  \nGO  \n-- Recursive stored procedure that returns a table and uses PERFORM:  \n-- PostgreSQL  \nDROP FUNCTION IF EXISTS \"tsp_GetAdminUnitList\";  \nCREATE FUNCTION \"tsp_GetAdminUnitList\"(  \nUserId UUID,  \nIsGranted BOOLEAN = FALSE,  \nNestLevel INT = 0  \n)  \nRETURNS TABLE (  \n\"Id\" UUID,  \n\"Name\" VARCHAR(250),  \n\"ParentRoleId\" UUID  \n)  \nAS $$  \nDECLARE  \nConnectionType INT;  \nIsAdminUnitListTempExists BOOLEAN = FALSE;  \nDependentUserId UUID;  \nDependentUsersList CURSOR FOR  \nSELECT  \n\"AdminUnitList\".\"Id\"  \nFROM  \n\"AdminUnitList\"  \nINNER JOIN \"SysAdminUnit\" ON \"AdminUnitList\".\"Id\" = \"SysAdminUnit\".\"Id\"  \nWHERE  \n\"SysAdminUnit\".\"SysAdminUnitTypeValue\" = 4  \nAND \"AdminUnitList\".\"Id\" <> UserId  \nAND \"AdminUnitList\".\"Granted\" = FALSE  \nAND \"AdminUnitList\".\"Level\" >= NestLevel;  \nGrantorSysAdminUnitId UUID;  \nGetGrantorSysAdminUnitList CURSOR FOR  \nSELECT  \n\"GrantorSysAdminUnitId\" AS \"Id\"  \nFROM  \n\"SysAdminUnitGrantedRight\"  \nWHERE  \n\"GranteeSysAdminUnitId\" = UserId  \nAND NOT EXISTS (  \nSELECT *  \nFROM \"AdminUnitList\"  \nWHERE \"AdminUnitList\".\"Id\" = UserId  \nAND \"AdminUnitList\".\"Granted\" = TRUE  \nAND \"AdminUnitList\".\"Level\" < NestLevel  \n);  \nParentRoleId UUID = NULL;  \nBEGIN  \nIF NestLevel = 0 THEN  \nCREATE TEMPORARY TABLE IF NOT EXISTS \"AdminUnitList\" (  \n\"Id\" UUID,  \n\"Name\" VARCHAR(250),  \n\"ParentRoleId\" UUID,  \n\"Granted\" BOOLEAN,  \n\"Level\" INT  \n);  \nTRUNCATE TABLE \"AdminUnitList\";  \nEND IF;  \nSELECT \"ConnectionType\" INTO ConnectionType FROM \"SysAdminUnit\" WHERE \"SysAdminUnit\".\"Id\" = UserId;  \nWITH RECURSIVE \"MainSelect\" AS (  \nSELECT  \n\"SysAdminUnit\".\"Id\" \"Id\",  \n\"SysAdminUnit\".\"Name\" \"Name\",  \n\"SysAdminUnit\".\"ParentRoleId\" \"ParentRoleId\"  \nFROM  \n\"SysAdminUnit\"  \nWHERE  \n(\"SysAdminUnitTypeValue\" <= 4 OR \"SysAdminUnitTypeValue\" = 6)  \nAND \"ConnectionType\" = ConnectionType  \nUNION ALL  \nSELECT  \n\"SysAdminUnit\".\"Id\" \"Id\",  \n\"SysAdminUnit\".\"Name\" \"Name\",  \n\"SysAdminUnit\".\"ParentRoleId\" \"ParentRoleId\"  \nFROM  \n\"SysAdminUnit\"  \nWHERE  \n\"SysAdminUnit\".\"Id\" = UserId),  \n\"ChiefUnitsSelect\" AS (  \nSELECT  \n\"chief\".\"ParentRoleId\" \"Id\"  \nFROM  \n\"SysUserInRole\" AS \"userInRole\"  \nINNER JOIN \"SysAdminUnit\" AS \"sau\" ON (\"sau\".\"Id\" = \"userInRole\".\"SysUserId\")  \nINNER JOIN \"SysAdminUnit\" AS \"chief\" ON (\"chief\".\"Id\" = \"userInRole\".\"SysRoleId\")  \nWHERE  \n\"sau\".\"Id\" = UserId  \nAND \"userInRole\".\"SysRoleId\" IS NOT NULL  \nAND \"chief\".\"SysAdminUnitTypeValue\" = 2  \nUNION ALL  \nSELECT  \n\"chief\".\"ParentRoleId\" \"Id\"  \nFROM  \n\"SysAdminUnit\" \"chief\"  \nWHERE  \n\"chief\".\"Id\" = UserId AND \"chief\".\"SysAdminUnitTypeValue\" = 2  \nUNION ALL  \nSELECT  \n\"sau\".\"Id\"  \nFROM  \n\"ChiefUnitsSelect\"  \nINNER JOIN \"SysAdminUnit\" \"sau\" ON (\"sau\".\"ParentRoleId\" = \"ChiefUnitsSelect\".\"Id\")  \nWHERE  \n\"sau\".\"SysAdminUnitTypeValue\" < 4  \n),  \n\"HierarchicalSelect\" AS (  \nSELECT  \n\"SelectStartLevel\".\"Id\",  \n\"SelectStartLevel\".\"Name\",  \n\"SelectStartLevel\".\"ParentRoleId\",  \n0 \"Level\"  \nFROM  \n\"MainSelect\" \"SelectStartLevel\"  \nWHERE  \n\"SelectStartLevel\".\"Id\" IN (  \nSELECT  \n\"userInRole\".\"SysRoleId\"  \nFROM  \n\"SysUserInRole\" AS \"userInRole\"  \nINNER JOIN \"SysAdminUnit\" AS \"sau\" ON (\"sau\".\"Id\" = \"userInRole\".\"SysUserId\")  \nWHERE  \n\"sau\".\"Id\" = UserId  \nUNION ALL  \nSELECT \"ChiefUnitsSelect\".\"Id\"  \nFROM \"ChiefUnitsSelect\"  \nUNION ALL  \nSELECT  \n\"SysAdminUnit\".\"Id\"  \nFROM  \n\"SysAdminUnit\"  \nWHERE  \n(\"SysAdminUnit\".\"ParentRoleId\" IS NULL OR \"SysAdminUnit\".\"Id\" = UserId)  \nAND \"SysAdminUnitTypeValue\" < 4  \nUNION ALL  \nSELECT  \n\"FuncRoleId\"  \nFROM  \n\"SysFuncRoleInOrgRole\"  \nWHERE  \n\"SysFuncRoleInOrgRole\".\"OrgRoleId\" = UserId  \n)  \nUNION ALL  \nSELECT  \n\"SelectPriorLevel\".\"Id\",  \n\"SelectPriorLevel\".\"Name\",  \n\"SelectPriorLevel\".\"ParentRoleId\",  \n\"Level\" + 1 \"level\"  \nFROM  \n\"MainSelect\" \"SelectPriorLevel\"  \nINNER JOIN \"HierarchicalSelect\" AS \"hierSelect\" ON (\"hierSelect\".\"ParentRoleId\" = \"SelectPriorLevel\".\"Id\")  \n),  \n\"FuncRoleHierarchicalSelect\" AS (  \nSELECT  \n\"StartLevel\".\"Id\",  \n\"StartLevel\".\"Name\",  \n\"StartLevel\".\"ParentRoleId\",  \n0 \"Level\"  \nFROM  \n\"MainSelect\" \"StartLevel\"  \nWHERE EXISTS (  \nSELECT NULL  \nFROM \"SysFuncRoleInOrgRole\" AS \"funcRoleInOrgRole\"  \nINNER JOIN \"HierarchicalSelect\" AS \"hierSelect\" ON \"funcRoleInOrgRole\".\"OrgRoleId\" = \"hierSelect\".\"Id\"  \nWHERE \"funcRoleInOrgRole\".\"FuncRoleId\" = \"StartLevel\".\"Id\"  \n)  \nUNION ALL  \nSELECT  \n\"PriorLevel\".\"Id\",  \n\"PriorLevel\".\"Name\",  \n\"PriorLevel\".\"ParentRoleId\",  \n\"Level\" + 1 \"level\"  \nFROM  \n\"MainSelect\" \"PriorLevel\"  \nINNER JOIN \"FuncRoleHierarchicalSelect\" AS \"funcRoleHierSelect\" ON (\"funcRoleHierSelect\".\"ParentRoleId\" = \"PriorLevel\".\"Id\")  \n),  \n\"DependentUserSelect\" AS (  \nSELECT  \n\"mainSelect\".\"Id\" \"Id\",  \n\"mainSelect\".\"Name\" \"Name\",  \n\"mainSelect\".\"ParentRoleId\" \"ParentRoleId\",  \n0 \"Level\"  \nFROM  \n\"MainSelect\" AS \"mainSelect\"  \nINNER JOIN \"SysUserInRole\" AS \"userInRole\"  \nON \"mainSelect\".\"Id\" = \"userInRole\".\"SysUserId\"  \nINNER JOIN \"ChiefUnitsSelect\" AS \"AllUnits\"  \nON \"AllUnits\".\"Id\" = \"userInRole\".\"SysRoleId\"  \nWHERE  \nNOT EXISTS (  \nSELECT  \n\"UserUnits\".\"Id\"  \nFROM \"ChiefUnitsSelect\" AS \"UserUnits\"  \nINNER JOIN \"SysUserInRole\" AS \"UserInRole\"  \nON \"UserUnits\".\"Id\" = \"UserInRole\".\"SysRoleId\"  \nINNER JOIN \"SysAdminUnit\" AS \"sau\"  \nON \"sau\".\"Id\" = \"UserUnits\".\"Id\"  \nWHERE \"sau\".\"SysAdminUnitTypeValue\" = 2  \nAND \"UserInRole\".\"SysUserId\" = UserId  \nAND \"UserUnits\".\"Id\" = \"AllUnits\".\"Id\")  \n)  \nINSERT INTO \"AdminUnitList\" (\"Id\", \"Name\", \"ParentRoleId\", \"Granted\", \"Level\")  \nSELECT DISTINCT  \n\"AdminUnitList\".\"Id\",  \n\"AdminUnitList\".\"Name\",  \n\"AdminUnitList\".\"ParentRoleId\",  \nIsGranted,  \nNestLevel  \nFROM (  \nSELECT  \n\"HierarchicalSelect\".\"Id\",  \n\"HierarchicalSelect\".\"Name\",  \n\"HierarchicalSelect\".\"ParentRoleId\"  \nFROM \"HierarchicalSelect\"  \nUNION ALL  \nSELECT  \n\"SysAdminUnit\".\"Id\",  \n\"SysAdminUnit\".\"Name\",  \n\"SysAdminUnit\".\"ParentRoleId\"  \nFROM \"SysAdminUnit\"  \nWHERE  \n\"SysAdminUnit\".\"Id\" = UserId  \nUNION ALL  \nSELECT  \n\"FuncRoleHierarchicalSelect\".\"Id\",  \n\"FuncRoleHierarchicalSelect\".\"Name\",  \n\"FuncRoleHierarchicalSelect\".\"ParentRoleId\"  \nFROM \"FuncRoleHierarchicalSelect\"  \nUNION ALL  \nSELECT  \n\"DependentUserSelect\".\"Id\",  \n\"DependentUserSelect\".\"Name\",  \n\"DependentUserSelect\".\"ParentRoleId\"  \nFROM \"DependentUserSelect\"  \n) AS \"AdminUnitList\";  \nDependentUsersList := 'DependentUsersList' || NestLevel ;  \nFOR DependentUser IN DependentUsersList LOOP  \nEXIT WHEN DependentUser = NULL;  \nDependentUserId = DependentUser.\"Id\";  \nPERFORM \"tsp_GetAdminUnitList\"(DependentUserId, 1, NestLevel + 1);  \nEND LOOP;  \nGetGrantorSysAdminUnitList := 'GetGrantorSysAdminUnitList' || NestLevel ;  \nFOR GrantorSysAdminUnit IN GetGrantorSysAdminUnitList LOOP  \nEXIT WHEN GrantorSysAdminUnit = NULL;  \nGrantorSysAdminUnitId = GrantorSysAdminUnit.\"Id\";  \nPERFORM \"tsp_GetAdminUnitList\"(GrantorSysAdminUnitId, 1, NestLevel + 1);  \nEND LOOP;  \nIF NestLevel = 0 THEN  \nRETURN QUERY  \nSELECT \"QQ\".\"Id\",  \n\"QQ\".\"Name\",  \n\"QQ\".\"ParentRoleId\"  \nFROM (  \nSELECT DISTINCT  \n\"AdminUnitList\".\"Id\",  \n\"AdminUnitList\".\"Name\",  \n\"AdminUnitList\".\"ParentRoleId\",  \n\"sau\".\"SysAdminUnitTypeValue\"  \nFROM \"AdminUnitList\"  \nINNER JOIN \"SysAdminUnit\" AS \"sau\" ON \"sau\".\"Id\" = \"AdminUnitList\".\"Id\") AS \"QQ\"  \nORDER BY \"QQ\".\"SysAdminUnitTypeValue\" DESC;  \nEND IF;  \nEND;  \n$$ LANGUAGE plpgsql;  \n## Example 5 (stored procedures)\u200b\nExample\nExample of a stored procedure that uses exception handling and executes a custom script.\n-- Stored procedure that uses exception handling and executes a custom script  \n-- MSSQL  \nIF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[tsp_CanConvertData]') AND type IN (N'P', N'PC'))  \nDROP PROCEDURE [dbo].[tsp_CanConvertData]  \nGO  \nCREATE PROCEDURE [dbo].[tsp_CanConvertData]  \n@EntitySchemaName SYSNAME,  \n@SourceColumnName SYSNAME,  \n@NewColumnDataType SYSNAME,  \n@Result BIT OUT  \nAS  \nBEGIN  \nSET NOCOUNT ON  \nSET @Result = 0  \nDECLARE @sql NVARCHAR(MAX)  \nDECLARE @unicodeCharLength INT = 2  \nDECLARE @dataTypeName SYSNAME  \nDECLARE @dataTypeSize INT  \nDECLARE @dataTypePrecision INT  \nSELECT  \n@dataTypeName = UPPER(DATA_TYPE),  \n@dataTypeSize =  \nCASE  \nWHEN CHARACTER_MAXIMUM_LENGTH IS NULL THEN NUMERIC_PRECISION  \nELSE CHARACTER_MAXIMUM_LENGTH  \nEND,  \n@dataTypePrecision = ISNULL(NUMERIC_SCALE, 0)  \nFROM INFORMATION_SCHEMA.COLUMNS  \nWHERE TABLE_NAME = @EntitySchemaName  \nAND COLUMN_NAME = @SourceColumnName  \nIF (@dataTypeName IS NULL)  \nBEGIN  \nRETURN  \nEND  \nDECLARE @newDataTypeName SYSNAME  \nDECLARE @newDataTypeSize INT  \nDECLARE @newDataTypePrecision INT  \nDEClARE @i INT  \nDECLARE @newDataTypeSizeDefinition NVARCHAR(MAX)  \nSET @i = CHARINDEX('(', @NewColumnDataType)  \nIF (@i = 0)  \nBEGIN  \nSET @newDataTypeName = @NewColumnDataType  \nSET @newDataTypeSize = 0  \nSET @newDataTypePrecision = 0  \nEND ELSE  \nBEGIN  \nSET @newDataTypeName = UPPER(LTRIM(RTRIM(SUBSTRING(@NewColumnDataType, 1, @i - 1))))  \nSET @newDataTypeSizeDefinition = LTRIM(RTRIM(SUBSTRING(@NewColumnDataType, @i + 1,  \nLEN(@NewColumnDataType))))  \nSET @i = CHARINDEX(')', @newDataTypeSizeDefinition)  \nIF (@i > 0)  \nBEGIN  \nSET @newDataTypeSizeDefinition = LTRIM(RTRIM(SUBSTRING(@newDataTypeSizeDefinition, 1, @i - 1)))  \nEND  \nSET @i = CHARINDEX(',', @newDataTypeSizeDefinition)  \nIF (@i > 0)  \nBEGIN  \nSET @newDataTypeSize = CAST(LTRIM(RTRIM(SUBSTRING(@newDataTypeSizeDefinition, 1, @i - 1))) AS INT)  \nSET @newDataTypePrecision = CAST(LTRIM(RTRIM(SUBSTRING(@newDataTypeSizeDefinition, @i + 1,  \nLEN(@newDataTypeSizeDefinition)))) AS INT)  \nEND ELSE  \nBEGIN  \nSET @newDataTypePrecision = 0  \nIF (UPPER(@newDataTypeSizeDefinition) = 'MAX')  \nBEGIN  \nSET @newDataTypeSize = -1  \nEND ELSE  \nBEGIN  \nSET @newDataTypeSize = CAST(@newDataTypeSizeDefinition AS INT)  \nEND  \nEND  \nEND  \nDECLARE @ImplicitDataConvertTable TABLE (  \nSourceDataType SYSNAME,  \nDestinationDataType SYSNAME  \n)  \nINSERT INTO @ImplicitDataConvertTable  \nSELECT 'INT', 'INT'  \nUNION ALL  \nSELECT 'INT', 'BIT'  \nUNION ALL  \nSELECT 'INT', 'DECIMAL'  \nUNION ALL  \nSELECT 'INT', 'VARCHAR'  \nUNION ALL  \nSELECT 'INT', 'NVARCHAR'  \nUNION ALL  \nSELECT 'INT', 'VARBINARY'  \nUNION ALL  \nSELECT 'BIT', 'BIT'  \nUNION ALL  \nSELECT 'BIT', 'INT'  \nUNION ALL  \nSELECT 'BIT', 'DECIMAL'  \nUNION ALL  \nSELECT 'BIT', 'VARCHAR'  \nUNION ALL  \nSELECT 'BIT', 'NVARCHAR'  \nUNION ALL  \nSELECT 'BIT', 'VARBINARY'  \nUNION ALL  \nSELECT 'DECIMAL', 'BIT'  \nUNION ALL  \nSELECT 'UNIQUEIDENTIFIER', 'UNIQUEIDENTIFIER'  \nUNION ALL  \nSELECT 'UNIQUEIDENTIFIER', 'VARBINARY'  \nUNION ALL  \nSELECT 'VARCHAR', 'INT'  \nUNION ALL  \nSELECT 'VARCHAR', 'BIT'  \nUNION ALL  \nSELECT 'VARCHAR', 'UNIQUEIDENTIFIER'  \nUNION ALL  \nSELECT 'DATETIME2', 'DATETIME2'  \nUNION ALL  \nSELECT 'DATETIME2', 'DATE'  \nUNION ALL  \nSELECT 'DATETIME2', 'TIME'  \nUNION ALL  \nSELECT 'DATETIME2', 'VARCHAR'  \nUNION ALL  \nSELECT 'DATE', 'DATE'  \nUNION ALL  \nSELECT 'DATE', 'DATETIME2'  \nUNION ALL  \nSELECT 'DATE', 'VARCHAR'  \nUNION ALL  \nSELECT 'DATE', 'NVARCHAR'  \nUNION ALL  \nSELECT 'TIME', 'TIME'  \nUNION ALL  \nSELECT 'TIME', 'DATETIME2'  \nUNION ALL  \nSELECT 'TIME', 'VARCHAR'  \nUNION ALL  \nSELECT 'TIME', 'NVARCHAR'  \nUNION ALL  \nSELECT 'VARBINARY', 'INT'  \nUNION ALL  \nSELECT 'VARBINARY', 'BIT'  \nUNION ALL  \nSELECT 'VARBINARY', 'UNIQUEIDENTIFIER'  \nIF EXISTS(SELECT * FROM @ImplicitDataConvertTable  \nWHERE SourceDataType = @dataTypeName AND DestinationDataType = @newDataTypeName)  \nBEGIN  \nSET @Result = 1  \nRETURN  \nEND  \nDECLARE @ImplicitDataOverflowConvertTable TABLE (  \nSourceDataType SYSNAME,  \nDestinationDataType SYSNAME  \n)  \nINSERT INTO @ImplicitDataOverflowConvertTable  \nSELECT 'DECIMAL', 'INT'  \nUNION ALL  \nSELECT 'DECIMAL', 'DECIMAL'  \nUNION ALL  \nSELECT 'DECIMAL', 'VARCHAR'  \nUNION ALL  \nSELECT 'DECIMAL', 'NVARCHAR'  \nUNION ALL  \nSELECT 'DECIMAL', 'VARBINARY'  \nUNION ALL  \nSELECT 'UNIQUEIDENTIFIER', 'VARCHAR'  \nUNION ALL  \nSELECT 'UNIQUEIDENTIFIER', 'NVARCHAR'  \nUNION ALL  \nSELECT 'VARCHAR', 'INT'  \nUNION ALL  \nSELECT 'VARCHAR', 'BIT'  \nUNION ALL  \nSELECT 'VARCHAR', 'DECIMAL'  \nUNION ALL  \nSELECT 'VARCHAR', 'VARCHAR'  \nUNION ALL  \nSELECT 'VARCHAR', 'NVARCHAR'  \nUNION ALL  \nSELECT 'NVARCHAR', 'INT'  \nUNION ALL  \nSELECT 'NVARCHAR', 'BIT'  \nUNION ALL  \nSELECT 'NVARCHAR', 'DECIMAL'  \nUNION ALL  \nSELECT 'NVARCHAR', 'VARCHAR'  \nUNION ALL  \nSELECT 'NVARCHAR', 'NVARCHAR'  \nUNION ALL  \nSELECT 'VARBINARY', 'VARCHAR'  \nUNION ALL  \nSELECT 'VARBINARY', 'NVARCHAR'  \nUNION ALL  \nSELECT 'VARBINARY', 'VARBINARY'  \nIF EXISTS(SELECT * FROM @ImplicitDataOverflowConvertTable  \nWHERE SourceDataType = @dataTypeName AND DestinationDataType = @newDataTypeName)  \nBEGIN  \nSET @sql = N'IF EXISTS(SELECT * FROM [' + @EntitySchemaName + ']) SET @Result = 0 ELSE SET @Result = 1'  \nEXEC sp_executesql @sql, N'@Result BIT OUT', @Result = @Result OUT  \nIF (@Result = 1)  \nBEGIN  \nRETURN  \nEND  \nBEGIN TRY  \nIF (@dataTypeName = 'DECIMAL' AND @newDataTypeName = 'INT') OR  \n(@dataTypeName = 'DECIMAL' AND @newDataTypeName = 'VARCHAR') OR  \n(@dataTypeName = 'DECIMAL' AND @newDataTypeName = 'NVARCHAR') OR  \n(@dataTypeName = 'DECIMAL' AND @newDataTypeName = 'VARBINARY') OR  \n(@dataTypeName = 'DECIMAL' AND @newDataTypeName = 'DECIMAL')  \nBEGIN  \nDECLARE @cnt INT  \nDECLARE @ConvertDescription NVARCHAR(MAX)  \nSET @ConvertDescription = 'CONVERT(' + @NewColumnDataType +', [' + @SourceColumnName+ '])'  \nSET @sql = N'IF EXISTS(SELECT * FROM [' + @EntitySchemaName + '] WHERE ' +  \n@ConvertDescription + ' = ' + @ConvertDescription + ') SET @cnt = 1 ELSE SET @cnt = 0'  \nEXEC sp_executesql @sql, N'@cnt INT OUT', @cnt = @cnt OUT  \nSET @Result = 1  \nEND ELSE  \nBEGIN  \nDECLARE @dl INT  \nSET @sql = N'SELECT @dl = MAX(DATALENGTH([' + @SourceColumnName + '])) ' +  \n'FROM [' + @EntitySchemaName + ']'  \nEXEC sp_executesql @sql, N'@dl INT OUT', @dl = @dl OUT  \nIF (@newDataTypeName IN ('VARCHAR', 'NVARCHAR', 'VARBINARY') AND @newDataTypeSize = -1)  \nBEGIN  \nSET @Result = 1  \nEND ELSE  \nIF (@dl <= @newDataTypeSize OR (  \n@newDataTypeName IN ('NVARCHAR', 'NCHAR') AND (@dl / @unicodeCharLength) <= @newDataTypeSize))  \nBEGIN  \nSET @Result = 1  \nEND ELSE  \nBEGIN  \nSET @Result = 0  \nEND  \nEND  \nEND TRY  \nBEGIN CATCH  \nSET @Result = 0  \nEND CATCH  \nEND ELSE  \nBEGIN  \nSET @Result = 0  \nEND  \nEND  \nGO  \n-- Stored procedure that uses exception handling and executes a custom scrip  \n-- PostgreSQL  \nDROP FUNCTION IF EXISTS public.\"tsp_CanConvertData\" CASCADE;  \nCREATE FUNCTION public.\"tsp_CanConvertData\"(  \nEntitySchemaName NAME,  \nSourceColumnName NAME,  \nNewColumnDataType NAME,  \nCanConvert OUT BOOLEAN)  \nAS $BODY$  \nDECLARE  \ndataTypeName NAME;  \nnewDataTypeName NAME;  \nnewDataTypeSize INTEGER;  \ncountRow INTEGER;  \ndataLength INTEGER;  \nconvertDescription TEXT;  \nunicodeCharLength INTEGER = 2;  \nsqlQuery TEXT;  \ncastQuery TEXT;  \nBEGIN  \nCanConvert = FALSE;  \ndataTypeName = (  \nSELECT UPPER(data_type) FROM information_schema.columns  \nWHERE table_name = EntitySchemaName AND column_name = SourceColumnName);  \nIF dataTypeName IS NULL THEN  \nRETURN;  \nEND IF;  \nSELECT \"fn_ParseDataType\".DataTypeName, \"fn_ParseDataType\".DataTypeSize  \nFROM public.\"fn_ParseDataType\"(NewColumnDataType)  \nINTO newDataTypeName, newDataTypeSize;  \nDROP TABLE IF EXISTS \"NotConvertTable\";  \nCREATE TEMP TABLE \"NotConvertTable\" (  \nSourceDataType NAME,  \nDestinationDataType NAME  \n);  \nINSERT INTO \"NotConvertTable\" VALUES  \n('INTEGER', 'UUID'),  \n('INTEGER', 'TIMESTAMP WITHOUT TIME ZONE'),  \n('INTEGER', 'DATE'),  \n('INTEGER', 'TIME WITHOUT TIME ZONE'),  \n('NUMERIC', 'UUID'),  \n('NUMERIC', 'TIMESTAMP WITHOUT TIME ZONE'),  \n('NUMERIC', 'DATE'),  \n('NUMERIC', 'TIME WITHOUT TIME ZONE'),  \n('BOOLEAN', 'UUID'),  \n('BOOLEAN', 'TIMESTAMP WITHOUT TIME ZONE'),  \n('BOOLEAN', 'DATE'),  \n('BOOLEAN', 'TIME WITHOUT TIME ZONE'),  \n('UUID', 'INTEGER'),  \n('UUID', 'NUMERIC'),  \n('UUID', 'BOOLEAN'),  \n('UUID', 'TIMESTAMP WITHOUT TIME ZONE'),  \n('UUID', 'DATE'),  \n('UUID', 'TIME WITHOUT TIME ZONE'),  \n('TIMESTAMP WITHOUT TIME ZONE', 'INTEGER'),  \n('TIMESTAMP WITHOUT TIME ZONE', 'NUMERIC'),  \n('TIMESTAMP WITHOUT TIME ZONE', 'BOOLEAN'),  \n('TIMESTAMP WITHOUT TIME ZONE', 'UUID'),  \n('DATE', 'INTEGER'),  \n('DATE', 'NUMERIC'),  \n('DATE', 'BOOLEAN'),  \n('DATE', 'UUID'),  \n('DATE', 'TIME WITHOUT TIME ZONE'),  \n('TIME WITHOUT TIME ZONE', 'INTEGER'),  \n('TIME WITHOUT TIME ZONE', 'NUMERIC'),  \n('TIME WITHOUT TIME ZONE', 'BOOLEAN'),  \n('TIME WITHOUT TIME ZONE', 'UUID'),  \n('TIME WITHOUT TIME ZONE', 'DATE');  \nIF EXISTS(SELECT SourceDataType, DestinationDataType FROM \"NotConvertTable\"  \nWHERE SourceDataType = dataTypeName AND DestinationDataType = newDataTypeName) THEN  \nRETURN;  \nEND IF;  \nDROP TABLE IF EXISTS ImplicitDataConvertTable;  \nCREATE TEMP TABLE ImplicitDataConvertTable (  \nSourceDataType NAME,  \nDestinationDataType NAME  \n);  \nINSERT INTO ImplicitDataConvertTable VALUES  \n('INTEGER', 'INTEGER'),  \n('INTEGER', 'NUMERIC'),  \n('INTEGER', 'BOOLEAN'),  \n('INTEGER', 'CHARACTER VARYING'),  \n('INTEGER', 'TEXT'),  \n('NUMERIC', 'CHARACTER VARYING'),  \n('NUMERIC', 'TEXT'),  \n('BOOLEAN', 'INTEGER'),  \n('BOOLEAN', 'BOOLEAN'),  \n('BOOLEAN', 'CHARACTER VARYING'),  \n('BOOLEAN', 'TEXT'),  \n('CHARACTER VARYING', 'TEXT'),  \n('CHARACTER VARYING', 'BYTEA'),  \n('TEXT', 'TEXT'),  \n('TEXT', 'BYTEA'),  \n('BYTEA', 'BYTEA'),  \n('UUID', 'CHARACTER VARYING'),  \n('UUID', 'TEXT'),  \n('UUID', 'UUID'),  \n('TIMESTAMP WITHOUT TIME ZONE', 'CHARACTER VARYING'),  \n('TIMESTAMP WITHOUT TIME ZONE', 'TEXT'),  \n('TIMESTAMP WITHOUT TIME ZONE', 'TIMESTAMP WITHOUT TIME ZONE'),  \n('DATE', 'CHARACTER VARYING'),  \n('DATE', 'TEXT'),  \n('DATE', 'TIMESTAMP WITHOUT TIME ZONE'),  \n('DATE', 'DATE'),  \n('TIME WITHOUT TIME ZONE', 'CHARACTER VARYING'),  \n('TIME WITHOUT TIME ZONE', 'TEXT'),  \n('TIME WITHOUT TIME ZONE', 'TIMESTAMP WITHOUT TIME ZONE'),  \n('TIME WITHOUT TIME ZONE', 'TIME WITHOUT TIME ZONE'),  \n('TIMESTAMP WITHOUT TIME ZONE', 'DATE'),  \n('TIMESTAMP WITHOUT TIME ZONE', 'TIME WITHOUT TIME ZONE'),  \n('INTEGER', 'BYTEA'),  \n('NUMERIC', 'BOOLEAN'),  \n('NUMERIC', 'BYTEA'),  \n('BOOLEAN', 'NUMERIC'),  \n('BOOLEAN', 'BYTEA'),  \n('UUID', 'BYTEA'),  \n('TIMESTAMP WITHOUT TIME ZONE', 'BYTEA'),  \n('DATE', 'BYTEA'),  \n('TIME WITHOUT TIME ZONE', 'BYTEA'),  \n('NUMERIC', 'INTEGER'),  \n('NUMERIC', 'NUMERIC');  \nIF EXISTS(SELECT SourceDataType, DestinationDataType FROM ImplicitDataConvertTable  \nWHERE SourceDataType = dataTypeName AND DestinationDataType = newDataTypeName) THEN  \nCanConvert = TRUE;  \nRETURN;  \nEND IF;  \nEXECUTE FORMAT('SELECT count(*) FROM %1$I', EntitySchemaName) INTO countRow;  \nCanConvert = (countRow = 0);  \nIF CanConvert THEN  \nRETURN;  \nEND IF;  \nDROP TABLE IF EXISTS \"ExplicitDataConvertTable\";  \nCREATE TEMP TABLE \"ExplicitDataConvertTable\" (  \nSourceDataType NAME,  \nDestinationDataType NAME  \n);  \nINSERT INTO \"ExplicitDataConvertTable\" VALUES  \n('CHARACTER VARYING', 'INTEGER'),  \n('CHARACTER VARYING', 'NUMERIC'),  \n('CHARACTER VARYING', 'BOOLEAN'),  \n('CHARACTER VARYING', 'UUID'),  \n('CHARACTER VARYING', 'TIMESTAMP WITHOUT TIME ZONE'),  \n('CHARACTER VARYING', 'DATE'),  \n('CHARACTER VARYING', 'TIME WITHOUT TIME ZONE'),  \n('TEXT', 'INTEGER'),  \n('TEXT', 'NUMERIC'),  \n('TEXT', 'BOOLEAN'),  \n('TEXT', 'UUID'),  \n('TEXT', 'TIMESTAMP WITHOUT TIME ZONE'),  \n('TEXT', 'DATE'),  \n('TEXT', 'TIME WITHOUT TIME ZONE'),  \n('BYTEA', 'INTEGER'),  \n('BYTEA', 'NUMERIC'),  \n('BYTEA', 'BOOLEAN'),  \n('BYTEA', 'UUID'),  \n('BYTEA', 'TIMESTAMP WITHOUT TIME ZONE'),  \n('BYTEA', 'DATE'),  \n('BYTEA', 'TEXT'),  \n('BYTEA', 'TIME WITHOUT TIME ZONE'),  \n('NUMERIC', 'BOOLEAN');  \nIF EXISTS(SELECT SourceDataType, DestinationDataType FROM \"ExplicitDataConvertTable\"  \nWHERE SourceDataType = dataTypeName AND DestinationDataType = newDataTypeName) THEN  \ncastQuery = FORMAT('CAST(%1$I%3$s AS %2$s)', SourceColumnName, NewColumnDataType,  \nCASE  \nWHEN dataTypeName = 'BYTEA' THEN '::TEXT'  \nWHEN dataTypeName = 'NUMERIC' THEN '::INTEGER'  \nELSE ''  \nEND);  \nsqlQuery = FORMAT('SELECT COUNT(*) FROM %1$I WHERE %2$s = %2$s',  \nEntitySchemaName, castQuery);  \nBEGIN  \nEXECUTE sqlQuery;  \nCanConvert = TRUE;  \nEXCEPTION WHEN OTHERS THEN  \nCanConvert = FALSE;  \nEND;  \nRETURN;  \nEND IF;  \nDROP TABLE IF EXISTS \"ImplicitDataOverflowConvertTable\";  \nCREATE TEMP TABLE \"ImplicitDataOverflowConvertTable\" (  \nSourceDataType NAME,  \nDestinationDataType NAME  \n);  \nINSERT INTO \"ImplicitDataOverflowConvertTable\" VALUES  \n('CHARACTER VARYING', 'CHARACTER VARYING'),  \n('TEXT', 'CHARACTER VARYING'),  \n('BYTEA', 'CHARACTER VARYING');  \nIF EXISTS(SELECT SourceDataType, DestinationDataType FROM \"ImplicitDataOverflowConvertTable\"  \nWHERE SourceDataType = dataTypeName AND DestinationDataType = newDataTypeName) THEN  \nEXECUTE FORMAT('SELECT count(*) FROM %1$I', EntitySchemaName) INTO countRow;  \nCanConvert = (countRow = 0);  \nIF CanConvert THEN  \nRETURN;  \nEND IF;  \nBEGIN  \nEXECUTE FORMAT('SELECT MAX(PG_COLUMN_SIZE(%1$I)) FROM %2$I', SourceColumnName, EntitySchemaName)  \nINTO dataLength;  \nIF (dataLength <= newDataTypeSize) THEN  \nCanConvert = TRUE;  \nELSE  \nCanConvert = FALSE;  \nEND IF;  \nEXCEPTION WHEN OTHERS THEN  \nCanConvert = FALSE;  \nEND;  \nEND IF;  \nEND;  \n$BODY$  \nLANGUAGE 'plpgsql';  \n## Example 6 (functions)\u200b\nExample\nExample of a function.\n-- Function  \n-- MSSQL  \nIF  EXISTS (SELECT * FROM sys.objects  \nWHERE object_id = OBJECT_ID(N'[dbo].[fn_IsGuid]') AND type = N'FN')  \nDROP FUNCTION [dbo].[fn_IsGuid]  \nGO  \nCREATE FUNCTION [dbo].[fn_IsGuid] (  \n@ValidateValue NVARCHAR(MAX))  \nRETURNS BIT  \nAS  \nBEGIN  \nDECLARE @hasLeftBraces BIT  \nIF @ValidateValue LIKE '{%'  \nBEGIN  \nSET @ValidateValue = SUBSTRING(@ValidateValue, 2, LEN(@ValidateValue) - 1)  \nSET @hasLeftBraces = 1  \nEND ELSE  \nBEGIN  \nSET @hasLeftBraces = 0  \nEND  \nDECLARE @hasRightBraces BIT  \nIF @ValidateValue LIKE '%}'  \nBEGIN  \nSET @ValidateValue = SUBSTRING(@ValidateValue, 1, LEN(@ValidateValue) - 1)  \nSET @hasRightBraces = 1  \nEND ELSE  \nBEGIN  \nSET @hasRightBraces = 0  \nEND  \nDECLARE @Result BIT  \nIF @ValidateValue LIKE '[0-9a-fA-F][0-9a-fA-F][0-9a-fA-F][0-9a-fA-F][0-9a-fA-F][0-9a-fA-F][0-9a-fA-F][0-9a-fA-F]-[0-9a-fA-F][0-9a-fA-F][0-9a-fA-F][0-9a-fA-F]-[0-9a-fA-F][0-9a-fA-F][0-9a-fA-F][0-9a-fA-F]-[0-9a-fA-F][0-9a-fA-F][0-9a-fA-F][0-9a-fA-F]-[0-9a-fA-F][0-9a-fA-F][0-9a-fA-F][0-9a-fA-F][0-9a-fA-F][0-9a-fA-F][0-9a-fA-F][0-9a-fA-F][0-9a-fA-F][0-9a-fA-F][0-9a-fA-F][0-9a-fA-F]'  \nBEGIN  \nSET @Result = 1  \nEND ELSE  \nBEGIN  \nSET @Result = 0  \nEND  \nIF @hasLeftBraces = @hasRightBraces  \nBEGIN  \nRETURN @Result  \nEND ELSE  \nBEGIN  \nSET @Result = 0  \nEND  \nRETURN @Result  \nEND  \nGO  \n-- Function  \n-- PostgreSQL  \nDROP FUNCTION IF EXISTS \"public\".\"fn_IsGuid\";  \nCREATE OR REPLACE FUNCTION public.\"fn_IsGuid\"(ValidateValue IN VARCHAR) RETURNS BOOLEAN AS $$  \nBEGIN  \nIF (regexp_matches(ValidateValue, '^\\{?[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}\\}?$'))[1] IS NOT NULL THEN  \nRETURN TRUE;  \nELSE  \nRETURN FALSE;  \nEND IF;  \nEND;  \n$$ LANGUAGE plpgsql;  \n* * *\n## Resources\u200b\n[Official PostgreSQL documentation](https://www.postgresql.org/docs/current/)",
  "code_examples": [
    {
      "code": "-- View and triggers that let you modify the target table-- MSSQLIF EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VwSysAdminUnit]'))DROP VIEW [dbo].[VwSysAdminUnit]GOCREATE VIEW [dbo].[VwSysAdminUnit]ASSELECT [SysAdminUnit].[Id]    ,[SysAdminUnit].[CreatedOn]    ,[SysAdminUnit].[CreatedById]    ,[SysAdminUnit].[ModifiedOn]    ,[SysAdminUnit].[ModifiedById]    ,[SysAdminUnit].[Name]    ,[SysAdminUnit].[Description]    ,[SysAdminUnit].[ParentRoleId]    ,[SysAdminUnit].[ContactId]    ,[SysAdminUnit].[IsDirectoryEntry]    ,[TimeZone].[Id] AS [TimeZoneId]    ,[SysAdminUnit].[UserPassword]    ,[SysAdminUnitType].[Id] AS [SysAdminUnitTypeId]    ,[SysAdminUnit].[AccountId]    ,[SysAdminUnit].[Active]    ,[SysAdminUnit].[LoggedIn]    ,[SysAdminUnit].[SynchronizeWithLDAP]    ,[SysAdminUnit].[LDAPEntry]    ,[SysAdminUnit].[LDAPEntryId]    ,[SysAdminUnit].[LDAPEntryDN]    ,[SysAdminUnit].[SysCultureId]    ,[SysAdminUnit].[ProcessListeners]    ,[SysAdminUnit].[PasswordExpireDate]    ,[SysAdminUnit].[HomePageId]    ,[SysAdminUnit].[ConnectionType]    ,[ConnectionType].[Id] AS [UserConnectionTypeId]    ,[SysAdminUnit].[ForceChangePassword]    ,[SysAdminUnit].[DateTimeFormatId]    ,[SysAdminUnit].[Id] as [SysAdminUnitId]    ,[SysAdminUnit].[SessionTimeout] as [SessionTimeout]FROM [SysAdminUnit]INNER JOIN [SysAdminUnitType] ON [SysAdminUnitType].[Value] = [SysAdminUnit].[SysAdminUnitTypeValue]LEFT JOIN [ConnectionType] AS [ConnectionType] ON [ConnectionType].[Value] = [SysAdminUnit].[ConnectionType]LEFT JOIN [TimeZone] AS [TimeZone] ON [TimeZone].[Code] = [SysAdminUnit].[TimeZoneId]GOCREATE TRIGGER [dbo].[ITR_VwSysAdminUnit_I]ON [dbo].[VwSysAdminUnit]    INSTEAD OF INSERTASBEGINSET NOCOUNT ON;INSERT INTO [SysAdminUnit](    [Id]    ,[CreatedOn]    ,[CreatedById]    ,[ModifiedOn]    ,[ModifiedById]    ,[Name]    ,[Description]    ,[ParentRoleId]    ,[ContactId]    ,[IsDirectoryEntry]    ,[TimeZoneId]    ,[UserPassword]    ,[SysAdminUnitTypeValue]    ,[AccountId]    ,[Active]    ,[LoggedIn]    ,[SynchronizeWithLDAP]    ,[LDAPEntry]    ,[LDAPEntryId]    ,[LDAPEntryDN]    ,[SysCultureId]    ,[ProcessListeners]    ,[PasswordExpireDate]    ,[HomePageId]    ,[ConnectionType]    ,[ForceChangePassword]    ,[DateTimeFormatId]    ,[SessionTimeout])SELECT [Id]    ,[CreatedOn]    ,[CreatedById]    ,[ModifiedOn]    ,[ModifiedById]    ,[Name]    ,[Description]    ,[ParentRoleId]    ,[ContactId]    ,[IsDirectoryEntry]    ,(SELECT COALESCE(        (SELECT [TimeZone].[Code] FROM [TimeZone]            WHERE [TimeZone].[Id] = [INSERTED].[TimeZoneId]), ''))    ,[UserPassword]    ,ISNULL((SELECT [SysAdminUnitType].[Value] FROM [SysAdminUnitType]        WHERE [SysAdminUnitType].[Id] = [INSERTED].[SysAdminUnitTypeId]), 4)    ,[AccountId]    ,[Active]    ,ISNULL([LoggedIn], 0)    ,[SynchronizeWithLDAP]    ,[LDAPEntry]    ,[LDAPEntryId]    ,[LDAPEntryDN]    ,[SysCultureId]    ,[ProcessListeners]    ,[PasswordExpireDate]    ,[HomePageId]    ,COALESCE([INSERTED].[ConnectionType],        (SELECT [ConnectionType].[Value] FROM [ConnectionType]        WHERE [ConnectionType].[Id] = [INSERTED].[UserConnectionTypeId]), 0)    ,ISNULL([ForceChangePassword], 0)    ,[DateTimeFormatId]    ,[SessionTimeout]FROM [INSERTED]ENDGOCREATE TRIGGER [dbo].[ITR_VwSysAdminUnit_U]ON [dbo].[VwSysAdminUnit]    INSTEAD OF UPDATEASBEGINSET NOCOUNT ON;UPDATE [SysAdminUnit]SET [SysAdminUnit].[CreatedOn] = [INSERTED].[CreatedOn]    ,[SysAdminUnit].[CreatedById] = [INSERTED].[CreatedById]    ,[SysAdminUnit].[ModifiedOn] =[INSERTED].[ModifiedOn]    ,[SysAdminUnit].[ModifiedById] = [INSERTED].[ModifiedById]    ,[SysAdminUnit].[Name] = [INSERTED].[Name]    ,[SysAdminUnit].[Description] = [INSERTED].[Description]    ,[SysAdminUnit].[ParentRoleId] = [INSERTED].[ParentRoleId]    ,[SysAdminUnit].[ContactId] = [INSERTED].[ContactId]    ,[SysAdminUnit].[IsDirectoryEntry] = [INSERTED].[IsDirectoryEntry]    ,[SysAdminUnit].[TimeZoneId] =        (SELECT COALESCE(            (SELECT [TimeZone].[Code] FROM [TimeZone]                WHERE [TimeZone].[Id] = [INSERTED].[TimeZoneId]), ''))    ,[SysAdminUnit].[UserPassword] = [INSERTED].[UserPassword]    ,[SysAdminUnit].[SysAdminUnitTypeValue] =        (SELECT [SysAdminUnitType].[Value] FROM [SysAdminUnitType]            WHERE [SysAdminUnitType].[Id] = [INSERTED].[SysAdminUnitTypeId])    ,[SysAdminUnit].[AccountId] = [INSERTED].[AccountId]    ,[SysAdminUnit].[Active] = [INSERTED].[Active]    ,[SysAdminUnit].[LoggedIn] = [INSERTED].[LoggedIn]    ,[SysAdminUnit].[SynchronizeWithLDAP] = [INSERTED].[SynchronizeWithLDAP]    ,[SysAdminUnit].[LDAPEntry] = [INSERTED].[LDAPEntry]    ,[SysAdminUnit].[LDAPEntryId] = [INSERTED].[LDAPEntryId]    ,[SysAdminUnit].[LDAPEntryDN] = [INSERTED].[LDAPEntryDN]    ,[SysAdminUnit].[SysCultureId] = [INSERTED].[SysCultureId]    ,[SysAdminUnit].[ProcessListeners] = [INSERTED].[ProcessListeners]    ,[SysAdminUnit].[PasswordExpireDate] = [INSERTED].[PasswordExpireDate]    ,[SysAdminUnit].[HomePageId] = [INSERTED].[HomePageId]    ,[SysAdminUnit].[ConnectionType] = COALESCE([INSERTED].[ConnectionType],        (SELECT [ConnectionType].[Value] FROM [ConnectionType]        WHERE [ConnectionType].[Id] = [INSERTED].[UserConnectionTypeId]), 0)    ,[SysAdminUnit].[ForceChangePassword] = [INSERTED].[ForceChangePassword]    ,[SysAdminUnit].[DateTimeFormatId] = [INSERTED].[DateTimeFormatId]    ,[SysAdminUnit].[SessionTimeout] = [INSERTED].[SessionTimeout]FROM [SysAdminUnit]INNER JOIN [INSERTED] ON [SysAdminUnit].[Id] = [INSERTED].[Id]ENDGOCREATE TRIGGER [dbo].[ITR_VwSysAdminUnit_D]ON [dbo].[VwSysAdminUnit]    INSTEAD OF DELETEASBEGINSET NOCOUNT ON;DELETE FROM [SysAdminUnit]WHERE EXISTS(SELECT * FROM [DELETED] WHERE [SysAdminUnit].[Id] = [DELETED].[Id])ENDGO",
      "language": "sql",
      "context": "Example of an SQL script that creates a view and triggers to add, modify, and delete records from the target table.",
      "tab_label": "",
      "line_count": 1
    },
    {
      "code": "-- View and triggers that let you modify the target table-- PostgreSQLDROP FUNCTION IF EXISTS \"public\".\"ITR_VwSysLookup_IUD_Func\" CASCADE;DROP VIEW IF EXISTS \"public\".\"VwSysLookup\";CREATE VIEW \"public\".\"VwSysLookup\" ASSELECT \"SysLookup\".\"Id\"    ,\"SysLookup\".\"CreatedOn\"    ,\"SysLookup\".\"CreatedById\"    ,\"SysLookup\".\"ModifiedOn\"    ,\"SysLookup\".\"ModifiedById\"    ,\"SysLookup\".\"Name\"    ,\"SysLookup\".\"Description\"    ,\"SysLookup\".\"SysFolderId\"    ,\"SysLookup\".\"SysEntitySchemaUId\"    ,\"SysLookup\".\"SysGridPageSchemaUId\"    ,\"SysLookup\".\"SysEditPageSchemaUId\"    ,\"VwSysSchemaInfo\".\"SysWorkspaceId\"    ,\"SysLookup\".\"ProcessListeners\"    ,\"SysLookup\".\"IsSystem\"    ,\"SysLookup\".\"IsSimple\"FROM \"public\".\"SysLookup\"INNER JOIN \"public\".\"VwSysSchemaInfo\" ON \"SysLookup\".\"SysEntitySchemaUId\" = \"VwSysSchemaInfo\".\"UId\";CREATE FUNCTION \"public\".\"ITR_VwSysLookup_IUD_Func\"() RETURNS TRIGGER AS $$    BEGIN        IF TG_OP = 'INSERT' THEN            INSERT INTO \"public\".\"SysLookup\"(                \"Id\"                ,\"CreatedOn\"                ,\"CreatedById\"                ,\"ModifiedOn\"                ,\"ModifiedById\"                ,\"Name\"                ,\"Description\"                ,\"SysFolderId\"                ,\"SysEntitySchemaUId\"                ,\"SysGridPageSchemaUId\"                ,\"SysEditPageSchemaUId\"                ,\"ProcessListeners\"                ,\"IsSystem\"                ,\"IsSimple\")            SELECT NEW.\"Id\"                ,NEW.\"CreatedOn\"                ,NEW.\"CreatedById\"                ,NEW.\"ModifiedOn\"                ,NEW.\"ModifiedById\"                ,NEW.\"Name\"                ,NEW.\"Description\"                ,NEW.\"SysFolderId\"                ,NEW.\"SysEntitySchemaUId\"                ,NEW.\"SysGridPageSchemaUId\"                ,NEW.\"SysEditPageSchemaUId\"                ,NEW.\"ProcessListeners\"                ,NEW.\"IsSystem\"                ,NEW.\"IsSimple\";            RETURN NEW;        ELSIF TG_OP = 'UPDATE' THEN            UPDATE \"public\".\"SysLookup\"            SET \"CreatedOn\" = NEW.\"CreatedOn\"                ,\"CreatedById\" = NEW.\"CreatedById\"                ,\"ModifiedOn\" = NEW.\"ModifiedOn\"                ,\"ModifiedById\" = NEW.\"ModifiedById\"                ,\"Name\" = NEW.\"Name\"                ,\"Description\" = NEW.\"Description\"                ,\"SysFolderId\" = NEW.\"SysFolderId\"                ,\"SysEntitySchemaUId\" = NEW.\"SysEntitySchemaUId\"                ,\"SysGridPageSchemaUId\" = NEW.\"SysGridPageSchemaUId\"                ,\"SysEditPageSchemaUId\" = NEW.\"SysEditPageSchemaUId\"                ,\"ProcessListeners\" = NEW.\"ProcessListeners\"                ,\"IsSystem\" = NEW.\"IsSystem\"                ,\"IsSimple\" = NEW.\"IsSimple\"            WHERE \"SysLookup\".\"Id\" = NEW.\"Id\";            RETURN NEW;        ELSIF TG_OP = 'DELETE' THEN            DELETE FROM \"public\".\"SysLookup\" WHERE OLD.\"Id\" = \"SysLookup\".\"Id\";            RETURN OLD;        END IF;        RETURN NEW;    END;$$ LANGUAGE plpgsql;CREATE TRIGGER \"ITR_VwSysLookup_IUD\"    INSTEAD OF INSERT OR UPDATE OR DELETE ON \"public\".\"VwSysLookup\"    FOR EACH ROW EXECUTE PROCEDURE \"public\".\"ITR_VwSysLookup_IUD_Func\"();",
      "language": "sql",
      "context": "Example of an SQL script that creates a view and triggers to add, modify, and delete records from the target table.",
      "tab_label": "",
      "line_count": 1
    },
    {
      "code": "-- Use the RULE instead of the INSTEAD OF trigger-- MSSQLIF EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VwAdministrativeObjects]'))DROP VIEW [dbo].[VwAdministrativeObjects]GOCREATE VIEW [dbo].[VwAdministrativeObjects]ASWITH[SysSchemaAdministrationProperties] AS (SELECT [AdministrationPropertiesAll].[Id] AS [SysSchemaId],    max([AdministrationPropertiesAll].[AdministratedByOperations]) AS [AdministratedByOperations],    max([AdministrationPropertiesAll].[AdministratedByColumns]) AS [AdministratedByColumns],    max([AdministrationPropertiesAll].[AdministratedByRecords]) AS [AdministratedByRecords],    max([AdministrationPropertiesAll].[IsTrackChangesInDB]) AS [IsTrackChangesInDB]FROM (    SELECT [SysSchema].[Id],            (CASE WHEN EXISTS (                SELECT 1                FROM [SysSchemaProperty]                WHERE (([SysSchemaProperty].[SysSchemaId] = [SysSchema].[Id] AND [SysSchema].[ExtendParent] = 0)                    OR [SysSchemaProperty].[SysSchemaId] = [DerivedSysSchema].[Id])                    AND [SysSchemaProperty].[Name] = 'AdministratedByOperations'                    AND [SysSchemaProperty].[Value] = 'True'                    AND [SysSchemaProperty].[SysSchemaId] IS NOT NULL                )            THEN 1 ELSE 0 END) AS [AdministratedByOperations],            (CASE WHEN EXISTS (                SELECT 1                FROM [SysSchemaProperty]                WHERE (([SysSchemaProperty].[SysSchemaId] = [SysSchema].[Id] AND [SysSchema].[ExtendParent] = 0)                    OR [SysSchemaProperty].[SysSchemaId] = [DerivedSysSchema].[Id])                    AND [SysSchemaProperty].[Name] = 'AdministratedByColumns'                    AND [SysSchemaProperty].[Value] = 'True'                    AND [SysSchemaProperty].[SysSchemaId] IS NOT NULL                )            THEN 1 ELSE 0 END) AS [AdministratedByColumns],            (CASE WHEN EXISTS (                SELECT 1                FROM [SysSchemaProperty]                WHERE (([SysSchemaProperty].[SysSchemaId] = [SysSchema].[Id] AND [SysSchema].[ExtendParent] = 0)                    OR [SysSchemaProperty].[SysSchemaId] = [DerivedSysSchema].[Id])                    AND [SysSchemaProperty].[Name] = 'AdministratedByRecords'                    AND [SysSchemaProperty].[Value] = 'True'                    AND [SysSchemaProperty].[SysSchemaId] IS NOT NULL                )            THEN 1 ELSE 0 END) AS [AdministratedByRecords],            (CASE WHEN EXISTS (                SELECT 1                FROM [SysSchemaProperty]                WHERE (([SysSchemaProperty].[SysSchemaId] = [SysSchema].[Id] AND [SysSchema].[ExtendParent] = 0)                    OR [SysSchemaProperty].[SysSchemaId] = [DerivedSysSchema].[Id])                    AND [SysSchemaProperty].[Name] = 'IsTrackChangesInDB'                    AND [SysSchemaProperty].[Value] = 'True'                    AND [SysSchemaProperty].[SysSchemaId] IS NOT NULL                )            THEN 1 ELSE 0 END) AS [IsTrackChangesInDB]    FROM [SysSchema]    LEFT OUTER JOIN [SysSchema] AS [DerivedSysSchema] ON ([SysSchema].[Id] = [DerivedSysSchema].[ParentId] AND [DerivedSysSchema].[ExtendParent] = 1)    WHERE [SysSchema].[ManagerName] = 'EntitySchemaManager'        AND [SysSchema].[ExtendParent] = 0) AS [AdministrationPropertiesAll]GROUP BY [AdministrationPropertiesAll].[Id])SELECT [BaseSchemas].[UId] AS [Id],    [BaseSchemas].[UId],    [BaseSchemas].[CreatedOn],    [BaseSchemas].[CreatedById],    [BaseSchemas].[ModifiedOn],    [BaseSchemas].[ModifiedById],    [BaseSchemas].[Name],    [VwSysSchemaExtending].[TopExtendingCaption] as Caption,    [BaseSchemas].[Description],    (CASE WHEN EXISTS (        SELECT 1        FROM [SysLookup]        WHERE [SysLookup].[SysEntitySchemaUId] = [BaseSchemas].[UId])        THEN 1 ELSE 0 END) AS [IsLookup],    (CASE WHEN EXISTS (        SELECT 1 FROM [SysModule]        INNER JOIN [SysModuleEntity] ON [SysModuleEntity].[Id] = [SysModule].[SysModuleEntityId]        WHERE [BaseSchemas].[UId] = [SysModuleEntity].[SysEntitySchemaUId])        THEN 1 ELSE 0 END) AS [IsModule],    [SysSchemaAdministrationProperties].[AdministratedByOperations],    [SysSchemaAdministrationProperties].[AdministratedByColumns],    [SysSchemaAdministrationProperties].[AdministratedByRecords],    [SysSchemaAdministrationProperties].[IsTrackChangesInDB],    [SysWorkspaceId],    [BaseSchemas].[ProcessListeners],    (CASE WHEN EXISTS (        SELECT 1        FROM [SysSSPEntitySchemaAccessList]        WHERE [SysSSPEntitySchemaAccessList].[EntitySchemaUId] = [BaseSchemas].[UId]        )        THEN 1 ELSE 0 END) AS [IsInSSPEntitySchemaAccessList]FROM  [SysSchema] as [BaseSchemas]INNER JOIN [VwSysSchemaExtending] ON BaseSchemas.[Id] = [VwSysSchemaExtending].[BaseSchemaId]INNER JOIN [SysPackage] on [BaseSchemas].[SysPackageId] = [SysPackage].[Id]INNER JOIN [SysSchemaAdministrationProperties] ON [BaseSchemas].[Id] = [SysSchemaAdministrationProperties].[SysSchemaId]GOCREATE TRIGGER [dbo].[TRVwAdministrativeObjects_IU]ON [dbo].[VwAdministrativeObjects]    INSTEAD OF UPDATEASBEGIN    SET NOCOUNT ON;    RETURNENDGO",
      "language": "sql",
      "context": "Example of an SQL script that demonstrates how to use a RULE instead of the INSTEAD OF trigger in PostgreSQL.",
      "tab_label": "",
      "line_count": 1
    },
    {
      "code": "-- Use the RULE instead of the INSTEAD OF trigger-- PostgreSQLDROP VIEW IF EXISTS public.\"VwAdministrativeObjects\";DROP RULE IF EXISTS RU_VwAdministrativeObjects ON \"VwAdministrativeObjects\";CREATE VIEW public.\"VwAdministrativeObjects\" ASWITH SysSchemaAdministrationProperties AS (    SELECT AdministrationPropertiesAll.Id \"SysSchemaId\",        MAX(AdministrationPropertiesAll.AdministratedByOperations) \"AdministratedByOperations\",        MAX(AdministrationPropertiesAll.AdministratedByColumns) \"AdministratedByColumns\",        MAX(AdministrationPropertiesAll.AdministratedByRecords) \"AdministratedByRecords\",        MAX(AdministrationPropertiesAll.IsTrackChangesInDB) \"IsTrackChangesInDB\"    FROM (        SELECT ss.\"Id\" Id            ,(CASE WHEN EXISTS (                SELECT 1                FROM \"SysSchemaProperty\" ssp                WHERE ((ssp.\"SysSchemaId\" = ss.\"Id\" AND NOT ss.\"ExtendParent\") OR ssp.\"SysSchemaId\" = DerivedSysSchema.\"Id\")                    AND ssp.\"Name\" = 'AdministratedByOperations'                    AND ssp.\"Value\" = 'True'                    AND ssp.\"SysSchemaId\" IS NOT NULL            ) THEN 1 ELSE 0 END) AdministratedByOperations            ,(CASE WHEN EXISTS (                SELECT 1                FROM \"SysSchemaProperty\" ssp                WHERE ((ssp.\"SysSchemaId\" = ss.\"Id\" AND NOT ss.\"ExtendParent\") OR ssp.\"SysSchemaId\" = DerivedSysSchema.\"Id\")                    AND ssp.\"Name\" = 'AdministratedByColumns'                    AND ssp.\"Value\" = 'True'                    AND ssp.\"SysSchemaId\" IS NOT NULL            ) THEN 1 ELSE 0 END) AdministratedByColumns            ,(CASE WHEN EXISTS (                SELECT 1                FROM \"SysSchemaProperty\" ssp                WHERE ((ssp.\"SysSchemaId\" = ss.\"Id\" AND NOT ss.\"ExtendParent\") OR ssp.\"SysSchemaId\" = DerivedSysSchema.\"Id\")                    AND ssp.\"Name\" = 'AdministratedByRecords'                    AND ssp.\"Value\" = 'True'                    AND ssp.\"SysSchemaId\" IS NOT NULL            ) THEN 1 ELSE 0 END) AdministratedByRecords            ,(CASE WHEN EXISTS (                SELECT 1                FROM \"SysSchemaProperty\" ssp WHERE ((ssp.\"SysSchemaId\" = ss.\"Id\" AND NOT ss.\"ExtendParent\")                    OR ssp.\"SysSchemaId\" = DerivedSysSchema.\"Id\")                    AND ssp.\"Name\" = 'IsTrackChangesInDB'                    AND ssp.\"Value\" = 'True'                    AND ssp.\"SysSchemaId\" IS NOT NULL            ) THEN 1 ELSE 0 END) IsTrackChangesInDB        FROM \"SysSchema\" ss        LEFT OUTER JOIN \"SysSchema\" DerivedSysSchema ON (ss.\"Id\" = DerivedSysSchema.\"ParentId\" AND DerivedSysSchema.\"ExtendParent\")        WHERE ss.\"ManagerName\" = 'EntitySchemaManager' AND NOT ss.\"ExtendParent\"    ) AdministrationPropertiesAll    GROUP BY AdministrationPropertiesAll.Id)SELECT BaseSchema.\"UId\" \"Id\"    ,BaseSchema.\"UId\"    ,BaseSchema.\"CreatedOn\"    ,BaseSchema.\"CreatedById\"    ,BaseSchema.\"ModifiedOn\"    ,BaseSchema.\"ModifiedById\"    ,BaseSchema.\"Name\"    ,public.\"VwSysSchemaExtending\".\"TopExtendingCaption\" \"Caption\"    ,BaseSchema.\"Description\"    ,EXISTS (        SELECT 1        FROM \"SysLookup\"        WHERE \"SysEntitySchemaUId\" = BaseSchema.\"UId\"    ) \"IsLookup\"    ,EXISTS (        SELECT 1        FROM \"SysModule\" sm        INNER JOIN \"SysModuleEntity\" sme ON sme.\"Id\" = sm.\"SysModuleEntityId\"        WHERE BaseSchema.\"UId\" = sme.\"SysEntitySchemaUId\"    ) \"IsModule\"    ,SysSchemaAdministrationProperties.\"AdministratedByOperations\"::BOOLEAN    ,SysSchemaAdministrationProperties.\"AdministratedByColumns\"::BOOLEAN    ,SysSchemaAdministrationProperties.\"AdministratedByRecords\"::BOOLEAN    ,SysSchemaAdministrationProperties.\"IsTrackChangesInDB\"::BOOLEAN    ,\"SysWorkspaceId\"    ,BaseSchema.\"ProcessListeners\"    ,EXISTS (        SELECT 1        FROM \"SysSSPEntitySchemaAccessList\"        WHERE \"EntitySchemaUId\" = BaseSchema.\"UId\"    ) \"IsInSSPEntitySchemaAccessList\"FROM \"SysSchema\" BaseSchemaINNER JOIN \"VwSysSchemaExtending\" ON BaseSchema.\"Id\" = \"VwSysSchemaExtending\".\"BaseSchemaId\"INNER JOIN \"SysPackage\" on BaseSchema.\"SysPackageId\" = \"SysPackage\".\"Id\"INNER JOIN SysSchemaAdministrationProperties ON BaseSchema.\"Id\" = SysSchemaAdministrationProperties.\"SysSchemaId\";CREATE RULE RU_VwAdministrativeObjects AS    ON UPDATE TO \"VwAdministrativeObjects\"    DO INSTEAD NOTHING;",
      "language": "sql",
      "context": "Example of an SQL script that demonstrates how to use a RULE instead of the INSTEAD OF trigger in PostgreSQL.",
      "tab_label": "",
      "line_count": 1
    },
    {
      "code": "-- Stored procedure that uses loops, cursors, and temporary tables-- MSSQLIF NOT OBJECT_ID('[dbo].[tsp_ActualizeUserRoles]') IS NULLBEGIN    DROP PROCEDURE [dbo].[tsp_ActualizeUserRoles]ENDGOCREATE PROCEDURE dbo.tsp_ActualizeUserRoles (@UserId uniqueidentifier)ASBEGIN    SET NOCOUNT ON    IF OBJECT_ID('tempdb..#AdminUnitListTemp') IS NOT NULL    BEGIN        DROP TABLE [#AdminUnitListTemp];    END;    CREATE TABLE [#AdminUnitListTemp] (        [UserId] uniqueidentifier NOT NULL,        [Id] uniqueidentifier NOT NULL,        [Name] NVARCHAR(250) NOT NULL,        [ParentRoleId] uniqueidentifier NULL,        [Granted] BIT NULL    );    DECLARE @GetAdminUnitList TABLE (        [Id] uniqueidentifier NOT NULL,        [Name] nvarchar(260) NOT NULL,        [ParentRoleId] uniqueidentifier NULL    );    DECLARE @NewRoles TABLE ([Id] uniqueidentifier NOT NULL);    DECLARE @OldUserRoles TABLE ([Id] uniqueidentifier NOT NULL);    DECLARE @getUserAdminUnits CURSOR;    DECLARE @SysAdminUnitRoles TABLE (        [Id] uniqueidentifier,        [Name] nvarchar(260),        [ParentRoleId] uniqueidentifier    );    DECLARE @ManagersBeforeActualization TABLE ([Id] uniqueidentifier NOT NULL);    DECLARE @ManagersAfterActualization TABLE ([Id] uniqueidentifier NOT NULL);    DECLARE @StillManagers TABLE ([Id] uniqueidentifier NOT NULL);    DECLARE @NoLongerManagers TABLE ([Id] uniqueidentifier NOT NULL);    DECLARE @NewManagers TABLE ([Id] uniqueidentifier NOT NULL);    DECLARE @SysAdminUnitId uniqueidentifier;    -- Old user roles    INSERT INTO @OldUserRoles        SELECT DISTINCT [SysAdminUnitInRole].[SysAdminUnitRoleId] [Id]        FROM [SysAdminUnitInRole]        WHERE [SysAdminUnitInRole].[SysAdminUnitId] = @UserId    -- Old user managers    INSERT INTO @ManagersBeforeActualization        SELECT DISTINCT [SysUserInRole].[SysUserId] [Id]        FROM [SysAdminUnitInRole]        INNER JOIN [SysAdminUnit] [Roles]            ON [SysAdminUnitInRole].[SysAdminUnitRoleId] = [Roles].[Id]        INNER JOIN @OldUserRoles            ON [Roles].[ParentRoleId] = [@OldUserRoles].[Id]        INNER JOIN [SysUserInRole]            ON [SysUserInRole].[SysRoleId] = [Roles].[Id]        WHERE [Roles].[SysAdminUnitTypeValue] = 2    -- Get and insert new user roles    INSERT INTO @GetAdminUnitList EXEC [tsp_GetAdminUnitList] @UserId=@UserId;    INSERT INTO @NewRoles SELECT [Id] FROM @GetAdminUnitList;    DELETE FROM [SysAdminUnitInRole] WHERE [SysAdminUnitId] = @UserId;    INSERT INTO [SysAdminUnitInRole] ([SysAdminUnitId], [SysAdminUnitRoleId])        SELECT DISTINCT @UserId, [Id] FROM @NewRoles;    -- User managers after actualization    INSERT INTO @ManagersAfterActualization        SELECT DISTINCT            [SysUserInRole].[SysUserId] [Id]        FROM [SysAdminUnitInRole]        INNER JOIN [SysAdminUnit] [Roles]            ON [SysAdminUnitInRole].[SysAdminUnitRoleId] = [Roles].[Id]        INNER JOIN @NewRoles NewRoles            ON [Roles].[ParentRoleId] = NewRoles.[Id]        INNER JOIN [SysUserInRole]            ON [SysUserInRole].[SysRoleId] = [Roles].[Id]        WHERE [Roles].[SysAdminUnitTypeValue] = 2;    -- New (who were not but become) user managers    INSERT INTO @NewManagers        SELECT [Id] FROM @ManagersAfterActualization AS managersAfterActualization            WHERE NOT EXISTS (                SELECT NULL                FROM @ManagersBeforeActualization AS managersBeforeActualization                WHERE managersBeforeActualization.[Id] = managersAfterActualization.[Id]            );    -- Add all user roles to new managers and their grantee-users, if they arent already have    SET @getUserAdminUnits = CURSOR FOR        SELECT DISTINCT [Id] FROM (            SELECT [Id] FROM @NewManagers            UNION            SELECT [GranteeSysAdminUnitId]            FROM [SysAdminUnitGrantedRight]            WHERE EXISTS (                SELECT NULL FROM @NewManagers as newManagers                WHERE [SysAdminUnitGrantedRight].[GrantorSysAdminUnitId] = newManagers.[Id]            )        ) Roles;    OPEN @getUserAdminUnits;    FETCH NEXT    FROM @getUserAdminUnits INTO @SysAdminUnitId;    WHILE @@FETCH_STATUS = 0    BEGIN        INSERT INTO [SysAdminUnitInRole] ([SysAdminUnitId], [SysAdminUnitRoleId])            SELECT DISTINCT @SysAdminUnitId, [Id]            FROM @NewRoles AS newRoles            WHERE NOT EXISTS (                SELECT 1                FROM [SysAdminUnitInRole]                WHERE [SysAdminUnitInRole].[SysAdminUnitId] = @SysAdminUnitId                AND [SysAdminUnitInRole].[SysAdminUnitRoleId] = newRoles.[Id]            );        FETCH NEXT FROM @getUserAdminUnits INTO @SysAdminUnitId;    END;    CLOSE @getUserAdminUnits;    DEALLOCATE @getUserAdminUnits;    DECLARE @isUserLostAtLeastOneRole INT = (        SELECT COUNT(*)        FROM @OldUserRoles AS oldUserRoles        WHERE NOT EXISTS (            SELECT 1            FROM @NewRoles AS newUserRoles            WHERE newUserRoles.[Id] = oldUserRoles.[Id]        )    );    -- Still (who were and remained) user managers    INSERT INTO @StillManagers        SELECT  DISTINCT managersAfterActualization.[Id] AS [Id]        FROM @ManagersAfterActualization AS managersAfterActualization            JOIN @ManagersBeforeActualization AS managersBeforeActualization                ON managersAfterActualization.[Id] = managersBeforeActualization.[Id];    -- If user lost at least one role, we need to actualize all his still-managers.    -- If not (user only gained new roles) - we just add to still-managers and their grantee-users new user roles.    IF (@isUserLostAtLeastOneRole = 0)    BEGIN        -- Add all new user roles to his still-managers and to their grantee-users        SET @getUserAdminUnits = CURSOR FOR            SELECT DISTINCT [Id] FROM (                SELECT stillManagers.[Id] AS [Id]                FROM @StillManagers AS stillManagers                UNION                SELECT [GranteeSysAdminUnitId]                FROM [SysAdminUnitGrantedRight]                WHERE EXISTS (                    SELECT NULL                    FROM @StillManagers AS stillManagers                    WHERE stillManagers.[Id] = [GrantorSysAdminUnitId]                )            ) Roles;        OPEN @getUserAdminUnits;        FETCH NEXT        FROM @getUserAdminUnits INTO @SysAdminUnitId;        WHILE @@FETCH_STATUS = 0        BEGIN            INSERT INTO [SysAdminUnitInRole] ([SysAdminUnitId], [SysAdminUnitRoleId])                SELECT DISTINCT @SysAdminUnitId, [Id]                FROM @NewRoles AS newRoles                WHERE NOT EXISTS (                    SELECT 1                    FROM [SysAdminUnitInRole]                    WHERE [SysAdminUnitInRole].[SysAdminUnitId] = @SysAdminUnitId                        AND [SysAdminUnitInRole].[SysAdminUnitRoleId] = newRoles.[Id]                );            FETCH NEXT FROM @getUserAdminUnits INTO @SysAdminUnitId;        END;        CLOSE @getUserAdminUnits;        DEALLOCATE @getUserAdminUnits;    END ELSE    BEGIN        --Actualize all roles for still-managers        SET @getUserAdminUnits = CURSOR FOR            SELECT DISTINCT [Id]            FROM @StillManagers            UNION                SELECT [GranteeSysAdminUnitId]                FROM [SysAdminUnitGrantedRight]                WHERE EXISTS (                SELECT NULL                FROM @StillManagers AS stillManagers                WHERE stillManagers.[Id] = [GrantorSysAdminUnitId]                );        OPEN @getUserAdminUnits;        FETCH NEXT        FROM @getUserAdminUnits INTO @SysAdminUnitId;        WHILE @@FETCH_STATUS = 0        BEGIN            DELETE FROM @SysAdminUnitRoles;            INSERT INTO @SysAdminUnitRoles                EXEC [tsp_GetAdminUnitList] @UserId=@SysAdminUnitId;            BEGIN TRAN;                DELETE FROM [dbo].[SysAdminUnitInRole] WHERE SysAdminUnitId = @SysAdminUnitId;                INSERT INTO [dbo].[SysAdminUnitInRole] (SysAdminUnitId, SysAdminUnitRoleId)                    SELECT @SysAdminUnitId, [Id] FROM @SysAdminUnitRoles;            COMMIT;            FETCH NEXT                FROM @getUserAdminUnits INTO @SysAdminUnitId;        END;        CLOSE @getUserAdminUnits;        DEALLOCATE @getUserAdminUnits;    END;    -- No longer (who were but not remained) user managers    INSERT INTO @NoLongerManagers        SELECT [Id] FROM @ManagersBeforeActualization as managersBeforeActualization            WHERE NOT EXISTS (                SELECT NULL                FROM @ManagersAfterActualization AS managersAfterActualization                WHERE managersAfterActualization.[Id] = managersBeforeActualization.[Id]            );    -- Actualize roles for all noLonger-managers, his grantee-users and all grantee-users of user    SET @getUserAdminUnits = CURSOR FOR        SELECT DISTINCT [Id] FROM (            SELECT [Id] FROM @NoLongerManagers            UNION            SELECT [GranteeSysAdminUnitId]            FROM [SysAdminUnitGrantedRight]            WHERE EXISTS (                SELECT NULL                FROM @NoLongerManagers AS noLongerManagers                WHERE noLongerManagers.[Id] = [GrantorSysAdminUnitId]            )            UNION ALL            SELECT GranteeSysAdminUnitId            FROM SysAdminUnitGrantedRight            WHERE GrantorSysAdminUnitId = @UserId        ) Roles;    OPEN @getUserAdminUnits;    FETCH NEXT        FROM @getUserAdminUnits INTO @SysAdminUnitId;    WHILE @@FETCH_STATUS = 0    BEGIN        DELETE FROM @SysAdminUnitRoles;        INSERT INTO @SysAdminUnitRoles            EXEC [tsp_GetAdminUnitList] @UserId=@SysAdminUnitId;        BEGIN TRAN;            DELETE FROM [dbo].[SysAdminUnitInRole] WHERE SysAdminUnitId = @SysAdminUnitId;            INSERT INTO [dbo].[SysAdminUnitInRole] (SysAdminUnitId, SysAdminUnitRoleId)                SELECT @SysAdminUnitId, [Id] FROM @SysAdminUnitRoles;        COMMIT;        FETCH NEXT            FROM @getUserAdminUnits INTO @SysAdminUnitId;    END;    CLOSE @getUserAdminUnits;    DEALLOCATE @getUserAdminUnits;    IF OBJECT_ID('tempdb..#AdminUnitListTemp') IS NOT NULL    BEGIN        DROP TABLE [#AdminUnitListTemp];    END;END;GO",
      "language": "sql",
      "context": "Example of an SQL script that creates a stored procedure. The stored procedure uses loops, cursors, and temporary tables.",
      "tab_label": "",
      "line_count": 1
    },
    {
      "code": "-- Stored procedure that uses loops, cursors, and temporary tables-- PostgreSQLDROP FUNCTION IF EXISTS \"tsp_ActualizeUserRoles\";CREATE FUNCTION \"tsp_ActualizeUserRoles\"(    UserId UUID)RETURNS VOIDAS $$DECLARE    getUserNewManagers CURSOR FOR        SELECT DISTINCT \"Id\" FROM (            SELECT \"Id\" FROM \"NewManagers\"            UNION            SELECT \"GranteeSysAdminUnitId\"            FROM \"SysAdminUnitGrantedRight\"            WHERE EXISTS (                SELECT NULL FROM \"NewManagers\" as \"newManagers\"                WHERE \"SysAdminUnitGrantedRight\".\"GrantorSysAdminUnitId\" = \"newManagers\".\"Id\"            )        ) \"Roles\";    lostUserRolesCount INT;    getUserStillManagers CURSOR FOR        SELECT DISTINCT \"stillManagers\".\"Id\" AS \"Id\"        FROM \"StillManagers\" AS \"stillManagers\"        UNION        SELECT \"GranteeSysAdminUnitId\"        FROM \"SysAdminUnitGrantedRight\"        WHERE EXISTS (            SELECT NULL            FROM \"StillManagers\" AS \"stillManagers\"            WHERE \"stillManagers\".\"Id\" = \"GrantorSysAdminUnitId\"        );    getUserNoLongerManagers CURSOR FOR        SELECT DISTINCT \"Id\" FROM (            SELECT \"Id\"            FROM \"NoLongerManagers\"            UNION            SELECT \"GranteeSysAdminUnitId\"            FROM \"SysAdminUnitGrantedRight\"            WHERE EXISTS (                SELECT NULL                FROM \"NoLongerManagers\" AS \"noLongerManagers\"                WHERE \"noLongerManagers\".\"Id\" = \"GrantorSysAdminUnitId\"            )            UNION ALL            SELECT \"GranteeSysAdminUnitId\"            FROM \"SysAdminUnitGrantedRight\"            WHERE \"GrantorSysAdminUnitId\" = UserId        ) \"Roles\";BEGIN    DROP TABLE IF EXISTS \"GetAdminUnitListTmp\";    CREATE TEMP TABLE \"GetAdminUnitListTmp\" (        \"Id\" UUID,        \"Name\" VARCHAR(250),        \"ParentRoleId\" UUID    );    DROP TABLE IF EXISTS \"SysAdminUnitRoles\";    CREATE TEMP TABLE \"SysAdminUnitRoles\" (        \"Id\" UUID,        \"Name\" VARCHAR(250),        \"ParentRoleId\" UUID    );    -- Old user roles    DROP TABLE IF EXISTS \"OldUserRoles\";    CREATE TEMP TABLE \"OldUserRoles\" (        \"Id\" UUID    );    INSERT INTO \"OldUserRoles\"        SELECT DISTINCT \"SysAdminUnitInRole\".\"SysAdminUnitRoleId\" \"Id\"        FROM \"SysAdminUnitInRole\"        WHERE \"SysAdminUnitInRole\".\"SysAdminUnitId\" = UserId;    -- Old user managers    DROP TABLE IF EXISTS \"ManagersBeforeActualization\";    CREATE TEMP TABLE \"ManagersBeforeActualization\" (        \"Id\" UUID    );    INSERT INTO \"ManagersBeforeActualization\"        SELECT DISTINCT \"SysUserInRole\".\"SysUserId\" \"Id\"        FROM \"SysAdminUnitInRole\"        INNER JOIN \"SysAdminUnit\" \"Roles\"            ON \"SysAdminUnitInRole\".\"SysAdminUnitRoleId\" = \"Roles\".\"Id\"        INNER JOIN \"OldUserRoles\"            ON \"Roles\".\"ParentRoleId\" = \"OldUserRoles\".\"Id\"        INNER JOIN \"SysUserInRole\"            ON \"SysUserInRole\".\"SysRoleId\" = \"Roles\".\"Id\"        WHERE \"Roles\".\"SysAdminUnitTypeValue\" = 2;    -- Get and insert new user roles    DROP TABLE IF EXISTS \"GetAdminUnitList\";    CREATE TEMP TABLE \"GetAdminUnitList\" (        \"Id\" UUID,        \"Name\" VARCHAR(250),        \"ParentRoleId\" UUID    );    DROP TABLE IF EXISTS \"NewRoles\";    CREATE TEMP TABLE \"NewRoles\" (        \"Id\" UUID    );    INSERT INTO \"GetAdminUnitList\" SELECT * FROM \"tsp_GetAdminUnitList\"(UserId);    INSERT INTO \"NewRoles\" SELECT \"Id\" FROM \"GetAdminUnitList\";    DELETE FROM \"SysAdminUnitInRole\" WHERE \"SysAdminUnitId\" = UserId;    INSERT INTO \"SysAdminUnitInRole\" (\"SysAdminUnitId\", \"SysAdminUnitRoleId\")        SELECT DISTINCT UserId, \"Id\" FROM \"NewRoles\";    -- User managers after actualization    DROP TABLE IF EXISTS \"ManagersAfterActualization\";    CREATE TEMP TABLE \"ManagersAfterActualization\" (        \"Id\" UUID    );    INSERT INTO \"ManagersAfterActualization\"        SELECT DISTINCT            \"SysUserInRole\".\"SysUserId\" \"Id\"        FROM \"SysAdminUnitInRole\"        INNER JOIN \"SysAdminUnit\" \"Roles\"            ON \"SysAdminUnitInRole\".\"SysAdminUnitRoleId\" = \"Roles\".\"Id\"        INNER JOIN \"NewRoles\" \"NewRoles\"            ON \"Roles\".\"ParentRoleId\" = \"NewRoles\".\"Id\"        INNER JOIN \"SysUserInRole\"            ON \"SysUserInRole\".\"SysRoleId\" = \"Roles\".\"Id\"        WHERE \"Roles\".\"SysAdminUnitTypeValue\" = 2;    -- New (who were not but become) user managers    DROP TABLE IF EXISTS \"NewManagers\";    CREATE TEMP TABLE \"NewManagers\" (        \"Id\" UUID    );    INSERT INTO \"NewManagers\"        SELECT \"Id\" FROM \"ManagersAfterActualization\" AS \"managersAfterActualization\"            WHERE NOT EXISTS (                SELECT NULL                FROM \"ManagersBeforeActualization\" AS \"managersBeforeActualization\"                WHERE \"managersBeforeActualization\".\"Id\" = \"managersAfterActualization\".\"Id\"            );    -- Add all user roles to new managers and their grantee-users, if they arent already have    FOR UserNewManager IN getUserNewManagers LOOP        EXIT WHEN UserNewManager = NULL;        INSERT INTO \"SysAdminUnitInRole\" (\"SysAdminUnitId\", \"SysAdminUnitRoleId\")            SELECT DISTINCT UserNewManager.\"Id\", \"Id\"            FROM \"NewRoles\" AS \"newRoles\"            WHERE NOT EXISTS (                SELECT 1                FROM \"SysAdminUnitInRole\"                WHERE \"SysAdminUnitInRole\".\"SysAdminUnitId\" = UserNewManager.\"Id\"                AND \"SysAdminUnitInRole\".\"SysAdminUnitRoleId\" = \"newRoles\".\"Id\"            );    END LOOP;    SELECT COUNT(*) INTO lostUserRolesCount    FROM \"OldUserRoles\" AS \"oldUserRoles\"    WHERE NOT EXISTS (        SELECT 1        FROM \"NewRoles\" AS \"newUserRoles\"        WHERE \"newUserRoles\".\"Id\" = \"oldUserRoles\".\"Id\"    );    -- Still (who were and remained) user managers    DROP TABLE IF EXISTS \"StillManagers\";    CREATE TEMP TABLE \"StillManagers\" (        \"Id\" UUID    );    INSERT INTO \"StillManagers\"        SELECT DISTINCT \"managersAfterActualization\".\"Id\" AS \"Id\"        FROM \"ManagersAfterActualization\" AS \"managersAfterActualization\"            JOIN \"ManagersBeforeActualization\" AS \"managersBeforeActualization\"                ON \"managersAfterActualization\".\"Id\" = \"managersBeforeActualization\".\"Id\";    -- If user lost at least one role, we need to actualize all his still-managers.    -- If not (user only gained new roles) - we just add to still-managers and their grantee-users new user roles.    IF lostUserRolesCount = 0 THEN        -- Add all new user roles to his still-managers and to their grantee-users        FOR UserStillManager IN getUserStillManagers LOOP            EXIT WHEN UserStillManager = NULL;            INSERT INTO \"SysAdminUnitInRole\" (\"SysAdminUnitId\", \"SysAdminUnitRoleId\")                SELECT DISTINCT UserStillManager.\"Id\", \"Id\"                FROM \"NewRoles\" AS \"newRoles\"                WHERE NOT EXISTS (                    SELECT 1                    FROM \"SysAdminUnitInRole\"                    WHERE \"SysAdminUnitInRole\".\"SysAdminUnitId\" = UserStillManager.\"Id\"                        AND \"SysAdminUnitInRole\".\"SysAdminUnitRoleId\" = \"newRoles\".\"Id\"                );        END LOOP;    ELSE        --Actualize all roles for still-managers        FOR UserStillManager IN getUserStillManagers LOOP            EXIT WHEN UserStillManager = NULL;            DELETE FROM \"SysAdminUnitRoles\";            INSERT INTO \"SysAdminUnitRoles\"                SELECT * FROM \"tsp_GetAdminUnitList\"(UserStillManager.\"Id\");                DELETE FROM \"SysAdminUnitInRole\" WHERE \"SysAdminUnitId\" = UserStillManager.\"Id\";                INSERT INTO \"SysAdminUnitInRole\" (\"SysAdminUnitId\", \"SysAdminUnitRoleId\")                    SELECT UserStillManager.\"Id\", \"Id\" FROM \"SysAdminUnitRoles\";        END LOOP;    END IF;    -- No longer (who were but not remained) user managers    DROP TABLE IF EXISTS \"NoLongerManagers\";    CREATE TEMP TABLE \"NoLongerManagers\" (        \"Id\" UUID    );    INSERT INTO \"NoLongerManagers\"        SELECT \"Id\" FROM \"ManagersBeforeActualization\" AS \"managersBeforeActualization\"            WHERE NOT EXISTS (                SELECT NULL                FROM \"ManagersAfterActualization\" AS \"managersAfterActualization\"                WHERE \"managersAfterActualization\".\"Id\" = \"managersBeforeActualization\".\"Id\"            );    -- Actualize roles for all noLonger-managers, his grantee-users and all grantee-users of user    FOR UserNoLongerManager IN getUserNoLongerManagers LOOP        EXIT WHEN UserNoLongerManager = NULL;        DELETE FROM \"SysAdminUnitRoles\";        INSERT INTO \"SysAdminUnitRoles\"            SELECT * FROM \"tsp_GetAdminUnitList\"(UserNoLongerManager.\"Id\");            DELETE FROM \"SysAdminUnitInRole\"                WHERE \"SysAdminUnitId\" = UserNoLongerManager.\"Id\";            INSERT INTO \"SysAdminUnitInRole\" (\"SysAdminUnitId\", \"SysAdminUnitRoleId\")                SELECT UserNoLongerManager.\"Id\", \"Id\" FROM \"SysAdminUnitRoles\";    END LOOP;    DROP TABLE IF EXISTS \"GetAdminUnitListTmp\";END;$$ LANGUAGE plpgsql;",
      "language": "sql",
      "context": "Example of an SQL script that creates a stored procedure. The stored procedure uses loops, cursors, and temporary tables.",
      "tab_label": "",
      "line_count": 1
    },
    {
      "code": "-- Recursive stored procedure that returns a table and uses PERFORM:-- MSSQLIF NOT OBJECT_ID('[dbo].[tsp_GetAdminUnitList]') IS NULLBEGIN    DROP PROCEDURE [dbo].[tsp_GetAdminUnitList];END;GOCREATE PROCEDURE dbo.tsp_GetAdminUnitList (    @UserId uniqueidentifier, @Granted BIT = 0)ASBEGIN    SET NOCOUNT ON;    DECLARE @StartNestedLevel INT;    IF object_id('tempdb..#AdminUnitList') IS NULL    BEGIN        CREATE TABLE [#AdminUnitList]        (            [Id] uniqueidentifier NOT NULL,            [Name] NVARCHAR(250) NULL,            [ParentRoleId] uniqueidentifier NULL,            [Granted] BIT NULL,            Level INT NOT NULL        );        SET @StartNestedLevel = @@NESTLEVEL;    END;    DECLARE @ConnectionType INT = (SELECT [ConnectionType] FROM SysAdminUnit WHERE [Id] = @UserId);    -- #AdminUnitListTemp should be created in tsp_ActualizeUserRoles or in tsp_ActualizeAdminUnitInRole    DECLARE @IsAdminUnitListTempExists BIT = OBJECT_ID('tempdb..#AdminUnitListTemp');    IF (@IsAdminUnitListTempExists IS NULL)    BEGIN        WITH        [MainSelect] AS (            SELECT                [Id] [Id],                [Name] [Name],                [ParentRoleId] [ParentRoleId]            FROM                [dbo].[SysAdminUnit]            WHERE                ([SysAdminUnitTypeValue] <= 4 OR [SysAdminUnitTypeValue] = 6)            AND [ConnectionType] = @ConnectionType            UNION ALL            SELECT                [Id] [Id],                [Name] [Name],                [ParentRoleId] [ParentRoleId]            FROM                [dbo].[SysAdminUnit]            WHERE                [Id] = @UserId),        [ChiefUnitsSelect] AS (            (                SELECT                    [Chief].[ParentRoleId] [Id]                FROM                    [dbo].[SysUserInRole] userInRole                    INNER JOIN [dbo].[SysAdminUnit] sau ON (sau.[Id] = userInRole.[SysUserId])                    INNER JOIN [dbo].[SysAdminUnit] [Chief] ON ([Chief].[Id] = userInRole.[SysRoleId])                WHERE                    sau.[Id] = @UserId AND NOT (userInRole.[SysRoleId] IS NULL) AND [Chief].[SysAdminUnitTypeValue] = 2                UNION ALL                SELECT                    [Chief].[ParentRoleId] [Id]                FROM                    [dbo].[SysAdminUnit] [Chief]                WHERE                    [Chief].[Id] = @UserId AND [Chief].[SysAdminUnitTypeValue] = 2            )            UNION ALL            SELECT                sau.[Id]            FROM                [ChiefUnitsSelect]                INNER JOIN [dbo].[SysAdminUnit] sau ON (sau.[ParentRoleId] = [ChiefUnitsSelect].[Id])            WHERE                sau.[SysAdminUnitTypeValue] < 4        ),        [HierarchicalSelect] AS (            SELECT                [Id],                [Name],                [ParentRoleId],                0 [Level]            FROM                [MainSelect] [SelectStartLevel]            WHERE                [Id] IN (                    SELECT                        userInRole.[SysRoleId]                    FROM                        [dbo].[SysUserInRole] userInRole                        INNER JOIN [dbo].[SysAdminUnit] sau ON (sau.[Id] = userInRole.[SysUserId])                    WHERE                        sau.[Id] = @UserId                    UNION ALL                    SELECT [Id] FROM [ChiefUnitsSelect]                    UNION ALL                    SELECT                        [Id]                    FROM                        [dbo].[SysAdminUnit]                    WHERE                        ([ParentRoleId] IS NULL OR [Id] = @UserId)                        AND [SysAdminUnitTypeValue] < 4                    UNION ALL                    SELECT                        [FuncRoleId]                    FROM                        [dbo].[SysFuncRoleInOrgRole]                    WHERE                        [SysFuncRoleInOrgRole].[OrgRoleId] = @UserId                    )            UNION ALL            SELECT                [SelectPriorLevel].[Id],                [SelectPriorLevel].[Name],                [SelectPriorLevel].[ParentRoleId],                [Level] + 1 level            FROM                [MainSelect] [SelectPriorLevel]                INNER JOIN [HierarchicalSelect] hierSelect ON (hierSelect.[ParentRoleId] = [SelectPriorLevel].[Id])        ),        [FuncRoleHierarchicalSelect] AS (            SELECT                [Id],                [Name],                [ParentRoleId],                0 [Level]            FROM                [MainSelect] [StartLevel]            WHERE EXISTS (                SELECT NULL                FROM [dbo].[SysFuncRoleInOrgRole] funcRoleInOrgRole                    INNER JOIN [HierarchicalSelect] hierSelect ON funcRoleInOrgRole.[OrgRoleId] = hierSelect.[Id]                WHERE funcRoleInOrgRole.[FuncRoleId] = [StartLevel].[Id]            )            UNION ALL            SELECT                [PriorLevel].[Id],                [PriorLevel].[Name],                [PriorLevel].[ParentRoleId],                [Level] + 1 level            FROM                [MainSelect] [PriorLevel]                INNER JOIN [FuncRoleHierarchicalSelect] funcRoleHierSelect ON (funcRoleHierSelect.[ParentRoleId] = [PriorLevel].[Id])        ),        [DependentUserSelect] AS (            SELECT                mainSelect.[Id] [Id],                mainSelect.[Name] [Name],                mainSelect.[ParentRoleId] [ParentRoleId],                0 [Level]            FROM                [MainSelect] mainSelect            INNER JOIN [SysUserInRole] userInRole                ON mainSelect.[Id] = userInRole.[SysUserId]            INNER JOIN [ChiefUnitsSelect] [AllUnits]                ON [AllUnits].[Id] = userInRole.[SysRoleId]            WHERE                NOT EXISTS (                        SELECT                            [UserUnits].[Id]                        FROM [ChiefUnitsSelect] [UserUnits]                        INNER JOIN [SysUserInRole] [UserInRole]                            ON [UserUnits].[Id] = [UserInRole].[SysRoleId]                        INNER JOIN [SysAdminUnit] sau                            ON sau.[Id] = [UserUnits].[Id]                        WHERE sau.[SysAdminUnitTypeValue] = 2                            AND [UserInRole].[SysUserId] = @UserId                            AND [UserUnits].[Id] = [AllUnits].[Id])        )        INSERT INTO [#AdminUnitList] ([Id], [Name], [ParentRoleId], [Granted], [Level])        SELECT DISTINCT            [Id],            [Name],            [ParentRoleId],            @Granted,            @@NESTLEVEL        FROM            (                SELECT                    [Id],                    [Name],                    [ParentRoleId]                FROM                    [HierarchicalSelect]                UNION ALL                SELECT                    [Id],                    [Name],                    [ParentRoleId]                FROM                    [dbo].[SysAdminUnit]                WHERE                    [Id] = @UserId            UNION ALL                SELECT                    [Id],                    [Name],                    [ParentRoleId]                FROM                    [FuncRoleHierarchicalSelect]            UNION ALL                SELECT                    [Id],                    [Name],                    [ParentRoleId]                FROM            [DependentUserSelect]        ) [AdminUnitList];    END ELSE    BEGIN        DECLARE @alreadyGotRolesForThisUser bit = 0;        IF (@IsAdminUnitListTempExists = 1)        BEGIN            SET @alreadyGotRolesForThisUser = (SELECT CAST( CASE WHEN EXISTS(SELECT 1 FROM [#AdminUnitListTemp]                    WHERE [UserId] = @UserId                    )                    THEN 1                    ELSE 0                END            AS BIT));        END;        IF (@alreadyGotRolesForThisUser = 1)        BEGIN            INSERT INTO [#AdminUnitList] ([Id], [Name], [ParentRoleId], [Granted], [Level])                SELECT DISTINCT                    [Id],                    [Name],                    [ParentRoleId],                    @Granted,                    @@NESTLEVEL                FROM [#AdminUnitListTemp] WHERE UserId = @UserId;        END ELSE        BEGIN            WITH            [MainSelect] AS (                SELECT                    [Id] [Id],                    [Name] [Name],                    [ParentRoleId] [ParentRoleId]                FROM                    [dbo].[SysAdminUnit]                WHERE                    ([SysAdminUnitTypeValue] <= 4 OR [SysAdminUnitTypeValue] = 6)                AND [ConnectionType] = @ConnectionType                UNION ALL                SELECT                    [Id] [Id],                    [Name] [Name],                    [ParentRoleId] [ParentRoleId]                FROM                    [dbo].[SysAdminUnit]                WHERE                    [Id] = @UserId),            [ChiefUnitsSelect] AS (                (                    SELECT                        [Chief].[ParentRoleId] [Id]                    FROM                        [dbo].[SysUserInRole] sysUserInRole                        INNER JOIN [dbo].[SysAdminUnit] sau ON (sau.[Id] = sysUserInRole.[SysUserId])                        INNER JOIN [dbo].[SysAdminUnit] [Chief] ON ([Chief].[Id] = sysUserInRole.[SysRoleId])                    WHERE                        sau.[Id] = @UserId AND NOT (sysUserInRole.[SysRoleId] IS NULL) AND [Chief].[SysAdminUnitTypeValue] = 2                    UNION ALL                    SELECT                        [Chief].[ParentRoleId] [Id]                    FROM                        [dbo].[SysAdminUnit] [Chief]                    WHERE                        [Chief].[Id] = @UserId AND [Chief].[SysAdminUnitTypeValue] = 2                )                UNION ALL                SELECT                    sau.[Id]                FROM                    [ChiefUnitsSelect] ChiefUnitsSelect                    INNER JOIN [dbo].[SysAdminUnit] sau ON (sau.[ParentRoleId] = [ChiefUnitsSelect].[Id])                WHERE                    sau.[SysAdminUnitTypeValue] < 4            ),            [HierarchicalSelect] AS (                SELECT                    [Id],                    [Name],                    [ParentRoleId],                    0 [Level]                FROM                    [MainSelect] [SelectStartLevel]                WHERE EXISTS (                    SELECT NULL                    FROM (                        SELECT [SysUserInRole].[SysRoleId] AS RoleId                        FROM [dbo].[SysUserInRole]                            INNER JOIN [dbo].[SysAdminUnit] ON ([SysAdminUnit].[Id] = [SysUserInRole].[SysUserId])                        WHERE [SysAdminUnit].[Id] = @UserId                        UNION ALL                        SELECT [Id] AS RoleId                        FROM [ChiefUnitsSelect]                        UNION ALL                        SELECT [Id] AS RoleId                        FROM [dbo].[SysAdminUnit]                        WHERE ([ParentRoleId] IS NULL OR [Id] = @UserId)                            AND [SysAdminUnitTypeValue] < 4                        UNION ALL                        SELECT [FuncRoleId] AS RoleId                        FROM [dbo].[SysFuncRoleInOrgRole]                        WHERE [SysFuncRoleInOrgRole].[OrgRoleId] = @UserId                    ) AS Roles                    WHERE Roles.RoleId = [SelectStartLevel].[Id]                )                UNION ALL                SELECT                    [SelectPriorLevel].[Id],                    [SelectPriorLevel].[Name],                    [SelectPriorLevel].[ParentRoleId],                    [Level] + 1 level                FROM                    [MainSelect] [SelectPriorLevel]                    INNER JOIN [HierarchicalSelect] hierSelect ON (hierSelect.[ParentRoleId] = [SelectPriorLevel].[Id])            ),            [FuncRoleHierarchicalSelect] AS (                SELECT                    [Id],                    [Name],                    [ParentRoleId],                    0 [Level]                FROM                    [MainSelect] [StartLevel]                WHERE EXISTS (                    SELECT NULL                    FROM [dbo].[SysFuncRoleInOrgRole] funcRoleInOrgRole                        INNER JOIN [HierarchicalSelect] hierSelect ON funcRoleInOrgRole.[OrgRoleId] = hierSelect.[Id]                    WHERE funcRoleInOrgRole.[FuncRoleId] = [StartLevel].[Id]                )                UNION ALL                SELECT                    [PriorLevel].[Id],                    [PriorLevel].[Name],                    [PriorLevel].[ParentRoleId],                    [Level] + 1                FROM                    [MainSelect] [PriorLevel]                    INNER JOIN [FuncRoleHierarchicalSelect] funcRolesHierSelect ON (funcRolesHierSelect.[ParentRoleId] = [PriorLevel].[Id])            ),            [DependentUserSelect] AS (                SELECT                    [MainSelect].[Id] [Id],                    [MainSelect].[Name] [Name],                    [MainSelect].[ParentRoleId] [ParentRoleId],                    0 [Level]                FROM                    [MainSelect]                INNER JOIN [SysUserInRole] sysUserInRole                    ON [MainSelect].[Id] = sysUserInRole.[SysUserId]                INNER JOIN [ChiefUnitsSelect] [AllUnits]                    ON [AllUnits].[Id] = sysUserInRole.[SysRoleId]                WHERE                    NOT EXISTS (                            SELECT                                [UserUnits].[Id]                            FROM [ChiefUnitsSelect] [UserUnits]                            INNER JOIN [SysUserInRole] [UserInRole]                                ON [UserUnits].[Id] = [UserInRole].[SysRoleId]                            INNER JOIN [SysAdminUnit] sau                                ON sau.[Id] = [UserUnits].[Id]                            WHERE sau.[SysAdminUnitTypeValue] = 2                                AND [UserInRole].[SysUserId] = @UserId                                AND [UserUnits].[Id] = [AllUnits].[Id])            )            INSERT INTO #AdminUnitListTemp ([UserId], [Id], [Name], [ParentRoleId], [Granted])            SELECT DISTINCT                @UserId,                [Id],                [Name],                [ParentRoleId],                @Granted            FROM                (                    SELECT                        [Id],                        [Name],                        [ParentRoleId]                    FROM                        [HierarchicalSelect]                    UNION ALL                    SELECT                        [Id],                        [Name],                        [ParentRoleId]                    FROM                        [dbo].[SysAdminUnit]                    WHERE                        [Id] = @UserId                UNION ALL                    SELECT                        [Id],                        [Name],                        [ParentRoleId]                    FROM                        [FuncRoleHierarchicalSelect]                UNION ALL                    SELECT                        [Id],                        [Name],                        [ParentRoleId]                    FROM                [DependentUserSelect]                ) [AdminUnitList];            INSERT INTO [#AdminUnitList] ([Id], [Name], [ParentRoleId], [Granted], [Level])            SELECT DISTINCT                [Id],                [Name],                [ParentRoleId],                @Granted,                @@NESTLEVEL            FROM [#AdminUnitListTemp] WHERE UserId = @UserId;        END;    END;    DECLARE @DependentUserId uniqueidentifier;    DECLARE @DependentUsersList CURSOR;    SET @DependentUsersList = CURSOR FOR        SELECT            [#AdminUnitList].[Id]        FROM            [#AdminUnitList]        INNER JOIN [SysAdminUnit] ON [#AdminUnitList].[Id] = [SysAdminUnit].[Id]        WHERE            [SysAdminUnit].[SysAdminUnitTypeValue] = 4 AND [#AdminUnitList].[Id] <> @UserId            AND [#AdminUnitList].[Granted] <> 1 AND [#AdminUnitList].[Level] >= @@NESTLEVEL;    OPEN @DependentUsersList;    FETCH NEXT    FROM @DependentUsersList INTO @DependentUserId;    WHILE @@FETCH_STATUS = 0    BEGIN        EXEC [tsp_GetAdminUnitList] @UserId=@DependentUserId, @Granted=1;    FETCH NEXT    FROM @DependentUsersList INTO @DependentUserId;    END;    CLOSE @DependentUsersList;    DEALLOCATE @DependentUsersList;    DECLARE @GrantorSysAdminUnitId uniqueidentifier;    DECLARE @getGrantorSysAdminUnitList CURSOR;    SET @getGrantorSysAdminUnitList = CURSOR FOR        SELECT            [GrantorSysAdminUnitId]        FROM            [dbo].[SysAdminUnitGrantedRight]        WHERE            [GranteeSysAdminUnitId] = @UserId            AND NOT EXISTS(SELECT * FROM [#AdminUnitList] WHERE [Id] = @UserId AND [Granted] = 1 AND [Level] < @@NESTLEVEL);    OPEN @getGrantorSysAdminUnitList;    FETCH NEXT    FROM @getGrantorSysAdminUnitList INTO @GrantorSysAdminUnitId;    WHILE @@FETCH_STATUS = 0    BEGIN        EXEC [tsp_GetAdminUnitList] @UserId=@GrantorSysAdminUnitId, @Granted=1;    FETCH NEXT    FROM @getGrantorSysAdminUnitList INTO @GrantorSysAdminUnitId;    END;    CLOSE @getGrantorSysAdminUnitList;    DEALLOCATE @getGrantorSysAdminUnitList;    IF @@NESTLEVEL = @StartNestedLevel    BEGIN        WITH QQ ([Id], [Name], [ParentRoleId], SysAdminUnitTypeValue) as (            SELECT DISTINCT adminUnitList.[Id],                adminUnitList.[Name],                adminUnitList.[ParentRoleId],                sau.SysAdminUnitTypeValue            FROM [#AdminUnitList] adminUnitList            INNER JOIN SysAdminUnit sau on sau.Id = adminUnitList.[Id]        )        SELECT [Id], [Name], [ParentRoleId] FROM QQ        ORDER BY SysAdminUnitTypeValue DESC;    END;END;GO",
      "language": "sql",
      "context": "Example of a recursive stored procedure that returns a table and usesPERFORM.",
      "tab_label": "",
      "line_count": 1
    },
    {
      "code": "-- Recursive stored procedure that returns a table and uses PERFORM:-- PostgreSQLDROP FUNCTION IF EXISTS \"tsp_GetAdminUnitList\";CREATE FUNCTION \"tsp_GetAdminUnitList\"(    UserId UUID,    IsGranted BOOLEAN = FALSE,    NestLevel INT = 0)RETURNS TABLE (    \"Id\" UUID,    \"Name\" VARCHAR(250),    \"ParentRoleId\" UUID)AS $$DECLARE    ConnectionType INT;    IsAdminUnitListTempExists BOOLEAN = FALSE;    DependentUserId UUID;    DependentUsersList CURSOR FOR        SELECT            \"AdminUnitList\".\"Id\"        FROM            \"AdminUnitList\"        INNER JOIN \"SysAdminUnit\" ON \"AdminUnitList\".\"Id\" = \"SysAdminUnit\".\"Id\"        WHERE            \"SysAdminUnit\".\"SysAdminUnitTypeValue\" = 4            AND \"AdminUnitList\".\"Id\" <> UserId            AND \"AdminUnitList\".\"Granted\" = FALSE            AND \"AdminUnitList\".\"Level\" >= NestLevel;    GrantorSysAdminUnitId UUID;    GetGrantorSysAdminUnitList CURSOR FOR        SELECT            \"GrantorSysAdminUnitId\" AS \"Id\"        FROM            \"SysAdminUnitGrantedRight\"        WHERE            \"GranteeSysAdminUnitId\" = UserId            AND NOT EXISTS (                SELECT *                FROM \"AdminUnitList\"                WHERE \"AdminUnitList\".\"Id\" = UserId                    AND \"AdminUnitList\".\"Granted\" = TRUE                    AND \"AdminUnitList\".\"Level\" < NestLevel            );    ParentRoleId UUID = NULL;BEGIN    IF NestLevel = 0 THEN        CREATE TEMPORARY TABLE IF NOT EXISTS \"AdminUnitList\" (            \"Id\" UUID,            \"Name\" VARCHAR(250),            \"ParentRoleId\" UUID,            \"Granted\" BOOLEAN,            \"Level\" INT        );        TRUNCATE TABLE \"AdminUnitList\";    END IF;    SELECT \"ConnectionType\" INTO ConnectionType FROM \"SysAdminUnit\" WHERE \"SysAdminUnit\".\"Id\" = UserId;    WITH RECURSIVE \"MainSelect\" AS (        SELECT            \"SysAdminUnit\".\"Id\" \"Id\",            \"SysAdminUnit\".\"Name\" \"Name\",            \"SysAdminUnit\".\"ParentRoleId\" \"ParentRoleId\"        FROM            \"SysAdminUnit\"        WHERE            (\"SysAdminUnitTypeValue\" <= 4 OR \"SysAdminUnitTypeValue\" = 6)        AND \"ConnectionType\" = ConnectionType        UNION ALL        SELECT            \"SysAdminUnit\".\"Id\" \"Id\",            \"SysAdminUnit\".\"Name\" \"Name\",            \"SysAdminUnit\".\"ParentRoleId\" \"ParentRoleId\"        FROM            \"SysAdminUnit\"        WHERE            \"SysAdminUnit\".\"Id\" = UserId),        \"ChiefUnitsSelect\" AS (            SELECT                \"chief\".\"ParentRoleId\" \"Id\"            FROM                \"SysUserInRole\" AS \"userInRole\"                INNER JOIN \"SysAdminUnit\" AS \"sau\" ON (\"sau\".\"Id\" = \"userInRole\".\"SysUserId\")                INNER JOIN \"SysAdminUnit\" AS \"chief\" ON (\"chief\".\"Id\" = \"userInRole\".\"SysRoleId\")            WHERE                \"sau\".\"Id\" = UserId                AND \"userInRole\".\"SysRoleId\" IS NOT NULL                AND \"chief\".\"SysAdminUnitTypeValue\" = 2            UNION ALL            SELECT                \"chief\".\"ParentRoleId\" \"Id\"            FROM                \"SysAdminUnit\" \"chief\"            WHERE                \"chief\".\"Id\" = UserId AND \"chief\".\"SysAdminUnitTypeValue\" = 2            UNION ALL            SELECT                \"sau\".\"Id\"            FROM                \"ChiefUnitsSelect\"                INNER JOIN \"SysAdminUnit\" \"sau\" ON (\"sau\".\"ParentRoleId\" = \"ChiefUnitsSelect\".\"Id\")            WHERE                \"sau\".\"SysAdminUnitTypeValue\" < 4        ),        \"HierarchicalSelect\" AS (            SELECT                \"SelectStartLevel\".\"Id\",                \"SelectStartLevel\".\"Name\",                \"SelectStartLevel\".\"ParentRoleId\",                0 \"Level\"            FROM                \"MainSelect\" \"SelectStartLevel\"            WHERE                \"SelectStartLevel\".\"Id\" IN (                    SELECT                        \"userInRole\".\"SysRoleId\"                    FROM                        \"SysUserInRole\" AS \"userInRole\"                        INNER JOIN \"SysAdminUnit\" AS \"sau\" ON (\"sau\".\"Id\" = \"userInRole\".\"SysUserId\")                    WHERE                        \"sau\".\"Id\" = UserId                    UNION ALL                    SELECT \"ChiefUnitsSelect\".\"Id\"                    FROM \"ChiefUnitsSelect\"                    UNION ALL                    SELECT                        \"SysAdminUnit\".\"Id\"                    FROM                        \"SysAdminUnit\"                    WHERE                        (\"SysAdminUnit\".\"ParentRoleId\" IS NULL OR \"SysAdminUnit\".\"Id\" = UserId)                        AND \"SysAdminUnitTypeValue\" < 4                    UNION ALL                    SELECT                        \"FuncRoleId\"                    FROM                        \"SysFuncRoleInOrgRole\"                    WHERE                        \"SysFuncRoleInOrgRole\".\"OrgRoleId\" = UserId                    )            UNION ALL            SELECT                \"SelectPriorLevel\".\"Id\",                \"SelectPriorLevel\".\"Name\",                \"SelectPriorLevel\".\"ParentRoleId\",                \"Level\" + 1 \"level\"            FROM                \"MainSelect\" \"SelectPriorLevel\"                INNER JOIN \"HierarchicalSelect\" AS \"hierSelect\" ON (\"hierSelect\".\"ParentRoleId\" = \"SelectPriorLevel\".\"Id\")        ),        \"FuncRoleHierarchicalSelect\" AS (            SELECT                \"StartLevel\".\"Id\",                \"StartLevel\".\"Name\",                \"StartLevel\".\"ParentRoleId\",                0 \"Level\"            FROM                \"MainSelect\" \"StartLevel\"            WHERE EXISTS (                SELECT NULL                FROM \"SysFuncRoleInOrgRole\" AS \"funcRoleInOrgRole\"                    INNER JOIN \"HierarchicalSelect\" AS \"hierSelect\" ON \"funcRoleInOrgRole\".\"OrgRoleId\" = \"hierSelect\".\"Id\"                WHERE \"funcRoleInOrgRole\".\"FuncRoleId\" = \"StartLevel\".\"Id\"            )            UNION ALL            SELECT                \"PriorLevel\".\"Id\",                \"PriorLevel\".\"Name\",                \"PriorLevel\".\"ParentRoleId\",                \"Level\" + 1 \"level\"            FROM                \"MainSelect\" \"PriorLevel\"                INNER JOIN \"FuncRoleHierarchicalSelect\" AS \"funcRoleHierSelect\" ON (\"funcRoleHierSelect\".\"ParentRoleId\" = \"PriorLevel\".\"Id\")        ),        \"DependentUserSelect\" AS (            SELECT                \"mainSelect\".\"Id\" \"Id\",                \"mainSelect\".\"Name\" \"Name\",                \"mainSelect\".\"ParentRoleId\" \"ParentRoleId\",                0 \"Level\"            FROM                \"MainSelect\" AS \"mainSelect\"            INNER JOIN \"SysUserInRole\" AS \"userInRole\"                ON \"mainSelect\".\"Id\" = \"userInRole\".\"SysUserId\"            INNER JOIN \"ChiefUnitsSelect\" AS \"AllUnits\"                ON \"AllUnits\".\"Id\" = \"userInRole\".\"SysRoleId\"            WHERE                NOT EXISTS (                        SELECT                            \"UserUnits\".\"Id\"                        FROM \"ChiefUnitsSelect\" AS \"UserUnits\"                        INNER JOIN \"SysUserInRole\" AS \"UserInRole\"                            ON \"UserUnits\".\"Id\" = \"UserInRole\".\"SysRoleId\"                        INNER JOIN \"SysAdminUnit\" AS \"sau\"                            ON \"sau\".\"Id\" = \"UserUnits\".\"Id\"                        WHERE \"sau\".\"SysAdminUnitTypeValue\" = 2                            AND \"UserInRole\".\"SysUserId\" = UserId                            AND \"UserUnits\".\"Id\" = \"AllUnits\".\"Id\")        )        INSERT INTO \"AdminUnitList\" (\"Id\", \"Name\", \"ParentRoleId\", \"Granted\", \"Level\")        SELECT DISTINCT            \"AdminUnitList\".\"Id\",            \"AdminUnitList\".\"Name\",            \"AdminUnitList\".\"ParentRoleId\",            IsGranted,            NestLevel        FROM (            SELECT                \"HierarchicalSelect\".\"Id\",                \"HierarchicalSelect\".\"Name\",                \"HierarchicalSelect\".\"ParentRoleId\"            FROM \"HierarchicalSelect\"            UNION ALL            SELECT                \"SysAdminUnit\".\"Id\",                \"SysAdminUnit\".\"Name\",                \"SysAdminUnit\".\"ParentRoleId\"            FROM \"SysAdminUnit\"            WHERE                \"SysAdminUnit\".\"Id\" = UserId            UNION ALL            SELECT                \"FuncRoleHierarchicalSelect\".\"Id\",                \"FuncRoleHierarchicalSelect\".\"Name\",                \"FuncRoleHierarchicalSelect\".\"ParentRoleId\"            FROM \"FuncRoleHierarchicalSelect\"            UNION ALL            SELECT                \"DependentUserSelect\".\"Id\",                \"DependentUserSelect\".\"Name\",                \"DependentUserSelect\".\"ParentRoleId\"            FROM \"DependentUserSelect\"        ) AS \"AdminUnitList\";    DependentUsersList := 'DependentUsersList' || NestLevel ;    FOR DependentUser IN DependentUsersList LOOP        EXIT WHEN DependentUser = NULL;        DependentUserId = DependentUser.\"Id\";        PERFORM \"tsp_GetAdminUnitList\"(DependentUserId, 1, NestLevel + 1);    END LOOP;    GetGrantorSysAdminUnitList := 'GetGrantorSysAdminUnitList' || NestLevel ;    FOR GrantorSysAdminUnit IN GetGrantorSysAdminUnitList LOOP        EXIT WHEN GrantorSysAdminUnit = NULL;        GrantorSysAdminUnitId = GrantorSysAdminUnit.\"Id\";        PERFORM \"tsp_GetAdminUnitList\"(GrantorSysAdminUnitId, 1, NestLevel + 1);    END LOOP;    IF NestLevel = 0 THEN        RETURN QUERY        SELECT \"QQ\".\"Id\",                \"QQ\".\"Name\",                \"QQ\".\"ParentRoleId\"        FROM (            SELECT DISTINCT                \"AdminUnitList\".\"Id\",                \"AdminUnitList\".\"Name\",                \"AdminUnitList\".\"ParentRoleId\",                \"sau\".\"SysAdminUnitTypeValue\"            FROM \"AdminUnitList\"            INNER JOIN \"SysAdminUnit\" AS \"sau\" ON \"sau\".\"Id\" = \"AdminUnitList\".\"Id\") AS \"QQ\"        ORDER BY \"QQ\".\"SysAdminUnitTypeValue\" DESC;    END IF;END;$$ LANGUAGE plpgsql;",
      "language": "sql",
      "context": "Example of a recursive stored procedure that returns a table and usesPERFORM.",
      "tab_label": "",
      "line_count": 1
    },
    {
      "code": "-- Stored procedure that uses exception handling and executes a custom script-- MSSQLIF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[tsp_CanConvertData]') AND type IN (N'P', N'PC'))DROP PROCEDURE [dbo].[tsp_CanConvertData]GOCREATE PROCEDURE [dbo].[tsp_CanConvertData]    @EntitySchemaName SYSNAME,    @SourceColumnName SYSNAME,    @NewColumnDataType SYSNAME,    @Result BIT OUTASBEGIN    SET NOCOUNT ON    SET @Result = 0    DECLARE @sql NVARCHAR(MAX)    DECLARE @unicodeCharLength INT = 2    DECLARE @dataTypeName SYSNAME    DECLARE @dataTypeSize INT    DECLARE @dataTypePrecision INT    SELECT        @dataTypeName = UPPER(DATA_TYPE),        @dataTypeSize =        CASE            WHEN CHARACTER_MAXIMUM_LENGTH IS NULL THEN NUMERIC_PRECISION            ELSE CHARACTER_MAXIMUM_LENGTH        END,        @dataTypePrecision = ISNULL(NUMERIC_SCALE, 0)    FROM INFORMATION_SCHEMA.COLUMNS    WHERE TABLE_NAME = @EntitySchemaName    AND COLUMN_NAME = @SourceColumnName    IF (@dataTypeName IS NULL)    BEGIN        RETURN    END    DECLARE @newDataTypeName SYSNAME    DECLARE @newDataTypeSize INT    DECLARE @newDataTypePrecision INT    DEClARE @i INT    DECLARE @newDataTypeSizeDefinition NVARCHAR(MAX)    SET @i = CHARINDEX('(', @NewColumnDataType)    IF (@i = 0)    BEGIN        SET @newDataTypeName = @NewColumnDataType        SET @newDataTypeSize = 0        SET @newDataTypePrecision = 0    END ELSE    BEGIN        SET @newDataTypeName = UPPER(LTRIM(RTRIM(SUBSTRING(@NewColumnDataType, 1, @i - 1))))        SET @newDataTypeSizeDefinition = LTRIM(RTRIM(SUBSTRING(@NewColumnDataType, @i + 1,            LEN(@NewColumnDataType))))        SET @i = CHARINDEX(')', @newDataTypeSizeDefinition)        IF (@i > 0)        BEGIN            SET @newDataTypeSizeDefinition = LTRIM(RTRIM(SUBSTRING(@newDataTypeSizeDefinition, 1, @i - 1)))        END        SET @i = CHARINDEX(',', @newDataTypeSizeDefinition)        IF (@i > 0)        BEGIN            SET @newDataTypeSize = CAST(LTRIM(RTRIM(SUBSTRING(@newDataTypeSizeDefinition, 1, @i - 1))) AS INT)            SET @newDataTypePrecision = CAST(LTRIM(RTRIM(SUBSTRING(@newDataTypeSizeDefinition, @i + 1,                LEN(@newDataTypeSizeDefinition)))) AS INT)        END ELSE        BEGIN            SET @newDataTypePrecision = 0            IF (UPPER(@newDataTypeSizeDefinition) = 'MAX')            BEGIN                SET @newDataTypeSize = -1            END ELSE            BEGIN                SET @newDataTypeSize = CAST(@newDataTypeSizeDefinition AS INT)            END        END    END    DECLARE @ImplicitDataConvertTable TABLE (        SourceDataType SYSNAME,        DestinationDataType SYSNAME    )    INSERT INTO @ImplicitDataConvertTable    SELECT 'INT', 'INT'    UNION ALL    SELECT 'INT', 'BIT'    UNION ALL    SELECT 'INT', 'DECIMAL'    UNION ALL    SELECT 'INT', 'VARCHAR'    UNION ALL    SELECT 'INT', 'NVARCHAR'    UNION ALL    SELECT 'INT', 'VARBINARY'    UNION ALL    SELECT 'BIT', 'BIT'    UNION ALL    SELECT 'BIT', 'INT'    UNION ALL    SELECT 'BIT', 'DECIMAL'    UNION ALL    SELECT 'BIT', 'VARCHAR'    UNION ALL    SELECT 'BIT', 'NVARCHAR'    UNION ALL    SELECT 'BIT', 'VARBINARY'    UNION ALL    SELECT 'DECIMAL', 'BIT'    UNION ALL    SELECT 'UNIQUEIDENTIFIER', 'UNIQUEIDENTIFIER'    UNION ALL    SELECT 'UNIQUEIDENTIFIER', 'VARBINARY'    UNION ALL    SELECT 'VARCHAR', 'INT'    UNION ALL    SELECT 'VARCHAR', 'BIT'    UNION ALL    SELECT 'VARCHAR', 'UNIQUEIDENTIFIER'    UNION ALL    SELECT 'DATETIME2', 'DATETIME2'    UNION ALL    SELECT 'DATETIME2', 'DATE'    UNION ALL    SELECT 'DATETIME2', 'TIME'    UNION ALL    SELECT 'DATETIME2', 'VARCHAR'    UNION ALL    SELECT 'DATE', 'DATE'    UNION ALL    SELECT 'DATE', 'DATETIME2'    UNION ALL    SELECT 'DATE', 'VARCHAR'    UNION ALL    SELECT 'DATE', 'NVARCHAR'    UNION ALL    SELECT 'TIME', 'TIME'    UNION ALL    SELECT 'TIME', 'DATETIME2'    UNION ALL    SELECT 'TIME', 'VARCHAR'    UNION ALL    SELECT 'TIME', 'NVARCHAR'    UNION ALL    SELECT 'VARBINARY', 'INT'    UNION ALL    SELECT 'VARBINARY', 'BIT'    UNION ALL    SELECT 'VARBINARY', 'UNIQUEIDENTIFIER'    IF EXISTS(SELECT * FROM @ImplicitDataConvertTable        WHERE SourceDataType = @dataTypeName AND DestinationDataType = @newDataTypeName)    BEGIN        SET @Result = 1        RETURN    END    DECLARE @ImplicitDataOverflowConvertTable TABLE (        SourceDataType SYSNAME,        DestinationDataType SYSNAME    )    INSERT INTO @ImplicitDataOverflowConvertTable    SELECT 'DECIMAL', 'INT'    UNION ALL    SELECT 'DECIMAL', 'DECIMAL'    UNION ALL    SELECT 'DECIMAL', 'VARCHAR'    UNION ALL    SELECT 'DECIMAL', 'NVARCHAR'    UNION ALL    SELECT 'DECIMAL', 'VARBINARY'    UNION ALL    SELECT 'UNIQUEIDENTIFIER', 'VARCHAR'    UNION ALL    SELECT 'UNIQUEIDENTIFIER', 'NVARCHAR'    UNION ALL    SELECT 'VARCHAR', 'INT'    UNION ALL    SELECT 'VARCHAR', 'BIT'    UNION ALL    SELECT 'VARCHAR', 'DECIMAL'    UNION ALL    SELECT 'VARCHAR', 'VARCHAR'    UNION ALL    SELECT 'VARCHAR', 'NVARCHAR'    UNION ALL    SELECT 'NVARCHAR', 'INT'    UNION ALL    SELECT 'NVARCHAR', 'BIT'    UNION ALL    SELECT 'NVARCHAR', 'DECIMAL'    UNION ALL    SELECT 'NVARCHAR', 'VARCHAR'    UNION ALL    SELECT 'NVARCHAR', 'NVARCHAR'    UNION ALL    SELECT 'VARBINARY', 'VARCHAR'    UNION ALL    SELECT 'VARBINARY', 'NVARCHAR'    UNION ALL    SELECT 'VARBINARY', 'VARBINARY'    IF EXISTS(SELECT * FROM @ImplicitDataOverflowConvertTable        WHERE SourceDataType = @dataTypeName AND DestinationDataType = @newDataTypeName)    BEGIN        SET @sql = N'IF EXISTS(SELECT * FROM [' + @EntitySchemaName + ']) SET @Result = 0 ELSE SET @Result = 1'        EXEC sp_executesql @sql, N'@Result BIT OUT', @Result = @Result OUT        IF (@Result = 1)        BEGIN            RETURN        END        BEGIN TRY            IF (@dataTypeName = 'DECIMAL' AND @newDataTypeName = 'INT') OR                (@dataTypeName = 'DECIMAL' AND @newDataTypeName = 'VARCHAR') OR                (@dataTypeName = 'DECIMAL' AND @newDataTypeName = 'NVARCHAR') OR                (@dataTypeName = 'DECIMAL' AND @newDataTypeName = 'VARBINARY') OR                (@dataTypeName = 'DECIMAL' AND @newDataTypeName = 'DECIMAL')            BEGIN                DECLARE @cnt INT                DECLARE @ConvertDescription NVARCHAR(MAX)                SET @ConvertDescription = 'CONVERT(' + @NewColumnDataType +', [' + @SourceColumnName+ '])'                SET @sql = N'IF EXISTS(SELECT * FROM [' + @EntitySchemaName + '] WHERE ' +                @ConvertDescription + ' = ' + @ConvertDescription + ') SET @cnt = 1 ELSE SET @cnt = 0'                EXEC sp_executesql @sql, N'@cnt INT OUT', @cnt = @cnt OUT                SET @Result = 1            END ELSE            BEGIN                DECLARE @dl INT                SET @sql = N'SELECT @dl = MAX(DATALENGTH([' + @SourceColumnName + '])) ' +                'FROM [' + @EntitySchemaName + ']'                EXEC sp_executesql @sql, N'@dl INT OUT', @dl = @dl OUT                IF (@newDataTypeName IN ('VARCHAR', 'NVARCHAR', 'VARBINARY') AND @newDataTypeSize = -1)                BEGIN                    SET @Result = 1                END ELSE                IF (@dl <= @newDataTypeSize OR (                    @newDataTypeName IN ('NVARCHAR', 'NCHAR') AND (@dl / @unicodeCharLength) <= @newDataTypeSize))                BEGIN                    SET @Result = 1                END ELSE                BEGIN                    SET @Result = 0                END            END        END TRY        BEGIN CATCH            SET @Result = 0        END CATCH    END ELSE    BEGIN        SET @Result = 0    ENDENDGO",
      "language": "sql",
      "context": "Example of a stored procedure that uses exception handling and executes a custom script.",
      "tab_label": "",
      "line_count": 1
    },
    {
      "code": "-- Stored procedure that uses exception handling and executes a custom scrip-- PostgreSQLDROP FUNCTION IF EXISTS public.\"tsp_CanConvertData\" CASCADE;CREATE FUNCTION public.\"tsp_CanConvertData\"(    EntitySchemaName NAME,    SourceColumnName NAME,    NewColumnDataType NAME,    CanConvert OUT BOOLEAN)AS $BODY$DECLARE    dataTypeName NAME;    newDataTypeName NAME;    newDataTypeSize INTEGER;    countRow INTEGER;    dataLength INTEGER;    convertDescription TEXT;    unicodeCharLength INTEGER = 2;    sqlQuery TEXT;    castQuery TEXT;BEGIN    CanConvert = FALSE;    dataTypeName = (        SELECT UPPER(data_type) FROM information_schema.columns        WHERE table_name = EntitySchemaName AND column_name = SourceColumnName);    IF dataTypeName IS NULL THEN        RETURN;    END IF;    SELECT \"fn_ParseDataType\".DataTypeName, \"fn_ParseDataType\".DataTypeSize    FROM public.\"fn_ParseDataType\"(NewColumnDataType)    INTO newDataTypeName, newDataTypeSize;    DROP TABLE IF EXISTS \"NotConvertTable\";    CREATE TEMP TABLE \"NotConvertTable\" (        SourceDataType NAME,        DestinationDataType NAME    );    INSERT INTO \"NotConvertTable\" VALUES        ('INTEGER', 'UUID'),        ('INTEGER', 'TIMESTAMP WITHOUT TIME ZONE'),        ('INTEGER', 'DATE'),        ('INTEGER', 'TIME WITHOUT TIME ZONE'),        ('NUMERIC', 'UUID'),        ('NUMERIC', 'TIMESTAMP WITHOUT TIME ZONE'),        ('NUMERIC', 'DATE'),        ('NUMERIC', 'TIME WITHOUT TIME ZONE'),        ('BOOLEAN', 'UUID'),        ('BOOLEAN', 'TIMESTAMP WITHOUT TIME ZONE'),        ('BOOLEAN', 'DATE'),        ('BOOLEAN', 'TIME WITHOUT TIME ZONE'),        ('UUID', 'INTEGER'),        ('UUID', 'NUMERIC'),        ('UUID', 'BOOLEAN'),        ('UUID', 'TIMESTAMP WITHOUT TIME ZONE'),        ('UUID', 'DATE'),        ('UUID', 'TIME WITHOUT TIME ZONE'),        ('TIMESTAMP WITHOUT TIME ZONE', 'INTEGER'),        ('TIMESTAMP WITHOUT TIME ZONE', 'NUMERIC'),        ('TIMESTAMP WITHOUT TIME ZONE', 'BOOLEAN'),        ('TIMESTAMP WITHOUT TIME ZONE', 'UUID'),        ('DATE', 'INTEGER'),        ('DATE', 'NUMERIC'),        ('DATE', 'BOOLEAN'),        ('DATE', 'UUID'),        ('DATE', 'TIME WITHOUT TIME ZONE'),        ('TIME WITHOUT TIME ZONE', 'INTEGER'),        ('TIME WITHOUT TIME ZONE', 'NUMERIC'),        ('TIME WITHOUT TIME ZONE', 'BOOLEAN'),        ('TIME WITHOUT TIME ZONE', 'UUID'),        ('TIME WITHOUT TIME ZONE', 'DATE');    IF EXISTS(SELECT SourceDataType, DestinationDataType FROM \"NotConvertTable\"        WHERE SourceDataType = dataTypeName AND DestinationDataType = newDataTypeName) THEN        RETURN;    END IF;    DROP TABLE IF EXISTS ImplicitDataConvertTable;    CREATE TEMP TABLE ImplicitDataConvertTable (        SourceDataType NAME,        DestinationDataType NAME    );    INSERT INTO ImplicitDataConvertTable VALUES        ('INTEGER', 'INTEGER'),        ('INTEGER', 'NUMERIC'),        ('INTEGER', 'BOOLEAN'),        ('INTEGER', 'CHARACTER VARYING'),        ('INTEGER', 'TEXT'),        ('NUMERIC', 'CHARACTER VARYING'),        ('NUMERIC', 'TEXT'),        ('BOOLEAN', 'INTEGER'),        ('BOOLEAN', 'BOOLEAN'),        ('BOOLEAN', 'CHARACTER VARYING'),        ('BOOLEAN', 'TEXT'),        ('CHARACTER VARYING', 'TEXT'),        ('CHARACTER VARYING', 'BYTEA'),        ('TEXT', 'TEXT'),        ('TEXT', 'BYTEA'),        ('BYTEA', 'BYTEA'),        ('UUID', 'CHARACTER VARYING'),        ('UUID', 'TEXT'),        ('UUID', 'UUID'),        ('TIMESTAMP WITHOUT TIME ZONE', 'CHARACTER VARYING'),        ('TIMESTAMP WITHOUT TIME ZONE', 'TEXT'),        ('TIMESTAMP WITHOUT TIME ZONE', 'TIMESTAMP WITHOUT TIME ZONE'),        ('DATE', 'CHARACTER VARYING'),        ('DATE', 'TEXT'),        ('DATE', 'TIMESTAMP WITHOUT TIME ZONE'),        ('DATE', 'DATE'),        ('TIME WITHOUT TIME ZONE', 'CHARACTER VARYING'),        ('TIME WITHOUT TIME ZONE', 'TEXT'),        ('TIME WITHOUT TIME ZONE', 'TIMESTAMP WITHOUT TIME ZONE'),        ('TIME WITHOUT TIME ZONE', 'TIME WITHOUT TIME ZONE'),        ('TIMESTAMP WITHOUT TIME ZONE', 'DATE'),        ('TIMESTAMP WITHOUT TIME ZONE', 'TIME WITHOUT TIME ZONE'),        ('INTEGER', 'BYTEA'),        ('NUMERIC', 'BOOLEAN'),        ('NUMERIC', 'BYTEA'),        ('BOOLEAN', 'NUMERIC'),        ('BOOLEAN', 'BYTEA'),        ('UUID', 'BYTEA'),        ('TIMESTAMP WITHOUT TIME ZONE', 'BYTEA'),        ('DATE', 'BYTEA'),        ('TIME WITHOUT TIME ZONE', 'BYTEA'),        ('NUMERIC', 'INTEGER'),        ('NUMERIC', 'NUMERIC');    IF EXISTS(SELECT SourceDataType, DestinationDataType FROM ImplicitDataConvertTable        WHERE SourceDataType = dataTypeName AND DestinationDataType = newDataTypeName) THEN        CanConvert = TRUE;        RETURN;    END IF;    EXECUTE FORMAT('SELECT count(*) FROM %1$I', EntitySchemaName) INTO countRow;    CanConvert = (countRow = 0);    IF CanConvert THEN        RETURN;    END IF;    DROP TABLE IF EXISTS \"ExplicitDataConvertTable\";    CREATE TEMP TABLE \"ExplicitDataConvertTable\" (        SourceDataType NAME,        DestinationDataType NAME    );    INSERT INTO \"ExplicitDataConvertTable\" VALUES        ('CHARACTER VARYING', 'INTEGER'),        ('CHARACTER VARYING', 'NUMERIC'),        ('CHARACTER VARYING', 'BOOLEAN'),        ('CHARACTER VARYING', 'UUID'),        ('CHARACTER VARYING', 'TIMESTAMP WITHOUT TIME ZONE'),        ('CHARACTER VARYING', 'DATE'),        ('CHARACTER VARYING', 'TIME WITHOUT TIME ZONE'),        ('TEXT', 'INTEGER'),        ('TEXT', 'NUMERIC'),        ('TEXT', 'BOOLEAN'),        ('TEXT', 'UUID'),        ('TEXT', 'TIMESTAMP WITHOUT TIME ZONE'),        ('TEXT', 'DATE'),        ('TEXT', 'TIME WITHOUT TIME ZONE'),        ('BYTEA', 'INTEGER'),        ('BYTEA', 'NUMERIC'),        ('BYTEA', 'BOOLEAN'),        ('BYTEA', 'UUID'),        ('BYTEA', 'TIMESTAMP WITHOUT TIME ZONE'),        ('BYTEA', 'DATE'),        ('BYTEA', 'TEXT'),        ('BYTEA', 'TIME WITHOUT TIME ZONE'),        ('NUMERIC', 'BOOLEAN');    IF EXISTS(SELECT SourceDataType, DestinationDataType FROM \"ExplicitDataConvertTable\"        WHERE SourceDataType = dataTypeName AND DestinationDataType = newDataTypeName) THEN        castQuery = FORMAT('CAST(%1$I%3$s AS %2$s)', SourceColumnName, NewColumnDataType,            CASE                WHEN dataTypeName = 'BYTEA' THEN '::TEXT'                WHEN dataTypeName = 'NUMERIC' THEN '::INTEGER'                ELSE ''            END);        sqlQuery = FORMAT('SELECT COUNT(*) FROM %1$I WHERE %2$s = %2$s',            EntitySchemaName, castQuery);        BEGIN            EXECUTE sqlQuery;            CanConvert = TRUE;        EXCEPTION WHEN OTHERS THEN            CanConvert = FALSE;        END;        RETURN;    END IF;    DROP TABLE IF EXISTS \"ImplicitDataOverflowConvertTable\";    CREATE TEMP TABLE \"ImplicitDataOverflowConvertTable\" (        SourceDataType NAME,        DestinationDataType NAME    );    INSERT INTO \"ImplicitDataOverflowConvertTable\" VALUES        ('CHARACTER VARYING', 'CHARACTER VARYING'),        ('TEXT', 'CHARACTER VARYING'),        ('BYTEA', 'CHARACTER VARYING');    IF EXISTS(SELECT SourceDataType, DestinationDataType FROM \"ImplicitDataOverflowConvertTable\"        WHERE SourceDataType = dataTypeName AND DestinationDataType = newDataTypeName) THEN        EXECUTE FORMAT('SELECT count(*) FROM %1$I', EntitySchemaName) INTO countRow;        CanConvert = (countRow = 0);        IF CanConvert THEN            RETURN;        END IF;        BEGIN            EXECUTE FORMAT('SELECT MAX(PG_COLUMN_SIZE(%1$I)) FROM %2$I', SourceColumnName, EntitySchemaName)            INTO dataLength;            IF (dataLength <= newDataTypeSize) THEN                CanConvert = TRUE;            ELSE                CanConvert = FALSE;            END IF;        EXCEPTION WHEN OTHERS THEN            CanConvert = FALSE;        END;    END IF;END;$BODY$LANGUAGE 'plpgsql';",
      "language": "sql",
      "context": "Example of a stored procedure that uses exception handling and executes a custom script.",
      "tab_label": "",
      "line_count": 1
    },
    {
      "code": "-- Function-- MSSQLIF  EXISTS (SELECT * FROM sys.objects        WHERE object_id = OBJECT_ID(N'[dbo].[fn_IsGuid]') AND type = N'FN')DROP FUNCTION [dbo].[fn_IsGuid]GOCREATE FUNCTION [dbo].[fn_IsGuid] (    @ValidateValue NVARCHAR(MAX))RETURNS BITASBEGIN    DECLARE @hasLeftBraces BIT    IF @ValidateValue LIKE '{%'    BEGIN        SET @ValidateValue = SUBSTRING(@ValidateValue, 2, LEN(@ValidateValue) - 1)        SET @hasLeftBraces = 1    END ELSE    BEGIN        SET @hasLeftBraces = 0    END    DECLARE @hasRightBraces BIT    IF @ValidateValue LIKE '%}'    BEGIN        SET @ValidateValue = SUBSTRING(@ValidateValue, 1, LEN(@ValidateValue) - 1)        SET @hasRightBraces = 1    END ELSE    BEGIN        SET @hasRightBraces = 0    END    DECLARE @Result BIT    IF @ValidateValue LIKE '[0-9a-fA-F][0-9a-fA-F][0-9a-fA-F][0-9a-fA-F][0-9a-fA-F][0-9a-fA-F][0-9a-fA-F][0-9a-fA-F]-[0-9a-fA-F][0-9a-fA-F][0-9a-fA-F][0-9a-fA-F]-[0-9a-fA-F][0-9a-fA-F][0-9a-fA-F][0-9a-fA-F]-[0-9a-fA-F][0-9a-fA-F][0-9a-fA-F][0-9a-fA-F]-[0-9a-fA-F][0-9a-fA-F][0-9a-fA-F][0-9a-fA-F][0-9a-fA-F][0-9a-fA-F][0-9a-fA-F][0-9a-fA-F][0-9a-fA-F][0-9a-fA-F][0-9a-fA-F][0-9a-fA-F]'    BEGIN        SET @Result = 1    END ELSE    BEGIN        SET @Result = 0    END    IF @hasLeftBraces = @hasRightBraces    BEGIN        RETURN @Result    END ELSE    BEGIN        SET @Result = 0    END    RETURN @ResultENDGO",
      "language": "sql",
      "context": "Example of a function.",
      "tab_label": "",
      "line_count": 1
    },
    {
      "code": "-- Function-- PostgreSQLDROP FUNCTION IF EXISTS \"public\".\"fn_IsGuid\";CREATE OR REPLACE FUNCTION public.\"fn_IsGuid\"(ValidateValue IN VARCHAR) RETURNS BOOLEAN AS $$    BEGIN        IF (regexp_matches(ValidateValue, '^\\{?[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}\\}?$'))[1] IS NOT NULL THEN            RETURN TRUE;        ELSE            RETURN FALSE;        END IF;    END;$$ LANGUAGE plpgsql;",
      "language": "sql",
      "context": "Example of a function.",
      "tab_label": "",
      "line_count": 1
    }
  ],
  "tables": [],
  "callouts": [
    {
      "type": "info",
      "title": "Info",
      "content": "ExampleExample of an SQL script that creates a view and triggers to add, modify, and delete records from the target table.",
      "html": "<div class=\"theme-admonition theme-admonition-info alert alert--info admonition_WoCw\"><div class=\"admonitionHeading_TMsN\">Example</div><div class=\"admonitionContent_vXIg\"><p>Example of an SQL script that creates a view and triggers to add, modify, and delete records from the target table.</p></div></div>"
    },
    {
      "type": "note",
      "title": "Note",
      "content": "Example",
      "html": "<div class=\"admonitionHeading_TMsN\">Example</div>"
    },
    {
      "type": "note",
      "title": "Note",
      "content": "Example of an SQL script that creates a view and triggers to add, modify, and delete records from the target table.",
      "html": "<div class=\"admonitionContent_vXIg\"><p>Example of an SQL script that creates a view and triggers to add, modify, and delete records from the target table.</p></div>"
    },
    {
      "type": "info",
      "title": "Info",
      "content": "ExampleExample of an SQL script that demonstrates how to use a RULE instead of the INSTEAD OF trigger in PostgreSQL.",
      "html": "<div class=\"theme-admonition theme-admonition-info alert alert--info admonition_WoCw\"><div class=\"admonitionHeading_TMsN\">Example</div><div class=\"admonitionContent_vXIg\"><p>Example of an SQL script that demonstrates how to use a RULE instead of the INSTEAD OF trigger in PostgreSQL.</p></div></div>"
    },
    {
      "type": "note",
      "title": "Note",
      "content": "Example",
      "html": "<div class=\"admonitionHeading_TMsN\">Example</div>"
    },
    {
      "type": "note",
      "title": "Note",
      "content": "Example of an SQL script that demonstrates how to use a RULE instead of the INSTEAD OF trigger in PostgreSQL.",
      "html": "<div class=\"admonitionContent_vXIg\"><p>Example of an SQL script that demonstrates how to use a RULE instead of the INSTEAD OF trigger in PostgreSQL.</p></div>"
    },
    {
      "type": "info",
      "title": "Info",
      "content": "ExampleExample of an SQL script that creates a stored procedure. The stored procedure uses loops, cursors, and temporary tables.",
      "html": "<div class=\"theme-admonition theme-admonition-info alert alert--info admonition_WoCw\"><div class=\"admonitionHeading_TMsN\">Example</div><div class=\"admonitionContent_vXIg\"><p>Example of an SQL script that creates a stored procedure. The stored procedure uses loops, cursors, and temporary tables.</p></div></div>"
    },
    {
      "type": "note",
      "title": "Note",
      "content": "Example",
      "html": "<div class=\"admonitionHeading_TMsN\">Example</div>"
    },
    {
      "type": "note",
      "title": "Note",
      "content": "Example of an SQL script that creates a stored procedure. The stored procedure uses loops, cursors, and temporary tables.",
      "html": "<div class=\"admonitionContent_vXIg\"><p>Example of an SQL script that creates a stored procedure. The stored procedure uses loops, cursors, and temporary tables.</p></div>"
    },
    {
      "type": "info",
      "title": "Info",
      "content": "ExampleExample of a recursive stored procedure that returns a table and usesPERFORM.",
      "html": "<div class=\"theme-admonition theme-admonition-info alert alert--info admonition_WoCw\"><div class=\"admonitionHeading_TMsN\">Example</div><div class=\"admonitionContent_vXIg\"><p>Example of a recursive stored procedure that returns a table and uses <code>PERFORM</code>.</p></div></div>"
    },
    {
      "type": "note",
      "title": "Note",
      "content": "Example",
      "html": "<div class=\"admonitionHeading_TMsN\">Example</div>"
    },
    {
      "type": "note",
      "title": "Note",
      "content": "Example of a recursive stored procedure that returns a table and usesPERFORM.",
      "html": "<div class=\"admonitionContent_vXIg\"><p>Example of a recursive stored procedure that returns a table and uses <code>PERFORM</code>.</p></div>"
    },
    {
      "type": "info",
      "title": "Info",
      "content": "ExampleExample of a stored procedure that uses exception handling and executes a custom script.",
      "html": "<div class=\"theme-admonition theme-admonition-info alert alert--info admonition_WoCw\"><div class=\"admonitionHeading_TMsN\">Example</div><div class=\"admonitionContent_vXIg\"><p>Example of a stored procedure that uses exception handling and executes a custom script.</p></div></div>"
    },
    {
      "type": "note",
      "title": "Note",
      "content": "Example",
      "html": "<div class=\"admonitionHeading_TMsN\">Example</div>"
    },
    {
      "type": "note",
      "title": "Note",
      "content": "Example of a stored procedure that uses exception handling and executes a custom script.",
      "html": "<div class=\"admonitionContent_vXIg\"><p>Example of a stored procedure that uses exception handling and executes a custom script.</p></div>"
    },
    {
      "type": "info",
      "title": "Info",
      "content": "ExampleExample of a function.",
      "html": "<div class=\"theme-admonition theme-admonition-info alert alert--info admonition_WoCw\"><div class=\"admonitionHeading_TMsN\">Example</div><div class=\"admonitionContent_vXIg\"><p>Example of a function.</p></div></div>"
    },
    {
      "type": "note",
      "title": "Note",
      "content": "Example",
      "html": "<div class=\"admonitionHeading_TMsN\">Example</div>"
    },
    {
      "type": "note",
      "title": "Note",
      "content": "Example of a function.",
      "html": "<div class=\"admonitionContent_vXIg\"><p>Example of a function.</p></div>"
    }
  ],
  "images": [],
  "videos": [],
  "downloadables": [],
  "headings": [
    {
      "level": 1,
      "text": "MSSQL and PostgreSQL script examples",
      "anchor": ""
    },
    {
      "level": 2,
      "text": "Example 1 (views)\u200b",
      "anchor": "title-2139-1"
    },
    {
      "level": 2,
      "text": "Example 2 (views)\u200b",
      "anchor": "title-2139-2"
    },
    {
      "level": 2,
      "text": "Example 3 (stored procedures)\u200b",
      "anchor": "title-2139-3"
    },
    {
      "level": 2,
      "text": "Example 4 (stored procedures)\u200b",
      "anchor": "title-2139-4"
    },
    {
      "level": 2,
      "text": "Example 5 (stored procedures)\u200b",
      "anchor": "title-2139-5"
    },
    {
      "level": 2,
      "text": "Example 6 (functions)\u200b",
      "anchor": "title-2139-6"
    },
    {
      "level": 2,
      "text": "Resources\u200b",
      "anchor": "resources"
    }
  ],
  "api_docs": null,
  "sidebar_items": [
    {
      "href": "/docs/8.x/dev/",
      "text": "Guides",
      "active": false
    },
    {
      "href": "/docs/8.x/dev/development-on-creatio-platform/8.0/development-tools/database-tools/postgresql-features/examples/mssql-and-postgresql-script-examples",
      "text": "Script examples",
      "active": false
    },
    {
      "href": "/docs/8.x/dev/development-on-creatio-platform/development-tools/database-tools/postgresql-features/examples/mssql-and-postgresql-script-examples",
      "text": "latest version",
      "active": false
    },
    {
      "href": "/docs/8.x/dev/development-on-creatio-platform/8.2/development-tools/database-tools/postgresql-features/examples/mssql-and-postgresql-script-examples",
      "text": "8.2",
      "active": false
    },
    {
      "href": "/docs/8.x/dev/development-on-creatio-platform/8.1/development-tools/database-tools/postgresql-features/examples/mssql-and-postgresql-script-examples",
      "text": "8.1",
      "active": false
    },
    {
      "href": "/docs/8.x/dev/development-on-creatio-platform/8.0/category/getting-started",
      "text": "Getting started",
      "active": false
    },
    {
      "href": "/docs/8.x/dev/development-on-creatio-platform/8.0/getting-started/development-recommendations",
      "text": "Development recommendations",
      "active": false
    },
    {
      "href": "/docs/8.x/dev/development-on-creatio-platform/8.0/category/architecture",
      "text": "Architecture",
      "active": false
    },
    {
      "href": "/docs/8.x/dev/development-on-creatio-platform/8.0/architecture/creatio-platform",
      "text": "Platform",
      "active": false
    },
    {
      "href": "/docs/8.x/dev/development-on-creatio-platform/8.0/category/microservices",
      "text": "Microservices",
      "active": false
    },
    {
      "href": "/docs/8.x/dev/development-on-creatio-platform/8.0/creatio-development",
      "text": "Creatio development",
      "active": false
    },
    {
      "href": "/docs/8.x/dev/development-on-creatio-platform/8.0/category/development-tools",
      "text": "Development tools",
      "active": false
    },
    {
      "href": "/docs/8.x/dev/development-on-creatio-platform/8.0/category/creatio-ide",
      "text": "Creatio IDE",
      "active": false
    },
    {
      "href": "/docs/8.x/dev/development-on-creatio-platform/8.0/development-tools/creatio-ide/overview-creatio-ide",
      "text": "Overview",
      "active": false
    },
    {
      "href": "/docs/8.x/dev/development-on-creatio-platform/8.0/category/configuration-elements",
      "text": "Configuration elements",
      "active": false
    },
    {
      "href": "/docs/8.x/dev/development-on-creatio-platform/8.0/development-tools/creatio-ide/replace-configuration-elements",
      "text": "Replacement",
      "active": false
    },
    {
      "href": "/docs/8.x/dev/development-on-creatio-platform/8.0/category/external-ides",
      "text": "External IDEs",
      "active": false
    },
    {
      "href": "/docs/8.x/dev/development-on-creatio-platform/8.0/development-tools/external-ides/basics",
      "text": "Basics",
      "active": false
    },
    {
      "href": "/docs/8.x/dev/development-on-creatio-platform/8.0/functionality-development",
      "text": "Functionality development",
      "active": false
    },
    {
      "href": "/docs/8.x/dev/development-on-creatio-platform/8.0/category/packages",
      "text": "Packages",
      "active": false
    },
    {
      "href": "/docs/8.x/dev/development-on-creatio-platform/8.0/development-tools/packages/composable-architecture",
      "text": "Composable architecture",
      "active": false
    },
    {
      "href": "/docs/8.x/dev/development-on-creatio-platform/8.0/development-tools/packages/packages-overview",
      "text": "Overview",
      "active": false
    },
    {
      "href": "/docs/8.x/dev/development-on-creatio-platform/8.0/development-tools/packages/simple-package",
      "text": "Regular package",
      "active": false
    },
    {
      "href": "/docs/8.x/dev/development-on-creatio-platform/8.0/development-tools/packages/project-package",
      "text": "Project package",
      "active": false
    },
    {
      "href": "/docs/8.x/dev/development-on-creatio-platform/8.0/development-tools/packages/assembly-package",
      "text": "Assembly package",
      "active": false
    },
    {
      "href": "/docs/8.x/dev/development-on-creatio-platform/8.0/development-tools/packages/automatically-activated-package",
      "text": "Smart activation package",
      "active": false
    },
    {
      "href": "/docs/8.x/dev/development-on-creatio-platform/8.0/development-tools/packages/create-a-package",
      "text": "Create a package",
      "active": false
    },
    {
      "href": "/docs/8.x/dev/development-on-creatio-platform/8.0/category/bind-data",
      "text": "Bind data",
      "active": false
    },
    {
      "href": "/docs/8.x/dev/development-on-creatio-platform/8.0/development-tools/packages/package-conversion",
      "text": "\u0421onversion",
      "active": false
    },
    {
      "href": "/docs/8.x/dev/development-on-creatio-platform/8.0/category/file-content",
      "text": "File content",
      "active": false
    },
    {
      "href": "/docs/8.x/dev/development-on-creatio-platform/8.0/category/clio-utility",
      "text": "Clio utility",
      "active": false
    },
    {
      "href": "/docs/8.x/dev/development-on-creatio-platform/8.0/development-tools/clio/install-clio",
      "text": "Install Clio",
      "active": false
    },
    {
      "href": "/docs/8.x/dev/development-on-creatio-platform/8.0/development-tools/clio/set-up-creatio-instance",
      "text": "Set up Creatio instance",
      "active": false
    },
    {
      "href": "/docs/8.x/dev/development-on-creatio-platform/8.0/development-tools/clio/use-clio",
      "text": "Use Clio",
      "active": false
    },
    {
      "href": "/docs/8.x/dev/development-on-creatio-platform/8.0/category/version-control-tools",
      "text": "Version control tools",
      "active": false
    },
    {
      "href": "/docs/8.x/dev/development-on-creatio-platform/8.0/development-tools/version-control-system/configuration-version-control",
      "text": "Configuration section",
      "active": false
    },
    {
      "href": "/docs/8.x/dev/development-on-creatio-platform/8.0/category/subversion",
      "text": "Subversion",
      "active": false
    },
    {
      "href": "/docs/8.x/dev/development-on-creatio-platform/8.0/development-tools/version-control-system/git",
      "text": "Git",
      "active": false
    },
    {
      "href": "/docs/8.x/dev/development-on-creatio-platform/8.0/category/testing-tools",
      "text": "Testing tools",
      "active": false
    },
    {
      "href": "/docs/8.x/dev/development-on-creatio-platform/8.0/development-tools/testing/nunit",
      "text": "NUnit",
      "active": false
    },
    {
      "href": "/docs/8.x/dev/development-on-creatio-platform/8.0/testing-examples",
      "text": "Examples",
      "active": false
    },
    {
      "href": "/docs/8.x/dev/development-on-creatio-platform/8.0/category/database-tools",
      "text": "Database tools",
      "active": false
    },
    {
      "href": "/docs/8.x/dev/development-on-creatio-platform/8.0/category/postgresql-features",
      "text": "PostgreSQL features",
      "active": false
    },
    {
      "href": "/docs/8.x/dev/development-on-creatio-platform/8.0/development-tools/database-tools/postgresql-features/overview",
      "text": "Overview",
      "active": false
    },
    {
      "href": "/docs/8.x/dev/development-on-creatio-platform/8.0/database-features-examples",
      "text": "PreviousExamples",
      "active": false
    },
    {
      "href": "/docs/8.x/dev/development-on-creatio-platform/8.0/development-tools/database-tools/backward-compatible-sql-scripts",
      "text": "NextBackward compatible scripts",
      "active": false
    },
    {
      "href": "/docs/8.x/dev/development-on-creatio-platform/8.0/category/logging-tools",
      "text": "Logging tools",
      "active": false
    },
    {
      "href": "/docs/8.x/dev/development-on-creatio-platform/8.0/development-tools/logging/nlog",
      "text": "NLog",
      "active": false
    },
    {
      "href": "/docs/8.x/dev/development-on-creatio-platform/8.0/development-tools/logging/logging-of-http-requests-net-core",
      "text": "HTTP requests logging",
      "active": false
    },
    {
      "href": "/docs/8.x/dev/development-on-creatio-platform/8.0/category/debugging-tools",
      "text": "Debugging tools",
      "active": false
    },
    {
      "href": "/docs/8.x/dev/development-on-creatio-platform/8.0/category/back-end-debugging",
      "text": "Back-end debugging",
      "active": false
    },
    {
      "href": "/docs/8.x/dev/development-on-creatio-platform/8.0/category/front-end-debugging",
      "text": "Front-end debugging",
      "active": false
    },
    {
      "href": "/docs/8.x/dev/development-on-creatio-platform/8.0/category/delivery-tools",
      "text": "Delivery tools",
      "active": false
    },
    {
      "href": "/docs/8.x/dev/development-on-creatio-platform/8.0/development-tools/delivery/environments",
      "text": "Environments",
      "active": false
    },
    {
      "href": "/docs/8.x/dev/development-on-creatio-platform/8.0/development-tools/delivery/delivery-management-process",
      "text": "Delivery management process",
      "active": false
    },
    {
      "href": "/docs/8.x/dev/development-on-creatio-platform/8.0/category/configuration-section",
      "text": "Configuration section",
      "active": false
    },
    {
      "href": "/docs/8.x/dev/development-on-creatio-platform/8.0/category/workspaceconsole-utility",
      "text": "WorkspaceConsole utility",
      "active": false
    },
    {
      "href": "/docs/8.x/dev/development-on-creatio-platform/8.0/category/delivery-process-customization",
      "text": "Delivery process customization",
      "active": false
    },
    {
      "href": "/docs/8.x/dev/development-on-creatio-platform/8.0/category/back-end-development",
      "text": "Back-end development",
      "active": false
    },
    {
      "href": "/docs/8.x/dev/development-on-creatio-platform/8.0/category/replacing-class-factory",
      "text": "Replacing class factory",
      "active": false
    },
    {
      "href": "/docs/8.x/dev/development-on-creatio-platform/8.0/data-operations-back-end",
      "text": "Data operations (back-end)",
      "active": false
    },
    {
      "href": "/docs/8.x/dev/development-on-creatio-platform/8.0/category/web-services",
      "text": "Web services",
      "active": false
    },
    {
      "href": "/docs/8.x/dev/development-on-creatio-platform/8.0/back-end-development/objects-business-logic",
      "text": "Object events",
      "active": false
    },
    {
      "href": "/docs/8.x/dev/development-on-creatio-platform/8.0/back-end-development/data-storage-and-cache",
      "text": "Data storage and cache",
      "active": false
    },
    {
      "href": "/docs/8.x/dev/development-on-creatio-platform/8.0/category/localizable-resources",
      "text": "Localizable resources",
      "active": false
    },
    {
      "href": "/docs/8.x/dev/development-on-creatio-platform/8.0/back-end-development/automatic-data-binding",
      "text": "Automatic data binding",
      "active": false
    },
    {
      "href": "/docs/8.x/dev/development-on-creatio-platform/8.0/category/file-management-api",
      "text": "File management API",
      "active": false
    },
    {
      "href": "/docs/8.x/dev/development-on-creatio-platform/8.0/back-end-development/net-class-libraries-of-platform-core",
      "text": ".NET classes reference",
      "active": false
    },
    {
      "href": "/docs/8.x/dev/development-on-creatio-platform/8.0/category/front-end-development",
      "text": "Front-end development",
      "active": false
    },
    {
      "href": "/docs/8.x/dev/development-on-creatio-platform/8.0/front-end-development/data-fetching",
      "text": "Best practices for data fetching",
      "active": false
    },
    {
      "href": "/docs/8.x/dev/development-on-creatio-platform/8.0/category/freedom-ui",
      "text": "Freedom UI",
      "active": false
    },
    {
      "href": "/docs/8.x/dev/development-on-creatio-platform/8.0/category/classic-ui",
      "text": "Classic UI",
      "active": false
    },
    {
      "href": "/docs/8.x/dev/development-on-creatio-platform/8.0/category/platform-customization",
      "text": "Platform customization",
      "active": false
    },
    {
      "href": "/docs/8.x/dev/development-on-creatio-platform/8.0/category/freedom-ui-1",
      "text": "Freedom UI",
      "active": false
    },
    {
      "href": "/docs/8.x/dev/development-on-creatio-platform/8.0/category/classic-ui-1",
      "text": "Classic UI",
      "active": false
    },
    {
      "href": "/docs/8.x/dev/development-on-creatio-platform/8.0/category/interface-control-tools",
      "text": "Interface control tools",
      "active": false
    },
    {
      "href": "/docs/8.x/dev/development-on-creatio-platform/8.0/category/integrations-tools",
      "text": "Integrations tools",
      "active": false
    },
    {
      "href": "/docs/8.x/dev/development-on-creatio-platform/8.0/integrations-and-api/overview",
      "text": "Integration options",
      "active": false
    },
    {
      "href": "/docs/8.x/dev/development-on-creatio-platform/8.0/category/authentication",
      "text": "Authentication",
      "active": false
    },
    {
      "href": "/docs/8.x/dev/development-on-creatio-platform/8.0/category/data-services",
      "text": "Data services",
      "active": false
    },
    {
      "href": "/docs/8.x/dev/development-on-creatio-platform/8.0/integrations-and-api/chat-channels-integration",
      "text": "Chats",
      "active": false
    },
    {
      "href": "/docs/8.x/dev/development-on-creatio-platform/8.0/category/business-process-service",
      "text": "Business process service",
      "active": false
    },
    {
      "href": "/docs/8.x/dev/development-on-creatio-platform/8.0/category/test-api",
      "text": "Test API",
      "active": false
    },
    {
      "href": "/docs/8.x/dev/development-on-creatio-platform/8.0/integrations-and-api/integration-examples",
      "text": "API documentation",
      "active": false
    },
    {
      "href": "/docs/8.x/dev/development-on-creatio-platform/8.0/category/mobile-app-development",
      "text": "Mobile app development",
      "active": false
    },
    {
      "href": "/docs/8.x/dev/development-on-creatio-platform/8.0/category/basics",
      "text": "Basics",
      "active": false
    },
    {
      "href": "/docs/8.x/dev/development-on-creatio-platform/8.0/category/customization",
      "text": "Customization",
      "active": false
    },
    {
      "href": "/docs/8.x/dev/development-on-creatio-platform/8.0/category/debugging",
      "text": "Debugging",
      "active": false
    },
    {
      "href": "https://www.postgresql.org/docs/current/",
      "text": "Official PostgreSQL documentation",
      "active": false
    }
  ],
  "related_links": [],
  "version": "8.x",
  "crawled_at": "2026-01-15T00:40:28.272005"
}