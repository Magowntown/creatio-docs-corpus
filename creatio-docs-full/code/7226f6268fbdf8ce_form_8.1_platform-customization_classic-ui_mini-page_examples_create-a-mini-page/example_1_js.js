define("UsrKnowledgeBaseArticleMiniPage", ["terrasoft", "KnowledgeBaseFile", "ConfigurationConstants"], function(Terrasoft, KnowledgeBaseFile, ConfigurationConstants) {    return {        entitySchemaName: "KnowledgeBase",        attributes: {            "MiniPageModes": {                "value": [this.Terrasoft.ConfigurationEnums.CardOperation.VIEW]            },            "Article": {                "type": Terrasoft.ViewModelColumnType.VIRTUAL_COLUMN,                "referenceSchemaName": "KnowledgeBase"            }        },        methods: {            /* Initialize the collection of the file selection button's dropdown list.*/            init: function() {                this.callParent(arguments);                this.initExtendedMenuButtonCollections("File", ["Article"], this.close);            },            /* Initialize the value of the attribute that binds the main and additional records.             Populate the collection of the file selection button's drop-down list.*/            onEntityInitialized: function() {                this.callParent(arguments);                this.setArticleInfo();                this.fillFilesExtendedMenuData();            },            /* Initiate the upload of files and the addition of them to the file selection button's drop-down list.*/            fillFilesExtendedMenuData: function() {                this.getFiles(this.initFilesMenu, this);            },            /* Set the value of the attribute that binds the main and additional records.*/            setArticleInfo: function() {                this.set("Article", {                    value: this.get(this.primaryColumnName),                    displayValue: this.get(this.primaryDisplayColumnName)                });            },            /* Retrieve the data about the files of the current knowledge base article.*/            getFiles: function(callback, scope) {                var esq = this.Ext.create("Terrasoft.EntitySchemaQuery", {                    rootSchema: KnowledgeBaseFile                });                esq.addColumn("Name");                var articleFilter = >this.Terrasoft.createColumnFilterWithParameter(                    this.Terrasoft.ComparisonType.EQUAL, "KnowledgeBase", this.get(this.primaryColumnName));                var typeFilter = this.Terrasoft.createColumnFilterWithParameter(                    this.Terrasoft.ComparisonType.EQUAL, "Type", ConfigurationConstants.FileType.File);                esq.filters.addItem(articleFilter);                esq.filters.addItem(typeFilter);                esq.getEntityCollection(function(response) {                    if (!response.success) {                        return;                    }                    callback.call(scope, response.collection);                }, this);            },            /* Populate the collection of the file selection button's drop-down list.*/            initFilesMenu: function(files) {                if (files.isEmpty()) {                    return;                }                var data = [];                files.each(function(file) {                    data.push({                        caption: file.get("Name"),                        tag: file.get("Id")                    });                }, this);                var recipientInfo = this.fillExtendedMenuItems("File", ["Article"]);                this.fillExtendedMenuData(data, recipientInfo, this.downloadFile);            },            /* Initiate the download of the selected file.*/            downloadFile: function(id) {                var element = document.createElement("a");                element.href = "../rest/FileService/GetFile/" + KnowledgeBaseFile.uId + "/" + id;                document.body.appendChild(element);                element.click();                document.body.removeChild(element);            }        },        diff: /**SCHEMA_DIFF*/[            {                "operation": "insert",                "name": "Name",                "parentName": "HeaderContainer",                "propertyName": "items",                "index": 0,                "values": {                    "labelConfig": {                        "visible": true                    },                    "isMiniPageModelItem": true                }            },            {                "operation": "insert",                "name": "Keywords",                "parentName": "MiniPage",                "propertyName": "items",                "values": {                    "labelConfig": {                        "visible": true                    },                    "isMiniPageModelItem": true,                    "layout": {                        "column": 0,                        "row": 1,                        "colSpan": 24                    }                }            },            {                "operation": "insert",                "parentName": "HeaderContainer",                "propertyName": "items",                "name": "FilesButton",                "values": {                    "itemType": Terrasoft.ViewItemType.BUTTON,                    /* Set up the button image.*/                    "imageConfig": {                        /* Add the image to the mini page resources before you run the code.*/                        "bindTo": "Resources.Images.FilesImage"                    },                    /* Set up the drop-down list.*/                    "extendedMenu": {                        /* The name of the drop-down list element.*/                        "Name": "File",                        /* The name of the mini page attribute that binds the main and additional records.*/                        "PropertyName": "Article",                        /* Set up the button click processor.*/                        "Click": {                            "bindTo": "fillFilesExtendedMenuData"                        }                    }                },                "index": 1            }        ]/**SCHEMA_DIFF*/    };});