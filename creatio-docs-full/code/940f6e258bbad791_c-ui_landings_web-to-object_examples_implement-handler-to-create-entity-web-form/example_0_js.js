namespace Terrasoft.Configuration{    using System;    using System.Linq;    using Core.Entities;    using Core;    using GeneratedWebFormService;    #region Class: UsrCustomWebFormEventTargetPreProcessHandler    /// <summary>    /// Call the custom handler before the event participant is saved.    /// </summary>    /// <seealso cref="Terrasoft.Configuration.IGeneratedWebFormPreProcessHandler" />    public class CustomWebFormEventTargetPreProcessHandler: WebFormEventTargetPreProcessHandler, IGeneratedWebFormPreProcessHandler    {        #region Properties: Private        private UserConnection _userConnection { get; set; }        private FormData _formData { get; set; }        #endregion        #region Methods: Private        private string GetCustomRequiredColumnValue(string customColumnName) {            var customFormField = this._formData.formFieldsData                .FirstOrDefault(x => x.name == customColumnName);            if (customFormField == null) {                 throw new Exception($"There is no required form field {customColumnName}");            }            if (string.IsNullOrEmpty(customFormField?.value)) {                throw new Exception($"Required value is empty for field {customColumnName}");            }            return customFormField.value;        }        #endregion                #region Methods: Protected        /// <summary>        /// Create a contact entity whose custom required text column is populated with the form value.        /// </summary>        /// <param name="contactId">The unique contact ID.</param>        /// <param name="contactNameField">The required contact name field of the form.</param>        protected override void CreateContactEntity(Guid contactId, FormFieldsData contactNameField) {            EntitySchema contactSchema = _userConnection.EntitySchemaManager.GetInstanceByName(nameof(Contact));            Entity contact = contactSchema.CreateEntity(_userConnection);            contact.SetDefColumnValues();            contact.SetColumnValue("Id", contactId);            contact.SetColumnValue("Name", contactNameField.value);            // Set the value of the custom required column.            var customRequiredColumnName = nameof(Contact.CustomRequiredTextColumn);            var customRequiredColumnValue = GetCustomRequiredColumnValue(customRequiredColumnName);            contact.SetColumnValue(customRequiredColumnName, customRequiredColumnValue);            contact.Save(false);        }        #endregion        #region Methods: Public        /// <inheritdoc/>        /// Overload the inherited method so that it initiates the <see cref="UserConnection"/> and <see cref="FormData"/> instances.        public new FormData Execute(UserConnection userConnection, FormData formData,                IWebFormImportParamsGenerator paramsGenerator) {            _userConnection = userConnection;            _formData = formData;            return base.Execute(userConnection, formData, paramsGenerator);        }        #endregion    }    #endregion}