namespace Terrasoft.Configuration{    using System;    using global::Common.Logging;    using Terrasoft.Common;    using Terrasoft.Common.Threading;    using Terrasoft.Core;    using Terrasoft.Core.Factories;    using Terrasoft.Core.Requests;    using Terrasoft.SmsIntegration;    #region Class: UsrSomeProviderSmsSender    [DefaultBinding(typeof(ISmsSender), Name = nameof(UsrSomeProviderSmsSender))]    public class UsrSomeProviderSmsSender : ISmsSender    {        #region Fields: Private        private readonly ILog _logger = LogManager.GetLogger("UsrSomeProviderSms");        private readonly IHttpRequestClient _httpRequestClient;        private readonly UserConnection _userConnection;        #endregion        #region Constructors: Public         public UsrSomeProviderSmsSender(AppConnection appConnection, IHttpRequestClient httpRequestClient) {            appConnection.CheckArgumentNull(nameof(appConnection));            httpRequestClient.CheckArgumentNull(nameof(httpRequestClient));            _userConnection = appConnection?.SystemUserConnection;            _httpRequestClient = httpRequestClient;        }        #endregion        #region Properties: Public        public string Code => "UsrSomeSmsProvider";        #endregion        #region Methods: Public        /* Execute 2FA via SMS using user phone number and verification code. */        public void Send(string phoneNumber, string message) {            /* Receive some options for SMS sending from the system settings. */            var serviceUrl = Terrasoft.Core.Configuration.SysSettings.GetValue<string>(_userConnection, "SomeSystemSettingCode", string.Empty);            try {                /* Send the SMS to the phone number. */                IHttpResponse response = _httpRequestClient.SendWithJsonBody(new HttpRequestConfig() {                                        /* Implement the business logic. */                });                if (response.IsSuccessStatusCode) {                    _logger.Info($"2FA via SMS log. Sends the following message: {message} to the recipient {phoneNumber}.");                    return;                }                throw new Exception($"2FA via SMS log. SMS was not sent to the recipient {phoneNumber} due to the error:"                    + $"{response.ReasonPhrase}", response.Exception);                /* Send SMS asynchronously if needed. */                AsyncPump.Run(() => {                    _logger.Info($"2FA via SMS log. Sends the following message: {message} to the recipient {phoneNumber}.");                });            } catch {                string codeOfLocalizableString = "CodeOfSomeLocalizableString";                /* Display the error message if error occurs during the execution of 2FA via SMS. */                string errorMessage = new LocalizableString(_userConnection.Workspace.ResourceStorage,                    "UsrSomeProviderSmsSender", $"LocalizableStrings.{codeOfLocalizableString}.Value");                throw new InvalidOperationException(errorMessage, null);            }        }        #endregion    }    #endregion}