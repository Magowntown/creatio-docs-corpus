/* Specify the MoneyModule, MultiCurrencyEdit, and MultiCurrencyEditUtilities modules as dependencies. */define("ProjectPageV2", ["MoneyModule", "MultiCurrencyEdit", "MultiCurrencyEditUtilities"], function(MoneyModule, MultiCurrencyEdit, MultiCurrencyEditUtilities) {    return {        /* The name of the record page's object schema. */        entitySchemaName: "Project",        /* The attributes of the view model. */        attributes: {            /* The currency. */            "UsrCurrency": {                /* The data type of the view model column. */                "dataValueType": this.Terrasoft.DataValueType.LOOKUP,                /* The configuration of the currency lookup. */                "lookupListConfig": {                    "columns": ["Division", "Symbol"]                }            },            /* The exchange rate. */            "UsrCurrencyRate": {                "dataValueType": this.Terrasoft.DataValueType.FLOAT,                /* The array of configuration objects that define the [UsrCurrencyRate] column dependencies. */                "dependencies": [                    {                        /* The [UsrCurrencyRate] column value depends on the [UsrCurrency] column value. */                        "columns": ["UsrCurrency"],                        /* The handler method. */                        "methodName": "setCurrencyRate"                    }                ]            },            /* The total amount. */            "UsrAmount": {                "dataValueType": this.Terrasoft.DataValueType.FLOAT,                "dependencies": [                    {                        "columns": ["UsrCurrencyRate", "UsrCurrency"],                        "methodName": "recalculateAmount"                    }                ]            },            /* The amount in base currency. */            "UsrPrimaryAmount": {                "dependencies": [                    {                        "columns": ["UsrAmount"],                        "methodName": "recalculatePrimaryAmount"                    }                ]            },            /* Currency is a virtual column for compatibility with the MultiCurrencyEditUtilities module. */            "Currency": {                "type": this.Terrasoft.ViewModelColumnType.VIRTUAL_COLUMN,                "dataValueType": this.Terrasoft.DataValueType.LOOKUP,                "lookupListConfig": {                    "columns": ["Division"]                },                "dependencies": [                    {                        "columns": ["Currency"],                        "methodName": "onVirtualCurrencyChange"                    }                ]            },            /* The collection of exchange rates. */            "CurrencyRateList": {                dataValueType: this.Terrasoft.DataValueType.COLLECTION,                value: this.Ext.create("Terrasoft.Collection")            },            /* The collection for the currency selection button. */            "CurrencyButtonMenuList": {                dataValueType: this.Terrasoft.DataValueType.COLLECTION,                value: this.Ext.create("Terrasoft.BaseViewModelCollection")            }        },        /* The mixins of the view model. */        mixins: {            /* The mixin that manages multiple currencies on the record page. */            MultiCurrencyEditUtilities: "Terrasoft.MultiCurrencyEditUtilities"        },        /* The methods of the record page's view model. */        methods: {            /* Overload the Terrasoft.BasePageV2.onEntityInitialized() base method. */            onEntityInitialized: function() {                /* Call the parent implementation of the method. */                this.callParent(arguments);                this.set("Currency", this.get("UsrCurrency"), {silent: true});                /* Initialize the mixin that manages multiple currencies. */                this.mixins.MultiCurrencyEditUtilities.init.call(this);            },            /* Set the exchange rate. */            setCurrencyRate: function() {                /* Load the exchange rate on the project start date. */                MoneyModule.LoadCurrencyRate.call(this, "UsrCurrency", "UsrCurrencyRate", this.get("StartDate"));            },            /* Recalculate the amount. */            recalculateAmount: function() {                var currency = this.get("UsrCurrency");                var division = currency ? currency.Division : null;                MoneyModule.RecalcCurrencyValue.call(this, "UsrCurrencyRate", "UsrAmount", "UsrPrimaryAmount", division);            },            /* Recalculate the amount in base currency. */            recalculatePrimaryAmount: function() {                var currency = this.get("UsrCurrency");                var division = currency ? currency.Division : null;                MoneyModule.RecalcBaseValue.call(this, "UsrCurrencyRate", "UsrAmount", "UsrPrimaryAmount", division);            },            /* The handler of changes to the virtual currency columns. */            onVirtualCurrencyChange: function() {                var currency = this.get("Currency");                this.set("UsrCurrency", currency);            }        },        /* Display the field on the record page. */        diff: /**SCHEMA_DIFF*/[            /* The properties to add the multicurrency field to the record page. */            {                /* Add the element to the page. */                "operation": "insert",                /* The meta name of the parent container to add the field. */                "parentName": "Header",                /* Add the field to the parent element's collection of elements. */                "propertyName": "items",                /* The meta name of the field to add. */                "name": "UsrAmount",                /* The properties to pass to the element's constructor. */                "values": {                    /* Bind the value of the control to the view model column. */                    "bindTo": "UsrAmount",                    /* Set up the field layout. */                    "layout": {                         /* The column number. */                        "column": 0,                         /* The row number. */                        "row": 2,                         /* The column span. */                        "colSpan": 12                     },                    /* The name of the column that contains the amount in base currency. */                    "primaryAmount": "UsrPrimaryAmount",                    /* The name of the column that contains the currency of the amount. */                    "currency": "UsrCurrency",                    /* The name of the column that contains the exchange rate. */                    "rate": "UsrCurrencyRate",                    /* The property that flags the field of the amount in the base currency as editable. */                    "primaryAmountEnabled": false,                    /* The view generator of the control. */                    "generator": "MultiCurrencyEditViewGenerator.generate"                }            }        ]/**SCHEMA_DIFF*/    };});