/* Declare the AMD module. */define("UsrAppRequests_FormPage", /**SCHEMA_DEPS*/["@creatio/sdk" ]/**SCHEMA_DEPS*/, function/**SCHEMA_ARGS*/(sdk)/**SCHEMA_ARGS*/ {    return {        viewConfigDiff: /**SCHEMA_VIEW_CONFIG_DIFF*/[            /* Label of the request number. */            {                "operation": "insert",                "name": "UsrRequestNumber",                "values": {                    "layoutConfig": {                        "column": 1,                        "row": 2,                        "colSpan": 1,                        "rowSpan": 1                    },                    "type": "crt.Label",                    "caption": "#ResourceString(UsrRequestNumber_caption)#",                    "labelType": "caption",                    "labelThickness": "normal",                    "labelEllipsis": false,                    "labelColor": "#757575",                    "labelBackgroundColor": "transparent",                    "labelTextAlign": "start"                },                "parentName": "LeftAreaProfileContainer",                "propertyName": "items",                "index": 0            },            /* Label that contains the value of the request number from the system setting. */            {                "operation": "insert",                "name": "UsrRequestNumberValue",                "values": {                    "layoutConfig": {                        "column": 1,                        "row": 3,                        "colSpan": 1,                        "rowSpan": 1                    },                    "type": "crt.Label",                    /* The property that handles the text contained in the element. Bound to the "LastRequestNumber" attribute. */                    "caption": "$LastRequestNumber",                    "labelType": "body",                    "labelThickness": "normal",                    "labelEllipsis": false,                    "labelColor": "#181818",                    "labelBackgroundColor": "transparent",                    "labelTextAlign": "start"                },                "parentName": "LeftAreaProfileContainer",                "propertyName": "items",                "index": 1            },            /* Label of the current user city. */            {                "operation": "insert",                "name": "UsrCity",                "values": {                    "layoutConfig": {                        "column": 1,                        "row": 4,                        "colSpan": 1,                        "rowSpan": 1                    },                    "type": "crt.Label",                    "caption": "#ResourceString(UsrCity_caption)#",                    "labelType": "caption",                    "labelThickness": "normal",                    "labelEllipsis": false,                    "labelColor": "#757575",                    "labelBackgroundColor": "transparent",                    "labelTextAlign": "start"                },                "parentName": "LeftAreaProfileContainer",                "propertyName": "items",                "index": 2            },            /* Label that contains the value of the current user city from the system setting. */            {                "operation": "insert",                "name": "UsrCityValue",                "values": {                    "layoutConfig": {                        "column": 1,                        "row": 5,                        "colSpan": 1,                        "rowSpan": 1                    },                    "type": "crt.Label",                    /* The property that handles the text contained in the element. Bound to the "DefaultCity" attribute. */                    "caption": "$DefaultCity",                    "labelType": "body",                    "labelThickness": "normal",                    "labelEllipsis": false,                    "labelColor": "#181818",                    "labelBackgroundColor": "transparent",                    "labelTextAlign": "start"                },                "parentName": "LeftAreaProfileContainer",                "propertyName": "items",                "index": 3            },            {                "operation": "insert",                "name": "UsrName",                "values": {                    "layoutConfig": {                        "column": 1,                        "row": 1,                        "colSpan": 1,                        "rowSpan": 1                    },                    "type": "crt.Input",                    "multiline": false,                    "control": "$UsrName",                    "label": "$Resources.Strings.UsrName",                    "labelPosition": "auto"                },                "parentName": "LeftAreaProfileContainer",                "propertyName": "items",                "index": 4            }        ]/**SCHEMA_VIEW_CONFIG_DIFF*/,        viewModelConfig: /**SCHEMA_VIEW_MODEL_CONFIG*/{            "attributes": {                "UsrName": {                    "modelConfig": {                        "path": "PDS.UsrName"                    }                },                "Id": {                    "modelConfig": {                        "path": "PDS.Id"                    }                },                /* The attribute that stores data of the "Request number" ("UsrLastRequestNumber" code) system setting. */                "LastRequestNumber": {},                /* The attribute that stores data of the "City" ("UsrDefaultCity" code) system setting. */                "DefaultCity": {},            }        }/**SCHEMA_VIEW_MODEL_CONFIG*/,        modelConfig: /**SCHEMA_MODEL_CONFIG*/{            "dataSources": {                "PDS": {                    "type": "crt.EntityDataSource",                    "config": {                        "entitySchemaName": "UsrAppRequests"                    },                    "scope": "page"                }            },            "primaryDataSourceName": "PDS"        }/**SCHEMA_MODEL_CONFIG*/,        handlers: /**SCHEMA_HANDLERS*/[            {                request: "crt.HandleViewModelResumeRequest",                /* The custom implementation of the system request handler. */                handler: async (request, next) => {                    /* Wait for the rest of the initialization handlers to finish. */                    await next?.handle(request);                    /* Create an instance of the system setting service from "@creatio-devkit/common." */                    const sysSettingsService = new sdk.SysSettingsService();                    /* Retrieve the value of the "City" ("UsrDefaultCity" code) system setting. */                    const defaultCity = await sysSettingsService.getByCode('UsrDefaultCity');                    /* Specify the value of the "City" ("UsrDefaultCity" code) system setting in the "DefaultCity" attribute. */                    request.$context.DefaultCity = defaultCity.displayValue;                    /* Retrieve the page state. */                    const cardState = await request.$context.CardState;                    /* Check the page state. If the page is new or copies an existing page, increase the value of the "Request number" ("UsrLastRequestNumber" code) system setting. */                    if (cardState === 'add' || cardState === 'copy') {                        /* Retrieve the value of the "Request number" ("UsrLastRequestNumber" code) system setting. */                        const lastNumber = await sysSettingsService.getByCode('UsrLastRequestNumber');                        /* Send a request to update the value of the "Request number" ("UsrLastRequestNumber" code) system setting. */                        await sysSettingsService.update({                            code: 'UsrLastRequestNumber',                                /* The new value is larger than the previous one by 1. */                                value: ++lastNumber.value                        });                        /* Specify the new value of the "Request number" ("UsrLastRequestNumber" code) system setting in the "LastRequestNumber" attribute. */                        request.$context.LastRequestNumber = lastNumber.value;                        /* Call the next handler if it exists and return its result. */                        return next?.handle(request);                    }                },            },        ]/**SCHEMA_HANDLERS*/,        converters: /**SCHEMA_CONVERTERS*/{}/**SCHEMA_CONVERTERS*/,        validators: /**SCHEMA_VALIDATORS*/{}/**SCHEMA_VALIDATORS*/    };});