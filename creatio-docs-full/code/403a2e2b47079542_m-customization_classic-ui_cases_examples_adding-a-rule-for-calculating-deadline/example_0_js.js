namespace Terrasoft.Configuration{    using System;    using System.Collections.Generic;    using Terrasoft.Common;    using Terrasoft.Configuration.Calendars;    using Terrasoft.Core;    using Terrasoft.Core.Entities;    using CalendarsTimeUnit = Calendars.TimeUnit;    using SystemSettings = Terrasoft.Core.Configuration.SysSettings;    public class ServiceTestTermsStrategy: BaseTermStrategy<CaseTermInterval, CaseTermStates>    {        // Container class for storage of data received from the entrance point.        protected class StrategyData        {            public Guid ServiceItemId {                get;                set;            }            public Guid ServicePactId {                get;                set;            }        }        // The field for storage of data received from the entrance point.        protected StrategyData _strategyData;        // Parameterized constructor necessary for the correct         // initialization by selector class.        public ServiceTestTermsStrategy(UserConnection userConnection, Dictionary<string, object> args)            : base(userConnection) {            _strategyData = args.ToObject<StrategyData>();        }        // Method that receives data and returns them in the CaseTermInterval class instance.         public override CaseTermInterval GetTermInterval(CaseTermStates mask) {            var result = new CaseTermInterval();            // Creating the EntitySchemaQuery query.            var esq = new EntitySchemaQuery(UserConnection.EntitySchemaManager, "UsrServiceTestTerms");            // Adding columns to the query.            string reactionTimeUnitColumnName = esq.AddColumn("UsrReactionTimeUnit.Code").Name;            string reactionTimeValueColumnName = esq.AddColumn("UsrReactionTimeValue").Name;            string solutionTimeUnitColumnName = esq.AddColumn("UsrSolutionTimeUnit.Code").Name;            string solutionTimeValueColumnName = esq.AddColumn("UsrSolutionTimeValue").Name;            string calendarColumnName = esq.AddColumn("UsrCalendarId.Id").Name;            // Adding filters to the query.            esq.CreateFilterWithParameters(FilterComparisonType.Equal, "UsrServiceItemId", _strategyData.ServiceItemId);            esq.CreateFilterWithParameters(FilterComparisonType.Equal, "UsrServicePactId", _strategyData.ServicePactId);            // Execution and processing of query results.            EntityCollection entityCollection = esq.GetEntityCollection(UserConnection);            if (entityCollection.IsNotEmpty()) {                // Adding response time to the nurtured value.                if (!mask.HasFlag(CaseTermStates.ContainsResponse)) {                    result.ResponseTerm = new TimeTerm {                        Type = entityCollection[0].GetTypedColumnValue<CalendarsTimeUnit>(reactionTimeUnitColumnName),                        Value = entityCollection[0].GetTypedColumnValue<int>(reactionTimeValueColumnName),                        CalendarId = entityCollection[0].GetTypedColumnValue<Guid>(calendarColumnName)                    };                }                // Adding resolution time to the nurtured value.                if (!mask.HasFlag(CaseTermStates.ContainsResolve)) {                    result.ResolveTerm = new TimeTerm {                        Type = entityCollection[0].GetTypedColumnValue<CalendarsTimeUnit>(solutionTimeUnitColumnName),                        Value = entityCollection[0].GetTypedColumnValue<int>(solutionTimeValueColumnName),                        CalendarId = entityCollection[0].GetTypedColumnValue<Guid>(calendarColumnName)                    };                }            }            return result;        }    }}