/* Declare the AMD module. */define("Cases_FormPage", /**SCHEMA_DEPS*/["@creatio-devkit/common"]/**SCHEMA_DEPS*/, function/**SCHEMA_ARGS*/(sdk)/**SCHEMA_ARGS*/ {    return {        viewConfigDiff: /**SCHEMA_VIEW_CONFIG_DIFF*/[            /* Field that contains the text tone to simplify the case resolution. */            {                "operation": "insert",                "name": "UsrResolutionToneField",                "values": {                    "layoutConfig": {                        "column": 1,                        "row": 2,                        "colSpan": 1,                        "rowSpan": 1                    },                    "type": "crt.Input",                    "label": "#ResourceString(UsrResolutionToneField_label)#",                    "control": "$ResolutionTone",                    "placeholder": "#ResourceString(UsrResolutionToneField_placeholder)#",                    "tooltip": "",                    "readonly": false,                    "multiline": false,                    "labelPosition": "auto",                    /* The property that flags the field as visible. Bound to the "IsCreatioAIElementsVisible" attribute. */                    "visible": "$IsCreatioAIElementsVisible",                },                "parentName": "ClosureAndFeedbackFieldsContainer",                "propertyName": "items",                "index": 1            },            /* Button that calls the "Simplify the case resolution" AI Skill. */            {                "operation": "insert",                "name": "UsrSimplifyResolutionButton",                "values": {                    "layoutConfig": {                        "column": 2,                        "row": 2,                        "colSpan": 1,                        "rowSpan": 1                    },                    "type": "crt.Button",                    "caption": "#ResourceString(UsrSimplifyResolutionButton_caption)#",                    "color": "outline",                    "disabled": false,                    "size": "large",                    "iconPosition": "only-text",                    /* The property that flags the button as visible. Bound to the "IsCreatioAIElementsVisible" attribute. */                    "visible": "$IsCreatioAIElementsVisible",                    "clicked": {                        /* Bind the sending of the custom request to the "clicked" button event. */                        "request": "usr.SimplifyText"                    }                },                "parentName": "ClosureAndFeedbackFieldsContainer",                "propertyName": "items",                "index": 2            }        ]/**SCHEMA_VIEW_CONFIG_DIFF*/,        viewModelConfigDiff: /**SCHEMA_VIEW_MODEL_CONFIG_DIFF*/[            {                "operation": "merge",                "path": [                    "attributes"                ],                "values": {                    /* The attribute that stores visibility data of the "Resolution tone" field and "Simplify the resolution" button. */                    "IsCreatioAIElementsVisible": {                        "value": false                    },                    /* The attribute that stores data of the text tone to simplify the case resolution. */                    "ResolutionTone": {                        "value": 'Formal'                    },                }            }        ]/**SCHEMA_VIEW_MODEL_CONFIG_DIFF*/,        modelConfigDiff: /**SCHEMA_MODEL_CONFIG_DIFF*/[]/**SCHEMA_MODEL_CONFIG_DIFF*/,        handlers: /**SCHEMA_HANDLERS*/[            {                request: "crt.HandleViewModelInitRequest",                /* Custom implementation of a base request handler. */                handler: async (request, next) => {                            /* Wait for the rest of the initialization handlers to finish. */                    await next?.handle(request);                            /* Code of the AI Skill. */                    const skillName = 'UsrSkillSimplifyTheCaseResolution';                                        /* Retrieve the instance of the HTTP client from "@creatio-devkit/common." */                    const handlerChain = sdk.HandlerChainService.instance;                                        /* Send the base request that checks the accessibility of the AI Skill. */                    var result = await handlerChain.process({                        type: 'crt.CopilotGetAvailableIntentsRequest',                        intentNames: [skillName],                        $context: request.$context,                        scopes: [...request.scopes]                    });                                        /* If the list of AI Skills includes the AI Skill whose code is "UsrSkillSimplifyTheCaseResolution," set the "IsCreatioAIElementsVisible" attribute to the index of the corresponding AI Skill. */                    request.$context.IsCreatioAIElementsVisible = result.availableIntentNames.indexOf(skillName) > -1;                }            },            {                request: "usr.SimplifyText",                /* Implement the custom request handler. */                handler: async (request, next) => {                    const context = request.$context;                                        /* Retrieve the instance of the HTTP client from "@creatio-devkit/common." */                    const handlerChain = sdk.HandlerChainService.instance;                                        /* Send the base request that runs the AI Skill. */                    const copilotCallResult = await handlerChain.process({                        type: 'crt.CopilotExecuteIntentRequest',                                                /* Code of the AI Skill to run. */                        intentName: 'UsrSkillSimplifyTheCaseResolution',                                                /* Parameters of the AI Skill. */                        parameters: {                            inputText: await context.StringAttribute_qmmwoms,                            textTone: await context.ResolutionTone                        },                        $context: request.$context,                        scopes: [...request.scopes]                    });                                        /* If Creatio can run the AI Skill, AI Skill simplifies the case resolution. */                    if (copilotCallResult.isSuccess) {                        request.$context.StringAttribute_qmmwoms = copilotCallResult.content;                    } else {                                            /* If the status of the AI Skill execution is "FailedToExecute," the browser console displays the "Error occurs during the AI Skill execution" error message. Otherwise, implement a business logic that uses a predefined "errorMessage" value depending on your business goals. */                        if(copilotCallResult.status == 'FailedToExecute'){                            console.error(copilotCallResult.errorMessage);                            alert("Error occurs during the AI Skill execution");                        } else {                                              alert(copilotCallResult.errorMessage);                        };                    }                                        /* If warning occurs during the AI Skill execution, the browser console displays the list of warnings. Many messages are separated by comma. */                    if(copilotCallResult.warnings.length > 0){                        console.warn(copilotCallResult.warnings.join(', '));                    }                            /* Call the next handler if it exists and return its result. */                    return next?.handle(request);                }            }        ]/**SCHEMA_HANDLERS*/,        converters: /**SCHEMA_CONVERTERS*/{}/**SCHEMA_CONVERTERS*/,        validators: /**SCHEMA_VALIDATORS*/{}/**SCHEMA_VALIDATORS*/    };});