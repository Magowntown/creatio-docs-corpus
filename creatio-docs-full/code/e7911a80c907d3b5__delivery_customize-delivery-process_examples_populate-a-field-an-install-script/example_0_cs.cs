namespace Terrasoft.Configuration {    using System;    using System.Collections.Generic;    using Terrasoft.Core;    using Terrasoft.Core.Entities;    public class UsrPopulateDeliveryType: IInstallScriptExecutor {        private static object GetDeliveryIdByName(string deliveryName) {            /* The unique ID of the delivery type. */            switch (deliveryName) {                case "Courier":                    return new Guid("50df77d0-7b1f-4dbc-a02d-7b6ebb95dfd0");                case "Customer pickup":                    return new Guid("ab31305f-7c6d-4158-bd0a-760ac7897755");                default:                    return Guid.Empty;            }        }        private static object GetDeliveryTypeByProductCategory(string category) {            /* The category of the product. */            switch (category) {                case "Hardware":                    return GetDeliveryIdByName("Customer pickup");                case "Services":                    return GetDeliveryIdByName("Customer pickup");                default:                    return GetDeliveryIdByName("Courier");            }        }        public void Execute(UserConnection userConnection) {            /* Create an ESQ that contains the "Id" column of the product and "Name" column from the "OrderProduct" database table. The "Name" column is the name of the product category. */            EntitySchemaQuery esqResult = new EntitySchemaQuery(userConnection.EntitySchemaManager, "OrderProduct");            EntitySchemaQueryColumn orderIdColumn = esqResult.AddColumn("Order.Id");            EntitySchemaQueryColumn productCategoryColumn = esqResult.AddColumn("Product.Category.Name");            /* Retrieve the collection of products in the order. */            EntityCollection productsInOrder = esqResult.GetEntityCollection(userConnection);            EntitySchemaManager entitySchemaManager = userConnection.EntitySchemaManager;            Entity orderEntity = entitySchemaManager.GetEntityByName("Order", userConnection);            foreach(Entity entity in productsInOrder) {                /* Retrieve the order object using the ID. */                Guid id = entity.GetTypedColumnValue <Guid> (orderIdColumn.Name);                string category = entity.GetTypedColumnValue <string> (productCategoryColumn.Name);                var conditions = new Dictionary <string,                    object> {                        {                            "Id",                            id                        }                    };                orderEntity.FetchFromDB(conditions);                /* Populate the delivery type based on the product category. */                orderEntity.SetColumnValue("DeliveryTypeId", GetDeliveryTypeByProductCategory(category));                /* Save the order. */                orderEntity.Save();            }        }    }}