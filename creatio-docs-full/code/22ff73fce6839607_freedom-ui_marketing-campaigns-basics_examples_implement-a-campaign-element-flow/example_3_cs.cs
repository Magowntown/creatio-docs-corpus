namespace Terrasoft.Configuration{    using System;    using System.Collections.Generic;    using System.Linq;    using Terrasoft.Common;    using Terrasoft.Core.DB;    /* Define a custom element flow. */    public class UsrSmsConditionalTransitionFlowElement        : ConditionalTransitionFlowElement    {        /* Assign the "SmsText" attribute value in the class. */        public string SmsText {            get;            set;        }        /* Assign the "PhoneNumber" attribute value in the class. */        public string PhoneNumber {            get;            set;        }        /* Assign the collection of SMS response IDs in the class. */        public IEnumerable<Guid> SmsResponses {            get;            set;        }        /* Extend the base "TransitionQuery" with participant responses        filter. */        private void ExtendWithResponses() {            TransitionQuery.CheckArgumentNull("TransitionQuery");            if (SmsResponses.Any()) {                Query responseSelect = GetSelectByParticipantResponses();                TransitionQuery.And("ContactId").In(responseSelect);            }        }        /* Build a subquery selecting "ContactId" from "UsrSmsRecipient"        filtered by "SmsText," "PhoneNumber," and "SmsResponseId." */        private Query GetSelectByParticipantResponses() {            var responseSelect = new Select(UserConnection)                .Column("ContactId")                .From("UsrSmsRecipient")                .Where("SmsText").IsEqual(Column.Parameter(SmsText))                    .And("PhoneNumber").IsEqual(Column.Parameter(PhoneNumber))                    .And("SmsResponseId")                        .In(Column.Parameters(SmsResponses)) as Select;            responseSelect.SpecifyNoLockHints(true);            return responseSelect;        }        /* Extend base query with response filters. */        protected override void CreateQuery() {            base.CreateQuery();            ExtendWithResponses();        }    }}